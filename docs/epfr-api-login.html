<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1 EPFR API Login | EPFR Strategy Notebooks</title>
  <meta name="description" content="The objective of this book is to present EPFRs proof of concept strategies so that readers have a profound understanding of how to use our EPFR’s flow and allocation dataset, construct a signal, and find initial value." />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="1 EPFR API Login | EPFR Strategy Notebooks" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://epfr.github.io/EPFR-QuantNotebooks/images/EPFR_Icon.png" />
  <meta property="og:description" content="The objective of this book is to present EPFRs proof of concept strategies so that readers have a profound understanding of how to use our EPFR’s flow and allocation dataset, construct a signal, and find initial value." />
  <meta name="github-repo" content="EPFR/EPFR-QuantNotebooks" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1 EPFR API Login | EPFR Strategy Notebooks" />
  
  <meta name="twitter:description" content="The objective of this book is to present EPFRs proof of concept strategies so that readers have a profound understanding of how to use our EPFR’s flow and allocation dataset, construct a signal, and find initial value." />
  <meta name="twitter:image" content="https://epfr.github.io/EPFR-QuantNotebooks/images/EPFR_Icon.png" />




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="flow-percentage-country-strategy.html"/>
<link rel="next" href="multi-asset-region-strategy.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { font-weight: bold; } /* Alert */
code span.an { font-style: italic; } /* Annotation */
code span.cf { font-weight: bold; } /* ControlFlow */
code span.co { font-style: italic; } /* Comment */
code span.cv { font-style: italic; } /* CommentVar */
code span.do { font-style: italic; } /* Documentation */
code span.dt { text-decoration: underline; } /* DataType */
code span.er { font-weight: bold; } /* Error */
code span.in { font-style: italic; } /* Information */
code span.kw { font-weight: bold; } /* Keyword */
code span.pp { font-weight: bold; } /* Preprocessor */
code span.wa { font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="images/comingsoon.png"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="macro-strategy-signals.html"><a href="macro-strategy-signals.html"><i class="fa fa-check"></i>Macro Strategy Signals</a>
<ul>
<li class="chapter" data-level="" data-path="macro-strategy-signals.html"><a href="macro-strategy-signals.html#flow-momentum"><i class="fa fa-check"></i>Flow Momentum</a></li>
<li class="chapter" data-level="" data-path="macro-strategy-signals.html"><a href="macro-strategy-signals.html#activepassive-indicator"><i class="fa fa-check"></i>Active/Passive Indicator</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="epfr-stock-factors.html"><a href="epfr-stock-factors.html"><i class="fa fa-check"></i>EPFR Stock Factors</a>
<ul>
<li class="chapter" data-level="" data-path="epfr-stock-factors.html"><a href="epfr-stock-factors.html#daily-factors"><i class="fa fa-check"></i>Daily Factors:</a></li>
<li class="chapter" data-level="" data-path="epfr-stock-factors.html"><a href="epfr-stock-factors.html#monthly-factors"><i class="fa fa-check"></i>Monthly Factors:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="epfr-api.html"><a href="epfr-api.html"><i class="fa fa-check"></i>EPFR API</a>
<ul>
<li class="chapter" data-level="" data-path="set-up.html"><a href="set-up.html"><i class="fa fa-check"></i>Set-up</a></li>
<li class="chapter" data-level="" data-path="flow-percentage-country-strategy.html"><a href="flow-percentage-country-strategy.html"><i class="fa fa-check"></i>Flow-Percentage Country Strategy</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="epfr-api-login.html"><a href="epfr-api-login.html"><i class="fa fa-check"></i><b>1</b> EPFR API Login</a>
<ul>
<li class="chapter" data-level="1.0.1" data-path="epfr-api-login.html"><a href="epfr-api-login.html#how-to-make-an-api-call"><i class="fa fa-check"></i><b>1.0.1</b> How to make an API call</a></li>
<li class="chapter" data-level="1.0.2" data-path="epfr-api-login.html"><a href="epfr-api-login.html#reteriving-the-country-allocations-data"><i class="fa fa-check"></i><b>1.0.2</b> Reteriving the country allocations data</a></li>
<li class="chapter" data-level="1.0.3" data-path="epfr-api-login.html"><a href="epfr-api-login.html#retrieving-the-flow-data"><i class="fa fa-check"></i><b>1.0.3</b> Retrieving the Flow data</a></li>
<li class="chapter" data-level="1.0.4" data-path="epfr-api-login.html"><a href="epfr-api-login.html#calculating-the-country-percent-flow"><i class="fa fa-check"></i><b>1.0.4</b> Calculating the Country Percent Flow</a></li>
<li class="chapter" data-level="" data-path="multi-asset-region-strategy.html"><a href="multi-asset-region-strategy.html"><i class="fa fa-check"></i>Multi Asset Region Strategy</a></li>
<li class="chapter" data-level="" data-path="multi-asset-fi-strategy.html"><a href="multi-asset-fi-strategy.html"><i class="fa fa-check"></i>Multi Asset FI Strategy</a></li>
<li class="chapter" data-level="" data-path="api-dictionaries.html"><a href="api-dictionaries.html"><i class="fa fa-check"></i>API Dictionaries</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="epfr.r-library.html"><a href="epfr.r-library.html"><i class="fa fa-check"></i>EPFR.r Library</a>
<ul>
<li class="chapter" data-level="" data-path="set-up-1.html"><a href="set-up-1.html"><i class="fa fa-check"></i>Set-up</a></li>
<li class="chapter" data-level="" data-path="strategy-functions.html"><a href="strategy-functions.html"><i class="fa fa-check"></i>Strategy Functions</a>
<ul>
<li class="chapter" data-level="" data-path="strategy-functions.html"><a href="strategy-functions.html#total-return-index"><i class="fa fa-check"></i>Total Return Index</a></li>
<li class="chapter" data-level="" data-path="strategy-functions.html"><a href="strategy-functions.html#compunding-flows"><i class="fa fa-check"></i>Compunding Flows</a></li>
<li class="chapter" data-level="" data-path="strategy-functions.html"><a href="strategy-functions.html#model"><i class="fa fa-check"></i>Model</a></li>
<li class="chapter" data-level="" data-path="strategy-functions.html"><a href="strategy-functions.html#example"><i class="fa fa-check"></i>Example</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="epfr-data-filters.html"><a href="epfr-data-filters.html"><i class="fa fa-check"></i>EPFR Data &amp; Filters</a>
<ul>
<li class="chapter" data-level="" data-path="video-explanations.html"><a href="video-explanations.html"><i class="fa fa-check"></i>Video Explanations</a>
<ul>
<li class="chapter" data-level="" data-path="video-explanations.html"><a href="video-explanations.html#asset-class-focus"><i class="fa fa-check"></i>Asset class focus</a></li>
<li class="chapter" data-level="" data-path="video-explanations.html"><a href="video-explanations.html#fund-type"><i class="fa fa-check"></i>Fund type</a></li>
<li class="chapter" data-level="" data-path="video-explanations.html"><a href="video-explanations.html#investor-type"><i class="fa fa-check"></i>Investor type</a></li>
<li class="chapter" data-level="" data-path="video-explanations.html"><a href="video-explanations.html#currency-of-flows"><i class="fa fa-check"></i>Currency of flows</a></li>
<li class="chapter" data-level="" data-path="video-explanations.html"><a href="video-explanations.html#fund-domicile-or-geographic-focus"><i class="fa fa-check"></i>Fund domicile or Geographic focus</a></li>
<li class="chapter" data-level="" data-path="video-explanations.html"><a href="video-explanations.html#theme"><i class="fa fa-check"></i>Theme</a></li>
<li class="chapter" data-level="" data-path="video-explanations.html"><a href="video-explanations.html#sector"><i class="fa fa-check"></i>Sector</a></li>
<li class="chapter" data-level="" data-path="video-explanations.html"><a href="video-explanations.html#style"><i class="fa fa-check"></i>Style</a></li>
<li class="chapter" data-level="" data-path="video-explanations.html"><a href="video-explanations.html#duration"><i class="fa fa-check"></i>Duration</a></li>
<li class="chapter" data-level="" data-path="video-explanations.html"><a href="video-explanations.html#individual-managers"><i class="fa fa-check"></i>Individual managers</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Macro Strategies</b></span></li>
<li class="chapter" data-level="2" data-path="multi-asset-strategy.html"><a href="multi-asset-strategy.html"><i class="fa fa-check"></i><b>2</b> Multi-Asset Strategy</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>2.1</b> Data</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="data.html"><a href="data.html#aggregations"><i class="fa fa-check"></i><b>2.1.1</b> Aggregations</a></li>
<li class="chapter" data-level="2.1.2" data-path="data.html"><a href="data.html#daily-percentage-flow"><i class="fa fa-check"></i><b>2.1.2</b> Daily Percentage Flow</a></li>
<li class="chapter" data-level="2.1.3" data-path="data.html"><a href="data.html#aggregate-flow-file"><i class="fa fa-check"></i><b>2.1.3</b> Aggregate Flow File</a></li>
<li class="chapter" data-level="2.1.4" data-path="data.html"><a href="data.html#return-file"><i class="fa fa-check"></i><b>2.1.4</b> Return File</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="strategy-implementation.html"><a href="strategy-implementation.html"><i class="fa fa-check"></i><b>2.2</b> Strategy Implementation</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="strategy-implementation.html"><a href="strategy-implementation.html#compounding-flows"><i class="fa fa-check"></i><b>2.2.1</b> Compounding Flows</a></li>
<li class="chapter" data-level="2.2.2" data-path="strategy-implementation.html"><a href="strategy-implementation.html#total-return-index-1"><i class="fa fa-check"></i><b>2.2.2</b> Total Return Index</a></li>
<li class="chapter" data-level="2.2.3" data-path="strategy-implementation.html"><a href="strategy-implementation.html#subset-files"><i class="fa fa-check"></i><b>2.2.3</b> Subset files</a></li>
<li class="chapter" data-level="2.2.4" data-path="strategy-implementation.html"><a href="strategy-implementation.html#ranking-asset-classes"><i class="fa fa-check"></i><b>2.2.4</b> Ranking Asset Classes</a></li>
<li class="chapter" data-level="2.2.5" data-path="strategy-implementation.html"><a href="strategy-implementation.html#model-1"><i class="fa fa-check"></i><b>2.2.5</b> Model</a></li>
<li class="chapter" data-level="2.2.6" data-path="strategy-implementation.html"><a href="strategy-implementation.html#performance"><i class="fa fa-check"></i><b>2.2.6</b> Performance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="fx-strategy.html"><a href="fx-strategy.html"><i class="fa fa-check"></i><b>3</b> FX Strategy</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-1.html"><a href="data-1.html"><i class="fa fa-check"></i><b>3.1</b> Data</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="data-1.html"><a href="data-1.html#aggregations-1"><i class="fa fa-check"></i><b>3.1.1</b> Aggregations</a></li>
<li class="chapter" data-level="3.1.2" data-path="data-1.html"><a href="data-1.html#daily-percentage-flow-1"><i class="fa fa-check"></i><b>3.1.2</b> Daily Percentage Flow</a></li>
<li class="chapter" data-level="3.1.3" data-path="data-1.html"><a href="data-1.html#aggregate-flow-file-1"><i class="fa fa-check"></i><b>3.1.3</b> Aggregate Flow File</a></li>
<li class="chapter" data-level="3.1.4" data-path="data-1.html"><a href="data-1.html#return-file-1"><i class="fa fa-check"></i><b>3.1.4</b> Return File</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="strategy-implementation-1.html"><a href="strategy-implementation-1.html"><i class="fa fa-check"></i><b>3.2</b> Strategy Implementation</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="strategy-implementation-1.html"><a href="strategy-implementation-1.html#compounding-flows-1"><i class="fa fa-check"></i><b>3.2.1</b> Compounding Flows</a></li>
<li class="chapter" data-level="3.2.2" data-path="strategy-implementation-1.html"><a href="strategy-implementation-1.html#ranking-currencies"><i class="fa fa-check"></i><b>3.2.2</b> Ranking Currencies</a></li>
<li class="chapter" data-level="3.2.3" data-path="strategy-implementation-1.html"><a href="strategy-implementation-1.html#model-2"><i class="fa fa-check"></i><b>3.2.3</b> Model</a></li>
<li class="chapter" data-level="3.2.4" data-path="strategy-implementation-1.html"><a href="strategy-implementation-1.html#performance-1"><i class="fa fa-check"></i><b>3.2.4</b> Performance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="flow-percentage-country-strategy-1.html"><a href="flow-percentage-country-strategy-1.html"><i class="fa fa-check"></i><b>4</b> Flow-Percentage Country Strategy</a>
<ul>
<li class="chapter" data-level="4.1" data-path="data-2.html"><a href="data-2.html"><i class="fa fa-check"></i><b>4.1</b> Data</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="data-2.html"><a href="data-2.html#aggregations-2"><i class="fa fa-check"></i><b>4.1.1</b> Aggregations</a></li>
<li class="chapter" data-level="4.1.2" data-path="data-2.html"><a href="data-2.html#daily-percentage-flow-2"><i class="fa fa-check"></i><b>4.1.2</b> Daily Percentage Flow</a></li>
<li class="chapter" data-level="4.1.3" data-path="data-2.html"><a href="data-2.html#aggregate-flow-file-2"><i class="fa fa-check"></i><b>4.1.3</b> Aggregate Flow File</a></li>
<li class="chapter" data-level="4.1.4" data-path="data-2.html"><a href="data-2.html#return-file-2"><i class="fa fa-check"></i><b>4.1.4</b> Return File</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="strategy-implementation-2.html"><a href="strategy-implementation-2.html"><i class="fa fa-check"></i><b>4.2</b> Strategy Implementation</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="strategy-implementation-2.html"><a href="strategy-implementation-2.html#compounding-flows-2"><i class="fa fa-check"></i><b>4.2.1</b> Compounding Flows</a></li>
<li class="chapter" data-level="4.2.2" data-path="strategy-implementation-2.html"><a href="strategy-implementation-2.html#total-return-index-2"><i class="fa fa-check"></i><b>4.2.2</b> Total Return Index</a></li>
<li class="chapter" data-level="4.2.3" data-path="strategy-implementation-2.html"><a href="strategy-implementation-2.html#ranking-countries"><i class="fa fa-check"></i><b>4.2.3</b> Ranking Countries</a></li>
<li class="chapter" data-level="4.2.4" data-path="strategy-implementation-2.html"><a href="strategy-implementation-2.html#model-3"><i class="fa fa-check"></i><b>4.2.4</b> Model</a></li>
<li class="chapter" data-level="4.2.5" data-path="strategy-implementation-2.html"><a href="strategy-implementation-2.html#performance-2"><i class="fa fa-check"></i><b>4.2.5</b> Performance</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="publications.html"><a href="publications.html"><i class="fa fa-check"></i><b>4.3</b> Publications</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="flow-percentage-sector-strategy.html"><a href="flow-percentage-sector-strategy.html"><i class="fa fa-check"></i><b>5</b> Flow-Percentage Sector Strategy</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-3.html"><a href="data-3.html"><i class="fa fa-check"></i><b>5.1</b> Data</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="data-3.html"><a href="data-3.html#aggregations-3"><i class="fa fa-check"></i><b>5.1.1</b> Aggregations</a></li>
<li class="chapter" data-level="5.1.2" data-path="data-3.html"><a href="data-3.html#daily-percentage-flow-3"><i class="fa fa-check"></i><b>5.1.2</b> Daily Percentage Flow</a></li>
<li class="chapter" data-level="5.1.3" data-path="data-3.html"><a href="data-3.html#aggregate-flow-file-3"><i class="fa fa-check"></i><b>5.1.3</b> Aggregate Flow File</a></li>
<li class="chapter" data-level="5.1.4" data-path="data-3.html"><a href="data-3.html#return-file-3"><i class="fa fa-check"></i><b>5.1.4</b> Return File</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="strategy-implementation-3.html"><a href="strategy-implementation-3.html"><i class="fa fa-check"></i><b>5.2</b> Strategy Implementation</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="strategy-implementation-3.html"><a href="strategy-implementation-3.html#compounding-flows-3"><i class="fa fa-check"></i><b>5.2.1</b> Compounding Flows</a></li>
<li class="chapter" data-level="5.2.2" data-path="strategy-implementation-3.html"><a href="strategy-implementation-3.html#total-return-index-3"><i class="fa fa-check"></i><b>5.2.2</b> Total Return Index</a></li>
<li class="chapter" data-level="5.2.3" data-path="strategy-implementation-3.html"><a href="strategy-implementation-3.html#ranking-sectors"><i class="fa fa-check"></i><b>5.2.3</b> Ranking Sectors</a></li>
<li class="chapter" data-level="5.2.4" data-path="strategy-implementation-3.html"><a href="strategy-implementation-3.html#model-4"><i class="fa fa-check"></i><b>5.2.4</b> Model</a></li>
<li class="chapter" data-level="5.2.5" data-path="strategy-implementation-3.html"><a href="strategy-implementation-3.html#performance-3"><i class="fa fa-check"></i><b>5.2.5</b> Performance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="activepassive-country-strategy.html"><a href="activepassive-country-strategy.html"><i class="fa fa-check"></i><b>6</b> Active/Passive Country Strategy</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-4.html"><a href="data-4.html"><i class="fa fa-check"></i><b>6.1</b> Data</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="data-4.html"><a href="data-4.html#aggregations-4"><i class="fa fa-check"></i><b>6.1.1</b> Aggregations</a></li>
<li class="chapter" data-level="6.1.2" data-path="data-4.html"><a href="data-4.html#activepassive-indicator-1"><i class="fa fa-check"></i><b>6.1.2</b> Active/Passive Indicator</a></li>
<li class="chapter" data-level="6.1.3" data-path="data-4.html"><a href="data-4.html#aggregate-indicator-file"><i class="fa fa-check"></i><b>6.1.3</b> Aggregate Indicator File</a></li>
<li class="chapter" data-level="6.1.4" data-path="data-4.html"><a href="data-4.html#return-file-4"><i class="fa fa-check"></i><b>6.1.4</b> Return File</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="strategy-implementation-4.html"><a href="strategy-implementation-4.html"><i class="fa fa-check"></i><b>6.2</b> Strategy Implementation</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="strategy-implementation-4.html"><a href="strategy-implementation-4.html#moving-sum-of-indicator"><i class="fa fa-check"></i><b>6.2.1</b> Moving Sum of Indicator</a></li>
<li class="chapter" data-level="6.2.2" data-path="strategy-implementation-4.html"><a href="strategy-implementation-4.html#total-return-index-4"><i class="fa fa-check"></i><b>6.2.2</b> Total Return Index</a></li>
<li class="chapter" data-level="6.2.3" data-path="strategy-implementation-4.html"><a href="strategy-implementation-4.html#ranking-countries-1"><i class="fa fa-check"></i><b>6.2.3</b> Ranking Countries</a></li>
<li class="chapter" data-level="6.2.4" data-path="strategy-implementation-4.html"><a href="strategy-implementation-4.html#model-5"><i class="fa fa-check"></i><b>6.2.4</b> Model</a></li>
<li class="chapter" data-level="6.2.5" data-path="strategy-implementation-4.html"><a href="strategy-implementation-4.html#performance-4"><i class="fa fa-check"></i><b>6.2.5</b> Performance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="activepassive-sector-strategy.html"><a href="activepassive-sector-strategy.html"><i class="fa fa-check"></i><b>7</b> Active/Passive Sector Strategy</a>
<ul>
<li class="chapter" data-level="7.1" data-path="data-5.html"><a href="data-5.html"><i class="fa fa-check"></i><b>7.1</b> Data</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="data-5.html"><a href="data-5.html#aggregations-5"><i class="fa fa-check"></i><b>7.1.1</b> Aggregations</a></li>
<li class="chapter" data-level="7.1.2" data-path="data-5.html"><a href="data-5.html#activepassive-indicator-2"><i class="fa fa-check"></i><b>7.1.2</b> Active/Passive Indicator</a></li>
<li class="chapter" data-level="7.1.3" data-path="data-5.html"><a href="data-5.html#aggregate-indicator-file-1"><i class="fa fa-check"></i><b>7.1.3</b> Aggregate Indicator File</a></li>
<li class="chapter" data-level="7.1.4" data-path="data-5.html"><a href="data-5.html#return-file-5"><i class="fa fa-check"></i><b>7.1.4</b> Return File</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="strategy-implementation-5.html"><a href="strategy-implementation-5.html"><i class="fa fa-check"></i><b>7.2</b> Strategy Implementation</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="strategy-implementation-5.html"><a href="strategy-implementation-5.html#moving-sum-of-indicator-1"><i class="fa fa-check"></i><b>7.2.1</b> Moving Sum of Indicator</a></li>
<li class="chapter" data-level="7.2.2" data-path="strategy-implementation-5.html"><a href="strategy-implementation-5.html#total-return-index-5"><i class="fa fa-check"></i><b>7.2.2</b> Total Return Index</a></li>
<li class="chapter" data-level="7.2.3" data-path="strategy-implementation-5.html"><a href="strategy-implementation-5.html#ranking-sectors-1"><i class="fa fa-check"></i><b>7.2.3</b> Ranking Sectors</a></li>
<li class="chapter" data-level="7.2.4" data-path="strategy-implementation-5.html"><a href="strategy-implementation-5.html#model-6"><i class="fa fa-check"></i><b>7.2.4</b> Model</a></li>
<li class="chapter" data-level="7.2.5" data-path="strategy-implementation-5.html"><a href="strategy-implementation-5.html#performance-5"><i class="fa fa-check"></i><b>7.2.5</b> Performance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="flow-percentage-dm-rates-strategy.html"><a href="flow-percentage-dm-rates-strategy.html"><i class="fa fa-check"></i><b>8</b> Flow-Percentage DM Rates Strategy</a>
<ul>
<li class="chapter" data-level="8.1" data-path="data-6.html"><a href="data-6.html"><i class="fa fa-check"></i><b>8.1</b> Data</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="data-6.html"><a href="data-6.html#aggregations-6"><i class="fa fa-check"></i><b>8.1.1</b> Aggregations</a></li>
<li class="chapter" data-level="8.1.2" data-path="data-6.html"><a href="data-6.html#daily-percentage-flow-4"><i class="fa fa-check"></i><b>8.1.2</b> Daily Percentage Flow</a></li>
<li class="chapter" data-level="8.1.3" data-path="data-6.html"><a href="data-6.html#aggregate-flow-file-4"><i class="fa fa-check"></i><b>8.1.3</b> Aggregate Flow File</a></li>
<li class="chapter" data-level="8.1.4" data-path="data-6.html"><a href="data-6.html#return-file-6"><i class="fa fa-check"></i><b>8.1.4</b> Return File</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="strategy-implementation-6.html"><a href="strategy-implementation-6.html"><i class="fa fa-check"></i><b>8.2</b> Strategy Implementation</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="strategy-implementation-6.html"><a href="strategy-implementation-6.html#compounding-flows-4"><i class="fa fa-check"></i><b>8.2.1</b> Compounding Flows</a></li>
<li class="chapter" data-level="8.2.2" data-path="strategy-implementation-6.html"><a href="strategy-implementation-6.html#ranking-countries-2"><i class="fa fa-check"></i><b>8.2.2</b> Ranking Countries</a></li>
<li class="chapter" data-level="8.2.3" data-path="strategy-implementation-6.html"><a href="strategy-implementation-6.html#model-7"><i class="fa fa-check"></i><b>8.2.3</b> Model</a></li>
<li class="chapter" data-level="8.2.4" data-path="strategy-implementation-6.html"><a href="strategy-implementation-6.html#performance-6"><i class="fa fa-check"></i><b>8.2.4</b> Performance</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Alternative Macro Strategies</b></span></li>
<li class="chapter" data-level="9" data-path="flow-percentage-daily-fixed-income-strategy.html"><a href="flow-percentage-daily-fixed-income-strategy.html"><i class="fa fa-check"></i><b>9</b> Flow-Percentage Daily Fixed-Income Strategy</a>
<ul>
<li class="chapter" data-level="9.1" data-path="data-7.html"><a href="data-7.html"><i class="fa fa-check"></i><b>9.1</b> Data</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="data-7.html"><a href="data-7.html#aggregations-7"><i class="fa fa-check"></i><b>9.1.1</b> Aggregations</a></li>
<li class="chapter" data-level="9.1.2" data-path="data-7.html"><a href="data-7.html#daily-percentage-flow-5"><i class="fa fa-check"></i><b>9.1.2</b> Daily Percentage Flow</a></li>
<li class="chapter" data-level="9.1.3" data-path="data-7.html"><a href="data-7.html#aggregate-flow-file-5"><i class="fa fa-check"></i><b>9.1.3</b> Aggregate Flow File</a></li>
<li class="chapter" data-level="9.1.4" data-path="data-7.html"><a href="data-7.html#return-file-7"><i class="fa fa-check"></i><b>9.1.4</b> Return File</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="strategy-implementation-7.html"><a href="strategy-implementation-7.html"><i class="fa fa-check"></i><b>9.2</b> Strategy Implementation</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="strategy-implementation-7.html"><a href="strategy-implementation-7.html#total-return-index-6"><i class="fa fa-check"></i><b>9.2.1</b> Total Return Index</a></li>
<li class="chapter" data-level="9.2.2" data-path="strategy-implementation-7.html"><a href="strategy-implementation-7.html#ranking-asset-classes-1"><i class="fa fa-check"></i><b>9.2.2</b> Ranking Asset Classes</a></li>
<li class="chapter" data-level="9.2.3" data-path="strategy-implementation-7.html"><a href="strategy-implementation-7.html#model-8"><i class="fa fa-check"></i><b>9.2.3</b> Model</a></li>
<li class="chapter" data-level="9.2.4" data-path="strategy-implementation-7.html"><a href="strategy-implementation-7.html#performance-7"><i class="fa fa-check"></i><b>9.2.4</b> Performance</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Stock Factors</b></span></li>
<li class="chapter" data-level="10" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>10</b> Overview</a>
<ul>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#data-location"><i class="fa fa-check"></i>Data Location</a></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html#data-derivation"><i class="fa fa-check"></i>Data Derivation</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="flow-momentum-1.html"><a href="flow-momentum-1.html"><i class="fa fa-check"></i><b>11</b> Flow Momentum</a>
<ul>
<li class="chapter" data-level="" data-path="flow-momentum-1.html"><a href="flow-momentum-1.html#flomo"><i class="fa fa-check"></i>FloMo</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="smart-money.html"><a href="smart-money.html"><i class="fa fa-check"></i><b>12</b> Smart Money</a>
<ul>
<li class="chapter" data-level="" data-path="smart-money.html"><a href="smart-money.html#references"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="" data-path="smart-money.html"><a href="smart-money.html#flotrend"><i class="fa fa-check"></i>FloTrend</a></li>
<li class="chapter" data-level="" data-path="smart-money.html"><a href="smart-money.html#flodiff"><i class="fa fa-check"></i>FloDiff</a></li>
<li class="chapter" data-level="" data-path="smart-money.html"><a href="smart-money.html#flodiff2"><i class="fa fa-check"></i>FloDiff2</a></li>
<li class="chapter" data-level="" data-path="smart-money.html"><a href="smart-money.html#actwttrend"><i class="fa fa-check"></i>ActWtTrend</a></li>
<li class="chapter" data-level="" data-path="smart-money.html"><a href="smart-money.html#actwtdiff"><i class="fa fa-check"></i>ActWtDiff</a></li>
<li class="chapter" data-level="" data-path="smart-money.html"><a href="smart-money.html#actwtdiff2"><i class="fa fa-check"></i>ActWtDiff2</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="manager-momentum.html"><a href="manager-momentum.html"><i class="fa fa-check"></i><b>13</b> Manager momentum</a>
<ul>
<li class="chapter" data-level="" data-path="manager-momentum.html"><a href="manager-momentum.html#allocmo"><i class="fa fa-check"></i>AllocMo</a></li>
<li class="chapter" data-level="" data-path="manager-momentum.html"><a href="manager-momentum.html#alloctrend"><i class="fa fa-check"></i>AllocTrend</a></li>
<li class="chapter" data-level="" data-path="manager-momentum.html"><a href="manager-momentum.html#allocdiff"><i class="fa fa-check"></i>AllocDiff</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="ownership-dispersion.html"><a href="ownership-dispersion.html"><i class="fa fa-check"></i><b>14</b> Ownership Dispersion</a>
<ul>
<li class="chapter" data-level="" data-path="ownership-dispersion.html"><a href="ownership-dispersion.html#herfindahl"><i class="fa fa-check"></i>Herfindahl</a></li>
<li class="chapter" data-level="" data-path="ownership-dispersion.html"><a href="ownership-dispersion.html#fund-count"><i class="fa fa-check"></i>Fund Count</a></li>
<li class="chapter" data-level="" data-path="ownership-dispersion.html"><a href="ownership-dispersion.html#references-1"><i class="fa fa-check"></i>References</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="conviction.html"><a href="conviction.html"><i class="fa fa-check"></i><b>15</b> Conviction</a>
<ul>
<li class="chapter" data-level="" data-path="conviction.html"><a href="conviction.html#allocskew"><i class="fa fa-check"></i>AllocSkew</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="index-curse-share-suprise.html"><a href="index-curse-share-suprise.html"><i class="fa fa-check"></i><b>16</b> Index Curse (Share Suprise)</a>
<ul>
<li class="chapter" data-level="" data-path="index-curse-share-suprise.html"><a href="index-curse-share-suprise.html#shssurp"><i class="fa fa-check"></i>ShsSurp</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="backtest-example.html"><a href="backtest-example.html"><i class="fa fa-check"></i><b>17</b> Backtest Example</a>
<ul>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i>Functions</a>
<ul>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#file-name"><i class="fa fa-check"></i>File name</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#format-file"><i class="fa fa-check"></i>Format file</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#fetchs-file"><i class="fa fa-check"></i>Fetchs file</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="import-data.html"><a href="import-data.html"><i class="fa fa-check"></i>Import Data</a>
<ul>
<li class="chapter" data-level="" data-path="import-data.html"><a href="import-data.html#epfr-stock-factor-data"><i class="fa fa-check"></i>EPFR Stock Factor data</a></li>
<li class="chapter" data-level="" data-path="import-data.html"><a href="import-data.html#returns-data"><i class="fa fa-check"></i>Returns data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="strategy-implementation-8.html"><a href="strategy-implementation-8.html"><i class="fa fa-check"></i>Strategy Implementation</a>
<ul>
<li class="chapter" data-level="" data-path="strategy-implementation-8.html"><a href="strategy-implementation-8.html#results"><i class="fa fa-check"></i>Results</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>FAQ</b></span></li>
<li class="chapter" data-level="" data-path="epfr-macro-strategey-files.html"><a href="epfr-macro-strategey-files.html"><i class="fa fa-check"></i>EPFR Macro Strategey Files</a></li>
<li class="chapter" data-level="" data-path="returns-information.html"><a href="returns-information.html"><i class="fa fa-check"></i>Returns Information</a></li>
<li class="chapter" data-level="" data-path="country-flows.html"><a href="country-flows.html"><i class="fa fa-check"></i>Country Flows</a></li>
<li class="chapter" data-level="" data-path="stock-flows.html"><a href="stock-flows.html"><i class="fa fa-check"></i>Stock Flows</a></li>
<li class="chapter" data-level="" data-path="geographic-focus-breakdown.html"><a href="geographic-focus-breakdown.html"><i class="fa fa-check"></i>Geographic Focus Breakdown</a>
<ul>
<li class="chapter" data-level="" data-path="geographic-focus-breakdown.html"><a href="geographic-focus-breakdown.html#stock-flows-geofocus-breakdown"><i class="fa fa-check"></i>Stock Flows GeoFocus Breakdown</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://epfr.com/" target="blank">EPFR</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">EPFR Strategy Notebooks</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="epfr-api-login" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">1</span> EPFR API Login<a href="epfr-api-login.html#epfr-api-login" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Before using any of the EPFR API functions you will first need to login to the EPFR API using your credentials <br>
If you need help with your credentials you can contact: <a href="mailto:EPFRSupport@isimarkets.com" class="email">EPFRSupport@isimarkets.com</a></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="epfr-api-login.html#cb2-1" tabindex="-1"></a>username <span class="ot">&lt;-</span> epfr api username</span>
<span id="cb2-2"><a href="epfr-api-login.html#cb2-2" tabindex="-1"></a>password <span class="ot">&lt;-</span> epfr api password</span>
<span id="cb2-3"><a href="epfr-api-login.html#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="epfr-api-login.html#cb2-4" tabindex="-1"></a><span class="co"># log into epfr API</span></span>
<span id="cb2-5"><a href="epfr-api-login.html#cb2-5" tabindex="-1"></a><span class="fu">epfr.login</span>(username, password)</span></code></pre></div>
<pre><code>## Environment set to: PROD 
## [1] &quot;Previous session closed.&quot;
## [1] &quot;Login successful.&quot;</code></pre>
<div id="how-to-make-an-api-call" class="section level3 hasAnchor" number="1.0.1">
<h3><span class="header-section-number">1.0.1</span> How to make an API call<a href="epfr-api-login.html#how-to-make-an-api-call" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>the process of calling from the EPFR API follows 3 steps <br>
1. create the Report ID which corresponds to the parameters of the data you are querying using epfr.get.reportid <br>
2. wait for the API to complete the report which corresponds to the report ID <br>
3. once report is completed retrieve the data from the report using epfr.get.reportoutput <br><br></p>
<p>Below is the function which which checks if a report has been completed and it’s data is ready to be retrieved</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="epfr-api-login.html#cb4-1" tabindex="-1"></a><span class="co"># Checks if report associated with report API and database is completed, </span></span>
<span id="cb4-2"><a href="epfr-api-login.html#cb4-2" tabindex="-1"></a><span class="co"># If data is extracted before the report is completed there will be an error</span></span>
<span id="cb4-3"><a href="epfr-api-login.html#cb4-3" tabindex="-1"></a>wait_for_completion <span class="ot">&lt;-</span> <span class="cf">function</span>(report_id, dataset, <span class="at">inital_time_offset=</span><span class="dv">5</span>, <span class="at">time_offset=</span><span class="dv">10</span>) {</span>
<span id="cb4-4"><a href="epfr-api-login.html#cb4-4" tabindex="-1"></a>  </span>
<span id="cb4-5"><a href="epfr-api-login.html#cb4-5" tabindex="-1"></a>  <span class="co"># variable for tracking how much time report is taking</span></span>
<span id="cb4-6"><a href="epfr-api-login.html#cb4-6" tabindex="-1"></a>  time_taken <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb4-7"><a href="epfr-api-login.html#cb4-7" tabindex="-1"></a>  </span>
<span id="cb4-8"><a href="epfr-api-login.html#cb4-8" tabindex="-1"></a>  <span class="co"># the initial time offset for report completion </span></span>
<span id="cb4-9"><a href="epfr-api-login.html#cb4-9" tabindex="-1"></a>  <span class="co"># (user estimate of how long it will take)</span></span>
<span id="cb4-10"><a href="epfr-api-login.html#cb4-10" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;Inital wait for report to complete, delay &quot;</span>, inital_time_offset))</span>
<span id="cb4-11"><a href="epfr-api-login.html#cb4-11" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(inital_time_offset)</span>
<span id="cb4-12"><a href="epfr-api-login.html#cb4-12" tabindex="-1"></a>  time_taken <span class="ot">&lt;-</span> time_taken <span class="sc">+</span> inital_time_offset</span>
<span id="cb4-13"><a href="epfr-api-login.html#cb4-13" tabindex="-1"></a>  </span>
<span id="cb4-14"><a href="epfr-api-login.html#cb4-14" tabindex="-1"></a>  <span class="co"># check the current report status</span></span>
<span id="cb4-15"><a href="epfr-api-login.html#cb4-15" tabindex="-1"></a>  st <span class="ot">&lt;-</span> <span class="fu">epfr.get.reportstatus</span>(dataset, report_id)<span class="sc">$</span>data<span class="sc">$</span>status</span>
<span id="cb4-16"><a href="epfr-api-login.html#cb4-16" tabindex="-1"></a>  </span>
<span id="cb4-17"><a href="epfr-api-login.html#cb4-17" tabindex="-1"></a>  <span class="co"># while the report has not reached the completed status</span></span>
<span id="cb4-18"><a href="epfr-api-login.html#cb4-18" tabindex="-1"></a>  <span class="cf">while</span> (st <span class="sc">!=</span> <span class="st">&quot;Completed&quot;</span>) {</span>
<span id="cb4-19"><a href="epfr-api-login.html#cb4-19" tabindex="-1"></a>    <span class="co"># check the status of the report</span></span>
<span id="cb4-20"><a href="epfr-api-login.html#cb4-20" tabindex="-1"></a>    st <span class="ot">&lt;-</span> <span class="fu">epfr.get.reportstatus</span>(dataset, report_id)<span class="sc">$</span>data<span class="sc">$</span>status</span>
<span id="cb4-21"><a href="epfr-api-login.html#cb4-21" tabindex="-1"></a>    </span>
<span id="cb4-22"><a href="epfr-api-login.html#cb4-22" tabindex="-1"></a>    <span class="co"># if report is completed</span></span>
<span id="cb4-23"><a href="epfr-api-login.html#cb4-23" tabindex="-1"></a>    <span class="cf">if</span> (st<span class="sc">==</span><span class="st">&quot;Completed&quot;</span>) {</span>
<span id="cb4-24"><a href="epfr-api-login.html#cb4-24" tabindex="-1"></a>      <span class="co"># print time taken and exit loop</span></span>
<span id="cb4-25"><a href="epfr-api-login.html#cb4-25" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb4-26"><a href="epfr-api-login.html#cb4-26" tabindex="-1"></a>      </span>
<span id="cb4-27"><a href="epfr-api-login.html#cb4-27" tabindex="-1"></a>      <span class="co"># if report cannot be completed</span></span>
<span id="cb4-28"><a href="epfr-api-login.html#cb4-28" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (st <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Errored&quot;</span>,<span class="st">&quot;Failed&quot;</span>)) {</span>
<span id="cb4-29"><a href="epfr-api-login.html#cb4-29" tabindex="-1"></a>      <span class="co"># stop the program, job has failed</span></span>
<span id="cb4-30"><a href="epfr-api-login.html#cb4-30" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">&quot;EPFR job failed&quot;</span>)</span>
<span id="cb4-31"><a href="epfr-api-login.html#cb4-31" tabindex="-1"></a>    }</span>
<span id="cb4-32"><a href="epfr-api-login.html#cb4-32" tabindex="-1"></a>    </span>
<span id="cb4-33"><a href="epfr-api-login.html#cb4-33" tabindex="-1"></a>    <span class="co"># system sleep for user specified amount</span></span>
<span id="cb4-34"><a href="epfr-api-login.html#cb4-34" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(time_offset)</span>
<span id="cb4-35"><a href="epfr-api-login.html#cb4-35" tabindex="-1"></a>    time_taken <span class="ot">&lt;-</span> time_taken <span class="sc">+</span> time_offset</span>
<span id="cb4-36"><a href="epfr-api-login.html#cb4-36" tabindex="-1"></a>    <span class="co"># print the current time taken on the report</span></span>
<span id="cb4-37"><a href="epfr-api-login.html#cb4-37" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;Report &quot;</span>, st, <span class="st">&quot; time taken: &quot;</span>, time_taken))</span>
<span id="cb4-38"><a href="epfr-api-login.html#cb4-38" tabindex="-1"></a>  } </span>
<span id="cb4-39"><a href="epfr-api-login.html#cb4-39" tabindex="-1"></a>  </span>
<span id="cb4-40"><a href="epfr-api-login.html#cb4-40" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;Report complete: &quot;</span>, time_taken, <span class="st">&quot; seconds taken&quot;</span>))</span>
<span id="cb4-41"><a href="epfr-api-login.html#cb4-41" tabindex="-1"></a>}</span></code></pre></div>
<p>The API accepts dates in the form “mm-dd-YYYY” whereas flow dates are witten “YYYYmmdd” <br>
and The API outputs dates in the form “m/d/YYYY” which when sorted will not go on chronological order <br>
Below are 2 helper functions to convert flow dates to the api input dates and api output dates to flow dates</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="epfr-api-login.html#cb5-1" tabindex="-1"></a><span class="co"># take a date in &quot;YYYYmmdd&quot; and coverts it to &quot;mm-dd-YYYY&quot;</span></span>
<span id="cb5-2"><a href="epfr-api-login.html#cb5-2" tabindex="-1"></a>flow_to_api_date <span class="ot">&lt;-</span> <span class="cf">function</span>(flow_date) {</span>
<span id="cb5-3"><a href="epfr-api-login.html#cb5-3" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">substr</span>(flow_date, <span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb5-4"><a href="epfr-api-login.html#cb5-4" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">substr</span>(flow_date, <span class="dv">5</span>, <span class="dv">6</span>)</span>
<span id="cb5-5"><a href="epfr-api-login.html#cb5-5" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="fu">substr</span>(flow_date, <span class="dv">7</span>, <span class="dv">8</span>)</span>
<span id="cb5-6"><a href="epfr-api-login.html#cb5-6" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">paste0</span>(m, <span class="st">&quot;-&quot;</span>, d, <span class="st">&quot;-&quot;</span>, y))</span>
<span id="cb5-7"><a href="epfr-api-login.html#cb5-7" tabindex="-1"></a>}</span>
<span id="cb5-8"><a href="epfr-api-login.html#cb5-8" tabindex="-1"></a></span>
<span id="cb5-9"><a href="epfr-api-login.html#cb5-9" tabindex="-1"></a><span class="co"># takes a date in the form &quot;m/d/YYYY&quot; and convers it to &quot;YYYYmmdd</span></span>
<span id="cb5-10"><a href="epfr-api-login.html#cb5-10" tabindex="-1"></a>chrdate_to_flowdate <span class="ot">&lt;-</span> <span class="cf">function</span>(date) {</span>
<span id="cb5-11"><a href="epfr-api-login.html#cb5-11" tabindex="-1"></a>  split <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(date, <span class="at">split=</span><span class="st">&quot;/&quot;</span>)[[<span class="dv">1</span>]]</span>
<span id="cb5-12"><a href="epfr-api-login.html#cb5-12" tabindex="-1"></a>  y <span class="ot">&lt;-</span> split[<span class="dv">3</span>]</span>
<span id="cb5-13"><a href="epfr-api-login.html#cb5-13" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nchar</span>(split[<span class="dv">1</span>]) <span class="sc">==</span> <span class="dv">1</span>, <span class="fu">paste0</span>(<span class="st">&quot;0&quot;</span>, split[<span class="dv">1</span>]), split[<span class="dv">1</span>])</span>
<span id="cb5-14"><a href="epfr-api-login.html#cb5-14" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">nchar</span>(split[<span class="dv">2</span>]) <span class="sc">==</span> <span class="dv">1</span>, <span class="fu">paste0</span>(<span class="st">&quot;0&quot;</span>, split[<span class="dv">2</span>]), split[<span class="dv">2</span>])</span>
<span id="cb5-15"><a href="epfr-api-login.html#cb5-15" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">paste0</span>(y, m, d))</span>
<span id="cb5-16"><a href="epfr-api-login.html#cb5-16" tabindex="-1"></a>}</span>
<span id="cb5-17"><a href="epfr-api-login.html#cb5-17" tabindex="-1"></a><span class="co"># vectorize the function so it can be used on a data frame column</span></span>
<span id="cb5-18"><a href="epfr-api-login.html#cb5-18" tabindex="-1"></a>chrdate_to_flowdate_vec <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(chrdate_to_flowdate)</span></code></pre></div>
</div>
<div id="reteriving-the-country-allocations-data" class="section level3 hasAnchor" number="1.0.2">
<h3><span class="header-section-number">1.0.2</span> Reteriving the country allocations data<a href="epfr-api-login.html#reteriving-the-country-allocations-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will be recreating the country percentage flow data across all flow dates for the allocation month of May 2025. <br><br></p>
<p>To calculate the country flow percentage we need the flow USD, Net Assets start and Country allocations data for all funds which report to EPFR in both the country allocations and fund flow databases. <br>
Both databases use the same function epfr.get.reportid to create the report from which the data will be pulled. <br>
This file shows 2 examples of using the get report if function, to learn more about the parameters of epfr.get.reportid the documentation is here: <br> <a href="https://developer.isimarkets.com/en/docs/epfr/api-v2/python/full-guide" class="uri">https://developer.isimarkets.com/en/docs/epfr/api-v2/python/full-guide</a> <br><br></p>
<p><em>To see more about available filters, asset classes, and return value categories call the api dictionaries. <br>
Example of calling an dictionaries here: <a href="https://developer.isimarkets.com/en/docs/epfr/api-v2/r/quick-examples/get-dictionary-filters" class="uri">https://developer.isimarkets.com/en/docs/epfr/api-v2/r/quick-examples/get-dictionary-filters</a></em></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="epfr-api-login.html#cb6-1" tabindex="-1"></a><span class="co"># The allocation month which we will retrieve data for</span></span>
<span id="cb6-2"><a href="epfr-api-login.html#cb6-2" tabindex="-1"></a>alloc_month <span class="ot">&lt;-</span> <span class="st">&quot;202505&quot;</span></span>
<span id="cb6-3"><a href="epfr-api-login.html#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="epfr-api-login.html#cb6-4" tabindex="-1"></a><span class="co"># Get the final day of the month as that is the date where allocation are stored</span></span>
<span id="cb6-5"><a href="epfr-api-login.html#cb6-5" tabindex="-1"></a>date <span class="ot">&lt;-</span> <span class="fu">flow_to_api_date</span>(<span class="fu">yyyymm.to.day</span>(alloc_month))</span>
<span id="cb6-6"><a href="epfr-api-login.html#cb6-6" tabindex="-1"></a></span>
<span id="cb6-7"><a href="epfr-api-login.html#cb6-7" tabindex="-1"></a><span class="co"># pulls data for all available equity asset classes</span></span>
<span id="cb6-8"><a href="epfr-api-login.html#cb6-8" tabindex="-1"></a>all_acs <span class="ot">&lt;-</span> <span class="fu">as.list</span>(<span class="fu">epfr.get.dictionary.assetclasses</span>(<span class="st">&quot;CA&quot;</span>)<span class="sc">$</span>data <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="epfr-api-login.html#cb6-9" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;Equity&quot;</span>, name)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(id) <span class="sc">%&gt;%</span> <span class="fu">as.list</span>())</span>
<span id="cb6-10"><a href="epfr-api-login.html#cb6-10" tabindex="-1"></a><span class="co"># to see all country allocations by running this line</span></span>
<span id="cb6-11"><a href="epfr-api-login.html#cb6-11" tabindex="-1"></a><span class="co"># acs_ca &lt;- epfr.get.dictionary.assetclasses(&quot;CA&quot;)$data </span></span>
<span id="cb6-12"><a href="epfr-api-login.html#cb6-12" tabindex="-1"></a></span>
<span id="cb6-13"><a href="epfr-api-login.html#cb6-13" tabindex="-1"></a><span class="co"># create the report id which will retrieve the country allocations data </span></span>
<span id="cb6-14"><a href="epfr-api-login.html#cb6-14" tabindex="-1"></a><span class="co"># this report id will return all countries allocation which are available </span></span>
<span id="cb6-15"><a href="epfr-api-login.html#cb6-15" tabindex="-1"></a></span>
<span id="cb6-16"><a href="epfr-api-login.html#cb6-16" tabindex="-1"></a><span class="co"># To see country allocations which can be returned from the country alloc database run this line</span></span>
<span id="cb6-17"><a href="epfr-api-login.html#cb6-17" tabindex="-1"></a><span class="co"># output_ca &lt;- epfr.get.dictionary.categories(&quot;CA&quot;)$data</span></span>
<span id="cb6-18"><a href="epfr-api-login.html#cb6-18" tabindex="-1"></a></span>
<span id="cb6-19"><a href="epfr-api-login.html#cb6-19" tabindex="-1"></a>report_ac <span class="ot">&lt;-</span> <span class="fu">epfr.get.reportid</span>(<span class="at">dataset =</span> <span class="st">&quot;CA&quot;</span>, <span class="co"># country allocations database</span></span>
<span id="cb6-20"><a href="epfr-api-login.html#cb6-20" tabindex="-1"></a>                            <span class="at">from_date =</span> date, <span class="co"># (start date) alloc date for this call</span></span>
<span id="cb6-21"><a href="epfr-api-login.html#cb6-21" tabindex="-1"></a>                            <span class="at">to_date =</span> date, <span class="co"># (end date) alloc date for this call</span></span>
<span id="cb6-22"><a href="epfr-api-login.html#cb6-22" tabindex="-1"></a>                            <span class="at">asset_classes =</span> all_acs, <span class="co"># pulls data for all asset classes</span></span>
<span id="cb6-23"><a href="epfr-api-login.html#cb6-23" tabindex="-1"></a>                            <span class="at">frequency =</span>  <span class="st">&quot;Monthly&quot;</span>, <span class="co"># monthly frequency, no daily for ctry alloc</span></span>
<span id="cb6-24"><a href="epfr-api-login.html#cb6-24" tabindex="-1"></a>                            <span class="at">level =</span> <span class="dv">2</span>, <span class="co"># fund level  # fund level data</span></span>
<span id="cb6-25"><a href="epfr-api-login.html#cb6-25" tabindex="-1"></a>                            <span class="at">categories =</span> <span class="fu">list</span>(<span class="dv">85</span>), <span class="co"># returns fund id in addition to ctry alloc</span></span>
<span id="cb6-26"><a href="epfr-api-login.html#cb6-26" tabindex="-1"></a>                            <span class="at">average_type =</span> <span class="dv">1</span>, <span class="co"># no aggregation</span></span>
<span id="cb6-27"><a href="epfr-api-login.html#cb6-27" tabindex="-1"></a>                            <span class="at">allocation_ids =</span> <span class="fu">as.list</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">187</span>)), <span class="co"># all available countries</span></span>
<span id="cb6-28"><a href="epfr-api-login.html#cb6-28" tabindex="-1"></a>                            <span class="at">assets =</span> T, <span class="co"># set to true for allocations calls</span></span>
<span id="cb6-29"><a href="epfr-api-login.html#cb6-29" tabindex="-1"></a>                            <span class="at">universal_filters =</span> <span class="cn">NULL</span>,</span>
<span id="cb6-30"><a href="epfr-api-login.html#cb6-30" tabindex="-1"></a>                            <span class="at">equity_filters =</span> <span class="cn">NULL</span>,</span>
<span id="cb6-31"><a href="epfr-api-login.html#cb6-31" tabindex="-1"></a>                            <span class="at">bond_filters =</span> <span class="cn">NULL</span>,</span>
<span id="cb6-32"><a href="epfr-api-login.html#cb6-32" tabindex="-1"></a>                            <span class="at">alternative_filters =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p>Once the report id is created data is extracted like this.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="epfr-api-login.html#cb7-1" tabindex="-1"></a><span class="co"># getting allocations data from the API</span></span>
<span id="cb7-2"><a href="epfr-api-login.html#cb7-2" tabindex="-1"></a>report_id_ac <span class="ot">&lt;-</span> report_ac<span class="sc">$</span>data<span class="sc">$</span>reportId <span class="co"># extract report id</span></span>
<span id="cb7-3"><a href="epfr-api-login.html#cb7-3" tabindex="-1"></a><span class="co"># wait for the report to complete previously it has taken ~ 20 seconds </span></span>
<span id="cb7-4"><a href="epfr-api-login.html#cb7-4" tabindex="-1"></a><span class="co"># to complete so that is set as the initial weight time</span></span>
<span id="cb7-5"><a href="epfr-api-login.html#cb7-5" tabindex="-1"></a><span class="fu">wait_for_completion</span>(report_id_ac, <span class="st">&quot;CA&quot;</span>, <span class="dv">20</span>, <span class="dv">10</span>) </span>
<span id="cb7-6"><a href="epfr-api-login.html#cb7-6" tabindex="-1"></a>report_result_ca <span class="ot">&lt;-</span> <span class="fu">epfr.get.reportoutput</span>(<span class="st">&quot;CA&quot;</span>, report_id_ac) <span class="co"># extract the data from report</span></span></code></pre></div>
<pre><code>## [1] &quot;Inital wait for report to complete, delay 20&quot;</code></pre>
<pre><code>## [1] &quot;Report complete: 20 seconds taken&quot;</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="epfr-api-login.html#cb10-1" tabindex="-1"></a><span class="co"># transform data such that there is a column of Fund Ids and the rest of columns</span></span>
<span id="cb10-2"><a href="epfr-api-login.html#cb10-2" tabindex="-1"></a><span class="co"># are the country allocations for each fund in the data frame</span></span>
<span id="cb10-3"><a href="epfr-api-login.html#cb10-3" tabindex="-1"></a>curr_alloc_data <span class="ot">&lt;-</span> report_result_ca <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="epfr-api-login.html#cb10-4" tabindex="-1"></a>  <span class="co"># remove any columns which are not country allocations or Fund Id</span></span>
<span id="cb10-5"><a href="epfr-api-login.html#cb10-5" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(Date, Fund, <span class="st">`</span><span class="at">Total Net Assets</span><span class="st">`</span>, <span class="st">`</span><span class="at">Asset Class</span><span class="st">`</span>, Filters)) <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="epfr-api-login.html#cb10-6" tabindex="-1"></a>  <span class="co"># change the country allocations from % to decimal</span></span>
<span id="cb10-7"><a href="epfr-api-login.html#cb10-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb10-8"><a href="epfr-api-login.html#cb10-8" tabindex="-1"></a>    <span class="at">.cols =</span> <span class="sc">-</span><span class="fu">c</span>(FundID),</span>
<span id="cb10-9"><a href="epfr-api-login.html#cb10-9" tabindex="-1"></a>    <span class="at">.fns =</span> <span class="sc">~</span> . <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb10-10"><a href="epfr-api-login.html#cb10-10" tabindex="-1"></a>  ))</span>
<span id="cb10-11"><a href="epfr-api-login.html#cb10-11" tabindex="-1"></a></span>
<span id="cb10-12"><a href="epfr-api-login.html#cb10-12" tabindex="-1"></a><span class="co"># check shape and head of data frame should have 186 countries plus fund Id</span></span>
<span id="cb10-13"><a href="epfr-api-login.html#cb10-13" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">dim</span>(curr_alloc_data))</span>
<span id="cb10-14"><a href="epfr-api-login.html#cb10-14" tabindex="-1"></a><span class="fu">print</span>(curr_alloc_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(FundID, Australia, Brazil, China, USA) <span class="sc">%&gt;%</span> <span class="fu">top_n</span>(<span class="dv">10</span>))</span></code></pre></div>
<pre><code>## [1] 1745  187</code></pre>
<pre><code>## Selecting by USA</code></pre>
<pre><code>##    FundID Australia Brazil    China      USA
## 1   10959  0.000000      0 0.000000 0.766340
## 2   78120  0.000000      0 0.000000 0.768722
## 3    3701  0.000000      0 0.000000 0.819344
## 4   88963  0.008400      0 0.000000 0.876300
## 5   50111  0.013707      0 0.000585 0.805743
## 6   15342  0.000000      0 0.000000 0.762000
## 7   90008  0.000000      0 0.000000 0.982066
## 8   13663  0.004851      0 0.000000 0.844482
## 9    5168  0.004182      0 0.013083 0.784196
## 10  39696  0.000000      0 0.000356 0.765399</code></pre>
</div>
<div id="retrieving-the-flow-data" class="section level3 hasAnchor" number="1.0.3">
<h3><span class="header-section-number">1.0.3</span> Retrieving the Flow data<a href="epfr-api-login.html#retrieving-the-flow-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will be recreating the country percentage flow data across all flow dates for the allocation month of May 2025. <br><br></p>
<p>When calculating country flow percentage all equity funds with a cross boarder focus which report to both country allocations and fund flows are used. Since the API does not support querying for data based on Fund id we cannot use the list of funds ids which are returned from the country allocations query and instead must use all query for all asset classes which have a cross boarder focus in the fund flows database. Then when combining the results from the country allocations and fund flows query the data frames will be filtered for the fund ids which they have in common.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="epfr-api-login.html#cb14-1" tabindex="-1"></a><span class="co"># select the daily start and end dates for the alloc month using the EPFR function for extracting flow dates</span></span>
<span id="cb14-2"><a href="epfr-api-login.html#cb14-2" tabindex="-1"></a>flow_dates <span class="ot">&lt;-</span> <span class="fu">flowdate.ex.AllocMo</span>(alloc_month)</span>
<span id="cb14-3"><a href="epfr-api-login.html#cb14-3" tabindex="-1"></a>start_date_api <span class="ot">&lt;-</span> <span class="fu">flow_to_api_date</span>(flow_dates[<span class="dv">1</span>]) </span>
<span id="cb14-4"><a href="epfr-api-login.html#cb14-4" tabindex="-1"></a>end_date_api <span class="ot">&lt;-</span> <span class="fu">flow_to_api_date</span>(flow_dates[<span class="fu">length</span>(flow_dates)])</span>
<span id="cb14-5"><a href="epfr-api-login.html#cb14-5" tabindex="-1"></a></span>
<span id="cb14-6"><a href="epfr-api-login.html#cb14-6" tabindex="-1"></a><span class="co"># list of asset classes which correspond to cross boarder funds</span></span>
<span id="cb14-7"><a href="epfr-api-login.html#cb14-7" tabindex="-1"></a><span class="co"># if a fund has a single country geofocus it wont report county allocations</span></span>
<span id="cb14-8"><a href="epfr-api-login.html#cb14-8" tabindex="-1"></a>xborder <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;FF122001&quot;</span>, <span class="st">&quot;FF121001&quot;</span>, <span class="st">&quot;FF123001&quot;</span>, <span class="st">&quot;FF122007&quot;</span>, <span class="st">&quot;FF114004&quot;</span>, <span class="st">&quot;FF114005&quot;</span>,</span>
<span id="cb14-9"><a href="epfr-api-login.html#cb14-9" tabindex="-1"></a><span class="st">&quot;FF122008&quot;</span>, <span class="st">&quot;FF112001&quot;</span>, <span class="st">&quot;FF123002&quot;</span>, <span class="st">&quot;FF112002&quot;</span>, <span class="st">&quot;FF121004&quot;</span>, <span class="st">&quot;FF124005&quot;</span>,</span>
<span id="cb14-10"><a href="epfr-api-login.html#cb14-10" tabindex="-1"></a><span class="st">&quot;FF122012&quot;</span>, <span class="st">&quot;FF122013&quot;</span>, <span class="st">&quot;FF111004&quot;</span>)</span>
<span id="cb14-11"><a href="epfr-api-login.html#cb14-11" tabindex="-1"></a><span class="co"># see all fund flows asset classes by running this line</span></span>
<span id="cb14-12"><a href="epfr-api-login.html#cb14-12" tabindex="-1"></a><span class="co"># acs_ff &lt;- epfr.get.dictionary.assetclasses(&quot;FF&quot;)$data </span></span>
<span id="cb14-13"><a href="epfr-api-login.html#cb14-13" tabindex="-1"></a></span>
<span id="cb14-14"><a href="epfr-api-login.html#cb14-14" tabindex="-1"></a></span>
<span id="cb14-15"><a href="epfr-api-login.html#cb14-15" tabindex="-1"></a><span class="co"># create the report id which will retrieve the data </span></span>
<span id="cb14-16"><a href="epfr-api-login.html#cb14-16" tabindex="-1"></a><span class="co"># this will return Fund name, fundid, flows UDS, and Net assets start</span></span>
<span id="cb14-17"><a href="epfr-api-login.html#cb14-17" tabindex="-1"></a></span>
<span id="cb14-18"><a href="epfr-api-login.html#cb14-18" tabindex="-1"></a><span class="co"># To see other values which can be returned from the fund flows database run this line</span></span>
<span id="cb14-19"><a href="epfr-api-login.html#cb14-19" tabindex="-1"></a><span class="co"># output_ff &lt;- epfr.get.dictionary.categories(&quot;FF&quot;)$data</span></span>
<span id="cb14-20"><a href="epfr-api-login.html#cb14-20" tabindex="-1"></a></span>
<span id="cb14-21"><a href="epfr-api-login.html#cb14-21" tabindex="-1"></a>report_ff <span class="ot">&lt;-</span> <span class="fu">epfr.get.reportid</span>(<span class="at">dataset =</span> <span class="st">&quot;FF&quot;</span>, <span class="co"># from the fun flows data base</span></span>
<span id="cb14-22"><a href="epfr-api-login.html#cb14-22" tabindex="-1"></a>                            <span class="at">from_date =</span> start_date_api, <span class="co"># start of the period</span></span>
<span id="cb14-23"><a href="epfr-api-login.html#cb14-23" tabindex="-1"></a>                            <span class="at">to_date =</span> end_date_api,  <span class="co"># end of the period</span></span>
<span id="cb14-24"><a href="epfr-api-login.html#cb14-24" tabindex="-1"></a>                            <span class="at">asset_classes =</span> xborder, <span class="co"># all asset classes of cross board funds</span></span>
<span id="cb14-25"><a href="epfr-api-login.html#cb14-25" tabindex="-1"></a>                            <span class="at">frequency =</span>  <span class="st">&quot;Daily&quot;</span>, <span class="co"># daily frequency of data</span></span>
<span id="cb14-26"><a href="epfr-api-login.html#cb14-26" tabindex="-1"></a>                            <span class="at">level =</span> <span class="dv">2</span>, <span class="co"># fund level aggregation </span></span>
<span id="cb14-27"><a href="epfr-api-login.html#cb14-27" tabindex="-1"></a>                            <span class="at">categories =</span> <span class="fu">list</span>(<span class="dv">53</span>, <span class="dv">3</span>, <span class="dv">13</span>), <span class="co"># returning fundid, flow usd, net asset start </span></span>
<span id="cb14-28"><a href="epfr-api-login.html#cb14-28" tabindex="-1"></a>                            <span class="at">average_type =</span> <span class="cn">NULL</span>, </span>
<span id="cb14-29"><a href="epfr-api-login.html#cb14-29" tabindex="-1"></a>                            <span class="at">allocation_ids =</span> <span class="cn">NULL</span>, </span>
<span id="cb14-30"><a href="epfr-api-login.html#cb14-30" tabindex="-1"></a>                            <span class="at">assets =</span> <span class="cn">NULL</span>, </span>
<span id="cb14-31"><a href="epfr-api-login.html#cb14-31" tabindex="-1"></a>                            <span class="at">universal_filters =</span> <span class="cn">NULL</span>, </span>
<span id="cb14-32"><a href="epfr-api-login.html#cb14-32" tabindex="-1"></a>                            <span class="at">equity_filters =</span> <span class="cn">NULL</span>, </span>
<span id="cb14-33"><a href="epfr-api-login.html#cb14-33" tabindex="-1"></a>                            <span class="at">bond_filters =</span> <span class="cn">NULL</span>, </span>
<span id="cb14-34"><a href="epfr-api-login.html#cb14-34" tabindex="-1"></a>                            <span class="at">alternative_filters =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="epfr-api-login.html#cb15-1" tabindex="-1"></a><span class="co"># getting flow &amp; net assets start data from the API</span></span>
<span id="cb15-2"><a href="epfr-api-login.html#cb15-2" tabindex="-1"></a>report_id_ff <span class="ot">&lt;-</span> report_ff<span class="sc">$</span>data<span class="sc">$</span>reportId</span>
<span id="cb15-3"><a href="epfr-api-login.html#cb15-3" tabindex="-1"></a><span class="co"># wait for the report to complete previously it has taken ~ 30 seconds</span></span>
<span id="cb15-4"><a href="epfr-api-login.html#cb15-4" tabindex="-1"></a><span class="co"># so that is the initial weight time</span></span>
<span id="cb15-5"><a href="epfr-api-login.html#cb15-5" tabindex="-1"></a><span class="fu">wait_for_completion</span>(report_id_ff, <span class="st">&quot;FF&quot;</span>, <span class="dv">30</span>, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Inital wait for report to complete, delay 30&quot;</code></pre>
<pre><code>## [1] &quot;Report complete: 30 seconds taken&quot;</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="epfr-api-login.html#cb18-1" tabindex="-1"></a>report_result_ff <span class="ot">&lt;-</span> <span class="fu">epfr.get.reportoutput</span>(<span class="st">&quot;FF&quot;</span>, report_id_ff) <span class="co"># extract the data from report</span></span>
<span id="cb18-2"><a href="epfr-api-login.html#cb18-2" tabindex="-1"></a></span>
<span id="cb18-3"><a href="epfr-api-login.html#cb18-3" tabindex="-1"></a><span class="co"># transform data such that it contains only needed columns</span></span>
<span id="cb18-4"><a href="epfr-api-login.html#cb18-4" tabindex="-1"></a>curr_flow_data <span class="ot">&lt;-</span> report_result_ff <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="epfr-api-login.html#cb18-5" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(Date, FundID,<span class="st">`</span><span class="at">Flow US$ mill</span><span class="st">`</span>, <span class="st">`</span><span class="at">Total Net Assets Start</span><span class="st">`</span>))</span>
<span id="cb18-6"><a href="epfr-api-login.html#cb18-6" tabindex="-1"></a></span>
<span id="cb18-7"><a href="epfr-api-login.html#cb18-7" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">dim</span>(curr_flow_data))</span>
<span id="cb18-8"><a href="epfr-api-login.html#cb18-8" tabindex="-1"></a><span class="fu">print</span>(curr_flow_data <span class="sc">%&gt;%</span> <span class="fu">top_n</span>(<span class="dv">10</span>))</span></code></pre></div>
<pre><code>## [1] 200629      4</code></pre>
<pre><code>## Selecting by Total Net Assets Start</code></pre>
<pre><code>##         Date FundID Flow US$ mill Total Net Assets Start
## 1  7/22/2025  14460        0.5472               164576.2
## 2  7/18/2025  14460        0.7913               163995.9
## 3  7/15/2025  14460        1.1877               164019.1
## 4  7/14/2025  14460        0.3411               163990.0
## 5  7/11/2025  14460        0.6604               165373.9
## 6  7/10/2025  14460        0.5022               165113.8
## 7   7/7/2025  14460       84.7347               164311.4
## 8   7/4/2025  14460        0.0000               164311.4
## 9   7/3/2025  14460        1.1156               164137.9
## 10  7/1/2025  14460        1.2995               163790.9</code></pre>
</div>
<div id="calculating-the-country-percent-flow" class="section level3 hasAnchor" number="1.0.4">
<h3><span class="header-section-number">1.0.4</span> Calculating the Country Percent Flow<a href="epfr-api-login.html#calculating-the-country-percent-flow" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To calculate the percentage flow of a country first the country allocation weighted Fund Flows and Net Assets Start must be calculated. For each fund the daily flow and net assets start is multiplied by the monthly country allocation for that fund (this methodoly assumes the same allocation across the month). After each funds weight flow and net assets are calculated they are then summed grouped and summed by date.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="epfr-api-login.html#cb22-1" tabindex="-1"></a><span class="co"># scale the net assets start by the allocations data</span></span>
<span id="cb22-2"><a href="epfr-api-login.html#cb22-2" tabindex="-1"></a>net_asset_start <span class="ot">&lt;-</span> curr_alloc_data <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="epfr-api-login.html#cb22-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FundID =</span> <span class="fu">as.character</span>(FundID)) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="epfr-api-login.html#cb22-4" tabindex="-1"></a>  <span class="co"># join the net assets data to the allocations data on fundid</span></span>
<span id="cb22-5"><a href="epfr-api-login.html#cb22-5" tabindex="-1"></a>  <span class="co"># the inner join makes sure we are only including funds which are in both alloc &amp; flows</span></span>
<span id="cb22-6"><a href="epfr-api-login.html#cb22-6" tabindex="-1"></a>  <span class="fu">inner_join</span>(curr_flow_data, <span class="at">by=</span><span class="st">&quot;FundID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-7"><a href="epfr-api-login.html#cb22-7" tabindex="-1"></a>  <span class="co"># for all country allocations multiply the funds net assets by its holdings</span></span>
<span id="cb22-8"><a href="epfr-api-login.html#cb22-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb22-9"><a href="epfr-api-login.html#cb22-9" tabindex="-1"></a>    <span class="at">.cols =</span> <span class="sc">-</span><span class="fu">c</span>(Date, FundID, <span class="st">`</span><span class="at">Total Net Assets Start</span><span class="st">`</span>, <span class="st">`</span><span class="at">Flow US$ mill</span><span class="st">`</span>),</span>
<span id="cb22-10"><a href="epfr-api-login.html#cb22-10" tabindex="-1"></a>    <span class="at">.fns =</span> <span class="sc">~</span>.<span class="sc">*</span> <span class="st">`</span><span class="at">Total Net Assets Start</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb22-11"><a href="epfr-api-login.html#cb22-11" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(FundID, <span class="st">`</span><span class="at">Total Net Assets Start</span><span class="st">`</span>, <span class="st">`</span><span class="at">Flow US$ mill</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-12"><a href="epfr-api-login.html#cb22-12" tabindex="-1"></a>  <span class="co"># sum all funds net assets start by date (one row for each flow date)</span></span>
<span id="cb22-13"><a href="epfr-api-login.html#cb22-13" tabindex="-1"></a>  <span class="fu">group_by</span>(Date) <span class="sc">%&gt;%</span></span>
<span id="cb22-14"><a href="epfr-api-login.html#cb22-14" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), sum))</span>
<span id="cb22-15"><a href="epfr-api-login.html#cb22-15" tabindex="-1"></a></span>
<span id="cb22-16"><a href="epfr-api-login.html#cb22-16" tabindex="-1"></a><span class="co"># scale the flow by the allocations data</span></span>
<span id="cb22-17"><a href="epfr-api-login.html#cb22-17" tabindex="-1"></a>flow <span class="ot">&lt;-</span> curr_alloc_data <span class="sc">%&gt;%</span></span>
<span id="cb22-18"><a href="epfr-api-login.html#cb22-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FundID =</span> <span class="fu">as.character</span>(FundID)) <span class="sc">%&gt;%</span></span>
<span id="cb22-19"><a href="epfr-api-login.html#cb22-19" tabindex="-1"></a>  <span class="co"># join the flow data to the allocations data on fundid</span></span>
<span id="cb22-20"><a href="epfr-api-login.html#cb22-20" tabindex="-1"></a>  <span class="fu">inner_join</span>(curr_flow_data, <span class="at">by=</span><span class="st">&quot;FundID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-21"><a href="epfr-api-login.html#cb22-21" tabindex="-1"></a>  <span class="co"># for all country allocations multiply the funds flow by its holdings</span></span>
<span id="cb22-22"><a href="epfr-api-login.html#cb22-22" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb22-23"><a href="epfr-api-login.html#cb22-23" tabindex="-1"></a>    <span class="at">.cols =</span> <span class="sc">-</span><span class="fu">c</span>(Date, FundID, <span class="st">`</span><span class="at">Total Net Assets Start</span><span class="st">`</span>, <span class="st">`</span><span class="at">Flow US$ mill</span><span class="st">`</span>),</span>
<span id="cb22-24"><a href="epfr-api-login.html#cb22-24" tabindex="-1"></a>    <span class="at">.fns =</span> <span class="sc">~</span>.<span class="sc">*</span> <span class="st">`</span><span class="at">Flow US$ mill</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb22-25"><a href="epfr-api-login.html#cb22-25" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(FundID, <span class="st">`</span><span class="at">Total Net Assets Start</span><span class="st">`</span>, <span class="st">`</span><span class="at">Flow US$ mill</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-26"><a href="epfr-api-login.html#cb22-26" tabindex="-1"></a>  <span class="co"># sum all funds flow by date (one row for each flow date)</span></span>
<span id="cb22-27"><a href="epfr-api-login.html#cb22-27" tabindex="-1"></a>  <span class="fu">group_by</span>(Date) <span class="sc">%&gt;%</span></span>
<span id="cb22-28"><a href="epfr-api-login.html#cb22-28" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), sum))</span></code></pre></div>
<p>The weighted flow for each flow date is then divided by the weighted net assets start for each date and multiplied by 100 to give the flow percentage for each country on each day.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="epfr-api-login.html#cb23-1" tabindex="-1"></a>flowpct <span class="ot">&lt;-</span> net_asset_start <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="epfr-api-login.html#cb23-2" tabindex="-1"></a>  <span class="co"># join the 2 scaled data frames together</span></span>
<span id="cb23-3"><a href="epfr-api-login.html#cb23-3" tabindex="-1"></a>  <span class="co"># the names of the columns are the same (countries), adding suffixes allows</span></span>
<span id="cb23-4"><a href="epfr-api-login.html#cb23-4" tabindex="-1"></a>  <span class="co"># them to be differentiated</span></span>
<span id="cb23-5"><a href="epfr-api-login.html#cb23-5" tabindex="-1"></a>  <span class="fu">inner_join</span>(flow, <span class="at">by=</span><span class="st">&quot;Date&quot;</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;_NAS&quot;</span>, <span class="st">&quot;_flow&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-6"><a href="epfr-api-login.html#cb23-6" tabindex="-1"></a>  <span class="co"># for each country calculated the flow percent </span></span>
<span id="cb23-7"><a href="epfr-api-login.html#cb23-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb23-8"><a href="epfr-api-login.html#cb23-8" tabindex="-1"></a>    <span class="co"># if a col&#39;s name ends in &quot;flow&quot;</span></span>
<span id="cb23-9"><a href="epfr-api-login.html#cb23-9" tabindex="-1"></a>    <span class="at">.cols =</span> <span class="fu">ends_with</span>(<span class="st">&quot;_flow&quot;</span>),</span>
<span id="cb23-10"><a href="epfr-api-login.html#cb23-10" tabindex="-1"></a>    <span class="co"># divide it by the corresponding &quot;NAS&quot; column and multiply by 100 for percent</span></span>
<span id="cb23-11"><a href="epfr-api-login.html#cb23-11" tabindex="-1"></a>    <span class="at">.fns =</span> <span class="sc">~</span>. <span class="sc">/</span> <span class="fu">get</span>(<span class="fu">sub</span>(<span class="st">&quot;_flow$&quot;</span>, <span class="st">&quot;_NAS&quot;</span>, <span class="fu">cur_column</span>())) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb23-12"><a href="epfr-api-login.html#cb23-12" tabindex="-1"></a>    <span class="co"># name the resulting columns with the suffix flowpct</span></span>
<span id="cb23-13"><a href="epfr-api-login.html#cb23-13" tabindex="-1"></a>    <span class="at">.names =</span> <span class="st">&quot;{sub(&#39;_flow$&#39;, &#39;&#39;, .col)}_flowpct&quot;</span></span>
<span id="cb23-14"><a href="epfr-api-login.html#cb23-14" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb23-15"><a href="epfr-api-login.html#cb23-15" tabindex="-1"></a>  <span class="co"># return the date and flow pct column</span></span>
<span id="cb23-16"><a href="epfr-api-login.html#cb23-16" tabindex="-1"></a>  <span class="fu">select</span>(Date, <span class="fu">ends_with</span>(<span class="st">&quot;_flowpct&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-17"><a href="epfr-api-login.html#cb23-17" tabindex="-1"></a>  <span class="co"># make sure the dataframe is in chronological order</span></span>
<span id="cb23-18"><a href="epfr-api-login.html#cb23-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">chrdate_to_flowdate_vec</span>(Date)) <span class="sc">%&gt;%</span></span>
<span id="cb23-19"><a href="epfr-api-login.html#cb23-19" tabindex="-1"></a>  <span class="fu">arrange</span>(Date) <span class="sc">%&gt;%</span></span>
<span id="cb23-20"><a href="epfr-api-login.html#cb23-20" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">&quot;Date&quot;</span>)</span>
<span id="cb23-21"><a href="epfr-api-login.html#cb23-21" tabindex="-1"></a></span>
<span id="cb23-22"><a href="epfr-api-login.html#cb23-22" tabindex="-1"></a><span class="co"># remove the suffixes from the col names </span></span>
<span id="cb23-23"><a href="epfr-api-login.html#cb23-23" tabindex="-1"></a><span class="fu">names</span>(flowpct) <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">&quot;_flowpct$&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="fu">names</span>(flowpct))</span>
<span id="cb23-24"><a href="epfr-api-login.html#cb23-24" tabindex="-1"></a></span>
<span id="cb23-25"><a href="epfr-api-login.html#cb23-25" tabindex="-1"></a><span class="fu">print</span>(flowpct <span class="sc">%&gt;%</span> <span class="fu">select</span>(Australia, Brazil, China, USA) <span class="sc">%&gt;%</span> <span class="fu">top_n</span>(<span class="dv">10</span>))</span></code></pre></div>
<pre><code>## Selecting by USA</code></pre>
<pre><code>##           Australia       Brazil       China        USA
## 20250624 0.02814600  0.010621314  0.01542774 0.03011692
## 20250627 0.07079336  0.056281552  0.06516586 0.02489238
## 20250701 0.04896777  0.084789350  0.07174432 0.07218193
## 20250703 0.03882079  0.139505120  0.16125639 0.12071612
## 20250709 0.07453717  0.035208509  0.03830671 0.01530975
## 20250711 0.06000156  0.009118258  0.02200542 0.11023197
## 20250714 0.02804328 -0.044157245 -0.02217098 0.02310832
## 20250715 0.04548059  0.026941196  0.05393027 0.02077438
## 20250718 0.03702452  0.036319201  0.07681542 0.04847699
## 20250721 0.03361252  0.013082389  0.05924426 0.02805010</code></pre>
<p>Finally save resulting data frame to your preferred directory</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="epfr-api-login.html#cb26-1" tabindex="-1"></a><span class="co"># Optional - write dataframe to disk</span></span>
<span id="cb26-2"><a href="epfr-api-login.html#cb26-2" tabindex="-1"></a>dir <span class="ot">&lt;-</span> path to your working directory</span>
<span id="cb26-3"><a href="epfr-api-login.html#cb26-3" tabindex="-1"></a><span class="fu">mat.write</span>(flowpct, <span class="fu">paste0</span>(dir, <span class="st">&quot;FlowCtryPct_&quot;</span>, alloc_month ,<span class="st">&quot;.csv&quot;</span>))</span></code></pre></div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="flow-percentage-country-strategy.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="multi-asset-region-strategy.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": true,
    "facebook": false,
    "twitter": false,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": false
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/EPFR/EPFR-QuantNotebooks/docs/00-EPFRAPI.Rmd",
    "text": "Suggest an edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "section"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
