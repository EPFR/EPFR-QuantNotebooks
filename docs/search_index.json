[["index.html", "EPFR Strategy Notebooks 1 Introduction", " EPFR Strategy Notebooks 1 Introduction The objectives of this notebook are; to present EPFRs proof of concept strategies, so that readers have a profound understanding of their inputs and composition. to enable the reader to construct signals and find initial value in the data. This book has ten proof-of-concept strategies created by Quantitative Analysts at EPFR. The backtesting methodology across each of these is relatively similar. They are quintile based, long/short, and we apply similar lookback periods for our backtests. We use a standard backtest period because we seek to avoid optimizing any one strategy. Our goal is to help the reader to construct a signal from EPFRs data, from which they can build off of and optimize for their own use cases. For this type of testing on our data, we provide the time series file available for download. To access the files you can find them readily available on the FTP, or email our team for assistance: click here. "],["epfr-library.html", "2 EPFR Library 2.1 About 2.2 Strategy Functions 2.3 FTP Functions", " 2 EPFR Library The EPFR Library has an extensive list of applicable functions for use on our data and will be used in this demonstration of our strategies. To install the library EPFR, click here to download zip from github or you can find code to do this below. library(&quot;devtools&quot;) install_github(&quot;oliviablasz/EPFRLibraryTEST&quot;) #PLACEHOLDER library(&quot;EPFRLibraryTEST&quot;) 2.1 About This library includes a variety of different functions that can help create signals, rank factors, evaluate performance of strategies, along with a list of other useful tools for handling EPFR data. To learn more please refer to the library documentation for all of the descriptions and complete list of parameters for each function. 2.2 Strategy Functions Compunding Flows EPFRs function compound.flows() uses other functions within library('EPFR') to compute a rolling cumulative sum of flows over a trailing lookback period (typically we use 20 days). compound.flows &lt;- function(x, y, n = F) { # ----------------------------------------------------------------- # Args : x = a matrix/data-frame of percentage flows # : y = number of trailing rows to compound/sum # : n = if T, flows get summed. Otherwise they get compounded. # Output : compounded flows over &lt;n&gt; trailing periods indexed by last day in the flow window # ----------------------------------------------------------------- # # FIND NA&#39;s : # creates new df with value of 1 for all non-NA flows, else NA h &lt;- nonneg(mat.to.obs(x)) # # PRELIMINARIES : # convert all NA values to 0 in order to do computations # convert to log form z &lt;- zav(x) if (!n) z &lt;- log(1 + z/100) # # ROLLING WINDOWS # calculate rolling sum # reverse log form z &lt;- mat.rollsum(z, y) if (!n) z &lt;- 100 * exp(z) - 100 # # ENSURE FINAL DATE IN EACH ROLLING WINDOW IS NON-NA # multiply compounded flow matrix by h (1/NA df) z &lt;- z * h # # RETURN RESULT z } Please refer to the library documentation for more details. Model EPFRs function bbk() creates a standardized backtest model based on our inputs (e.g.Â ranking factors into 5 equal baskets based on compounded flows). bbk &lt;- function(x, y, floW = 1, retW = 5, nBin = 5, doW = NULL, sum.flows = F, lag = 0, delay = 2, idx = NULL, prd.size = 1, sprds = F) { # ----------------------------------------------------------------- # Args : x = predictor indexed by yyyymmdd or yyyymm (compounded percentage flow) # : y = total return index indexed by the same date format as &lt;x&gt; # : floW = number of &lt;prd.size&gt;&#39;s over which the predictor should be compounded/summed # : retW = return window in days or months depending on whether &lt;x&gt; is YYYYMMDD or YYYYMM # : nBin = number of bins to divide the variable into # : doW = day of the week you will trade on (5 = Fri) # : sum.flows = T/F depending on whether &lt;x&gt; should be summed or compounded # : lag = predictor lag in days or months depending on whether &lt;x&gt; is YYYYMMDD or YYYYMM # : delay = delay in knowing data in days or months depending on whether &lt;x&gt; is YYYYMMDD or YYYYMM # : idx = the index within which you are trading # : prd.size = size of each period in days or months depending on whether &lt;x&gt; is YYYYMMDD or YYYYMM # : sprds = T/F depending on whether spread changes, rather than returns, are needed # Output : standard model output # ----------------------------------------------------------------- # # GET DATA x &lt;- bbk.data(x, y, floW, sum.flows, lag, delay, doW, retW, idx, prd.size, sprds) # # BIN RETURNS z &lt;- lapply(bbk.bin.xRet(x$x, x$fwdRet, nBin, T, T), mat.reverse) # # SUMMARY z &lt;- c(z, bbk.summ(z$rets, z$bins, retW, ifelse(is.null(doW), 1, 5))) # # RETURN RESULT z } Please refer to the library documentation for more details. Example Step 1: Compounding Flows x &lt;- mat.read(&quot;DailyPercentageFlow.csv&quot;) x &lt;- compound.flows(x, lookback = 20) Step 2: Define variables y &lt;- mat.read(&quot;ETFCountryReturns.csv&quot;) # Return file hz &lt;- c(5, 10, 20, 45, 65, 130) # RETURN HORIZON (IN WEEKDAYS OR MONTHS) - holding periods nBin &lt;- 5 # Number of bins (to sort) doW &lt;- 5 # Day of the week to trade on delay &lt;- 2 # Delay in getting the data (able to trade on data @ T+2) idx &lt;- &quot;ACWI&quot; # Optional: Universe that is being used for signal (e.g. ACWI/EM/EAFE/G10) Step 3: Create standardized backtest model z &lt;- bbk(x, y, 1, hz[1], nBin, doW, T, 0, delay, idx) Step 4: Evaluate output z[[&quot;raw&quot;]] # Flow percentage compounded over trailing 20 days z[[&quot;raw.fwd.rets&quot;]] # One-week ahead return (Friday to Friday) z[[&quot;bins&quot;]] # Twenty-day flow percentage ranked into quintiles (computed only where forward returns are available) z[[&quot;rets&quot;]] # Quintile Returns over the equal-weight universe Step 5: Re-balance as needed Step 6: Find Annualized mean one-week returns bbk(x, y, 1, hz[1], 5, doW, T, 0, delay)$annSumm 2.3 FTP Functions Below are some functions built in library('EPFR) that connect a local R workspace to FTP server for convince accessing and working directly with data. () RCurl Functions built in library('EPFR) which give access to files on EPFRs ftp require the RCurl library. library(RCurl) Extract FTP File Path ftp.parent &lt;- function(x) { # ----------------------------------------------------------------- # Args : x = a string of full paths # Output : returns paths to the parent directory # ----------------------------------------------------------------- z &lt;- dirname(x) z &lt;- ifelse(z == &quot;.&quot;, &quot;&quot;, z) z } Extract FTP File Name ftp.file &lt;- function(x) { # ----------------------------------------------------------------- # Args : x = a string of full paths # Output : strips out parent directory, returning just the file name # ----------------------------------------------------------------- txt.right(x, nchar(x) - nchar(ftp.parent(x)) - 1) } Download FTP file ftp.get &lt;- function(x, y, n, w, h, u = &quot;ftp&quot;, v = F) { # ----------------------------------------------------------------- # Args : x = remote file on an ftp site (e.g. &quot;/ftpdata/mystuff/EPFRdata.txt&quot;) # : y = local folder (e.g. &quot;C:\\\\temp&quot;) # : n = ftp site (defaults to standard - filetransport.epfrglobal.com) # : w = user id # : h = password # : u = protocol (either &quot;ftp&quot; or &quot;sftp&quot;) # : v = T/F flag for ftp.use.epsv argument of getCurlHandle # Output : file &lt;x&gt; from remote site # ----------------------------------------------------------------- # GET DATA z &lt;- getCurlHandle(ftp.use.epsv = v, userpwd = paste0(w, &quot;:&quot;, h)) z &lt;- getBinaryURL(paste0(u, &quot;://&quot;, n, x), curl = z) writeBin(z, con = paste0(y, &quot;\\\\&quot;, ftp.file(x))) # RETURN NOTHING invisible() } Example To download a desired ftp file you can set the file path to the csv file that will be used for your strategy and a local folder that this file will be downloaded to: file &lt;- &quot;EPFRHistory/Strategies/daily/FloPctCtry-daily.csv&quot; # FTP FILE - FloPctCtry-daily.csv fldr &lt;- &quot;C:\\\\temp&quot; # LOCAL FOLDER Next you will enter your username and password: usr &lt;- &quot;YOUR USER NAME&quot; # FTP USERNAME pwd &lt;- &quot;YOUR PASSWORD&quot; #FTP PASSWORD Now you can call ftp.get() with the following inputs: ftp.get(file, fldr, &quot;filetransport.epfrglobal.com&quot;, usr, pwd, &quot;ftp&quot;) # DOWNLOADS FILE FROM FTP TO LOCAL FOLDER, USING CREDENTIALS After the file is downloaded the flow files local path can be easily stored with follow line: flow.file &lt;- paste(fldr, ftp.file(file), sep = &quot;\\\\&quot;) # STORES FLOW FILE PATH "],["Filters.html", "3 Filters", " 3 Filters EPFR has an extensive list of over two dozen filters that can be applied to our data sets, therefore the signals we can get can be fine-tuned. The data can be filtered by: Investor Type (retail or institutional) Share class Fund domicile Theme (ESG, Sharia, ect.) Currency of flows Individual managers Duration Style Sector Working with Cam &amp; Steve on adding some sort of tutorial/guide on this "],["flow-percentage-country-strategy.html", "4 Flow-Percentage Country Strategy 4.1 Overview 4.2 Daily Percentage Flow 4.3 Strategy Implementation", " 4 Flow-Percentage Country Strategy 4.1 Overview The Flow-Percentage Country Strategy is an equity based rotation strategy, which ranks different countries across a customized universe of both developed and emerging markets. This approach uses the stated allocations of equity funds with a cross-border focus and calculates percentage flow into countries. In terms of twenty-day percentage flows, the top fifth of ACWI countries outperform the bottom fifth by over 3% per year. The strategy works best in Emerging Markets, but adds value across the board. 4.2 Daily Percentage Flow The Flow-Percentage Country Strategy developed by EPFR Global is based on percentage flow into countries. In this section, the reader will gain an understanding of the aggregations which can be used to create a signal as well as the methodology behind daily percentage flow calculations. 4.2.1 Aggregations The first step is defining a subset of data to capture in calculating our signal. This strategy requires; Equity funds with a cross-boarder focus. These are essentially any fund that has a mandate spanning more than one country. The vast majority of these will be global and regional funds. Funds must report both daily flows and country allocations, since these values are needed to calculate Daily Percentage Flow. Cross-border equity funds, which report their country allocations and their fund flows, are a subset of those that only report their fund flows to EPFR. The figure below shows EPFRs coverage of this universe over time compared to our total coverage. Updated at the end of July each year Users looking for more specific detail can customize this aggregation even further using EPFRs fund-level or share class-level granularity. Some good examples would be Active/Passive, ETF or Mutual funds, Institutional or Retail. Users can use these tags to different degrees in creating aggregated signals to backtest. Further detail about this is available in section 3. This can be achieved using fund-level flow files or reaching out to EPFRs quant team for customized aggregations. 4.2.2 Calculation To begin calculating the Daily Percentage flow, we start with our subset of cross-border equity funds. To calculate the funds impact on a country, we scale a funds flow by multiplying it against its stated country allocation, which is available in EPFRs Country Allocation Database, on that day. EPFR releases country allocations of all funds on the \\(23^{\\text{rd}}\\) of each month (or the next available business day) at a monthly frequency. Hence, our calculation assumes constant country allocation between two consecutive release dates within the month. We then apply the same procedure to all funds with a fund flow and country allocation information and then sum the flows for each country across all funds. \\[\\text{Total Impact}_{c,t} = \\sum^{N}_{i=m}{\\text{Flow}_i \\times \\text{Allocation}_i}\\] Where: \\(\\text{Total Impact}\\) = the impact on a country \\(c\\), across all funds \\(i\\), for day \\(t\\) Additionally, we repeat the process across the same funds Assets held under Management (AuM), to get the total AuM held in a country. \\[\\text{Total AuM}_{c,t} = \\sum^{N}_{i=m}{\\text{AuM}_i \\times \\text{Allocation}_i}\\] Where: \\(\\text{Total AuM}\\) = the assets held in a country \\(c\\), across all funds \\(i\\), for day \\(t\\) Finally, to find the daily percentage flow for a country, we divide the Total Impact by the Total AuM. Then we repeat this across all different countries for the entire history. \\[\\text{Percentage Flow}_{c,t} = \\frac{\\text{Total Impact}_{c,t}}{\\text{Total AuM}_{c,t}}\\] Where: \\(\\text{Percentage Flow}\\) = the scaled flow as a percentage into a country \\(c\\), across all funds \\(i\\), for day \\(t\\) 4.2.3 Flow File The users may create flow percentages for their desired country aggregations and granularity using the methodology described in the previous section. EPFR also provides a pre-calculated aggregation for its users for the Daily Flow-Percentage Country Strategy. This file can be found on the FTP under the strategies folder. Please refer to the FTP Folder Structure section for the exact location of this file. This file contains daily cross-border equity fund flow data for 52 countries and is updated daily at 5:00 PM est. with a T+1 day lag. For this demonstration, we use the pre-calculated file FloPctCtry-daily.csv. Below shows a snippet of what this file contains. AU BR CA CN ID IN JP KR MX MY PH RU SG TH TR TW ZA AR CL CO CZ EG HU IL NZ NO PE PL SE CH GB AT BE DK FI FR DE GR IE IT NL PT ES HK US JO MA PK AE QA SA KW 20220201 0.0682839 0.0084836 0.1025408 0.0139744 0.0221570 0.0205982 0.0548555 0.0319277 0.0060054 0.0221536 0.0286116 0.0230859 0.0379905 0.0195777 0.0146236 0.0208210 0.0363276 0.0807825 0.0289586 0.0385508 0.0306830 0.0330318 0.0469420 0.0361752 0.0453934 0.1034383 -0.0009420 0.0483840 0.0732804 0.0681679 0.0814963 0.1422620 0.1951290 0.0597506 0.2557560 0.1649068 0.1873234 0.0161138 0.1056664 0.1899218 0.1672633 0.1732925 0.1840847 0.0328124 0.0580442 0.1000220 0.1490446 -0.0443664 0.0431735 0.0427901 0.0462380 0.0299807 20220202 0.1071915 0.0281719 0.0950954 0.0202414 0.0344230 0.0163766 0.1111745 0.0417981 0.0245983 0.0504768 -0.0090245 0.0232131 0.0608292 0.0215472 -0.0117807 0.0184948 0.0378151 0.0529031 0.0224223 0.0489514 0.0360707 0.0268137 0.0133663 0.0955032 0.0783371 0.1482123 0.0650883 0.0575084 0.1073821 0.1102016 0.1021990 0.1753984 0.2864324 0.0724588 0.3588564 0.1960113 0.2311478 0.0461036 0.1557974 0.2426154 0.1954004 0.3344284 0.2244875 0.0394673 0.1199526 0.1302887 0.0396339 -0.0027174 0.0435513 0.0366501 0.0279959 0.0179536 20220203 0.0232839 0.0232704 0.0761505 0.0289616 0.0273847 0.0345332 0.0218809 0.0518640 0.0100158 0.0419875 0.0341742 0.0317831 0.0142656 0.0407090 -0.0425790 0.0449413 0.0516080 -0.0154822 0.0202419 0.0298686 0.0427326 -0.0100498 0.0006513 0.0224383 0.0630011 0.0594039 0.0454787 0.0349888 0.0310588 0.0406977 0.0843723 0.0592398 0.0618084 0.0473398 0.0813880 0.0405348 0.0415332 0.0349092 0.0467131 0.0649067 0.0371971 0.0825533 0.0770435 0.0275676 0.0901542 0.0017727 0.0246136 -0.0329425 0.0539309 0.0525786 0.0450357 0.0293389 20220204 0.0427605 0.0005431 0.0182251 0.0287499 0.0712703 0.0435060 0.0363027 0.0484562 -0.0030307 0.0577206 0.0478340 -0.1376946 0.0192682 0.0321432 -0.1510468 0.0421362 0.0360338 0.0059707 0.0473132 0.0457560 0.0483058 -0.0528643 -0.1633261 -0.0060812 0.0199169 0.0299800 -0.0224904 -0.1080532 0.0151556 0.0154724 0.0360337 0.0249990 0.0172963 -0.0035172 0.0360927 0.0188039 0.0210176 -0.0338378 0.0008837 0.0172023 0.0118729 0.0078131 0.0379598 -0.0100599 0.0647590 -0.0866469 0.0035331 0.0121018 0.0245301 0.0388262 0.0097923 0.0293662 20220207 0.0441435 0.0664523 0.0375737 0.0818605 0.0600913 0.0626405 0.0510620 0.0711956 0.0639915 0.1208601 0.0704777 -0.0070066 0.0388531 0.1213585 -0.0351091 0.0684053 0.1530069 0.0202382 0.0663745 0.0377460 0.0608658 0.0361060 -0.0094240 0.0387820 0.0365660 0.0762125 0.0265846 -0.0243340 0.0134566 0.0106205 0.0437974 0.0323487 0.0402917 -0.0128579 0.0555223 0.0155998 0.0353678 0.0139098 0.0200929 0.0320488 -0.0032316 0.0231484 0.0331243 0.0682547 0.0168594 -0.0235971 0.3344607 0.1606458 0.0998821 0.1439076 0.0371702 0.0266549 20220208 0.0755702 0.1394943 0.0547752 0.0364907 0.0922338 0.0896671 0.0667618 0.0688405 0.1180297 0.1237705 0.0781433 -0.0512573 0.0673441 0.1097059 -0.0799028 0.0898746 0.1163105 0.0313015 0.0910412 0.0432795 0.0653109 0.1015608 -0.1620651 0.0553638 0.0604454 0.0494414 0.1915267 -0.0821655 0.0221925 0.0278058 0.0287122 0.0487003 0.0518997 -0.0119569 0.0578275 0.0392554 0.0331660 -0.0396982 0.0050530 0.0597397 0.0194525 0.0270428 0.0478461 -0.0445550 0.0560942 0.0545403 0.0111911 -0.0012755 0.1037661 0.1163175 0.1036285 0.0850615 We will download this file from the ftp using ftp.get(), more about this function can be referred to in section 2.3. file &lt;- &quot;EPFRHistory/Strategies/daily/FloPctCtry-daily.csv&quot; # PATH TO .csv FILE fldr &lt;- &quot;C:\\\\temp&quot; # LOCAL FOLDER ftp.get(file, fldr, &quot;filetransport.epfrglobal.com&quot;, w = &quot;username&quot;, h = &quot;password&quot;, &quot;ftp&quot;) # DOWNLOADS FILE FROM FTP TO LOCAL FOLDER, USING CREDENTIALS After downloading the csv file you will store its path as flow.file. A quick way to do this is shown below: flow.file &lt;- paste(fldr, ftp.file(file), sep = &quot;\\\\&quot;) # STORES FLOW FILE PATH, C:\\\\temp\\\\FloPctCtry-daily.csv 4.2.4 Return File The return file for this strategy should contain daily equity returns for each of the countries in the flow file, which the user can find with their own resources. EPFR also provides Fund Return data, that can be used as a proxy to returns. To create a return file using EPFR daily flow data, the following equation can be used: \\[\\text{Fund Return}_{c,t} = \\frac{\\sum^{N}_{i=m} \\text{Portfolio Change}_i}{\\sum^{N}_{i=m} \\text{Assets Start}_i}\\] Where: \\(\\text{Fund Return}\\) = the return value of country \\(c\\), across all funds \\(i\\), for day \\(t\\) For this demonstration, we will use a file that has calculated returns using EPFR daily flow data, which has been locally named ETFCountryReturns.csv. ret.file &lt;- &quot;ETFCountryReturns.csv&quot; For your reference a snippet of our return file looks like this AU BR CA CN ID IN JP KR MX MY PH RU SG TH TR TW ZA AR CL CO CZ EG HU IL NZ NO PE PL SE CH GB AT BE DK FI FR DE GR IE IT NL PT ES HK US PK AE QA SA KW 20220201 1.216153 0.9016166 1.848297 1.877648 0.8810507 1.840429 1.537664 1.303538 1.535172 0.7575718 0.9317495 1.236400 1.197279 1.047307 0.4112086 2.754831 1.917478 1.580909 0.7649221 0.8232780 1.260463 0.5450894 1.288094 2.012249 1.623388 1.585561 1.190278 0.9101336 2.341319 1.871180 1.660703 2.139739 1.332858 4.050880 2.673355 2.094102 1.905758 0.6483668 1.518307 2.464057 2.677256 0.8455714 1.642391 1.585187 3.162870 0.4981388 0.8767887 0.9909682 1.560791 1.528031 20220202 1.229971 0.8914860 1.854747 1.876020 0.8843670 1.852444 1.567557 1.304787 1.542828 0.7579900 0.9444344 1.235136 1.195559 1.047929 0.4067939 2.758704 1.918054 1.551835 0.7516109 0.8187220 1.277934 0.5488876 1.276596 2.015293 1.652679 1.595796 1.184149 0.9296423 2.359213 1.873940 1.672066 2.160430 1.338070 4.141353 2.672666 2.099197 1.905684 0.6551584 1.528388 2.481204 2.680701 0.8503853 1.643611 1.587420 3.190279 0.5038590 0.8798715 0.9955980 1.544955 1.527794 20220203 1.226963 0.8883007 1.833780 1.873542 0.8799717 1.826094 1.552677 1.316727 1.517052 0.7617148 0.9347483 1.206224 1.214456 1.048969 0.3961473 2.746480 1.914590 1.504623 0.7286515 0.8114083 1.292432 0.5449740 1.275142 1.961160 1.659353 1.583173 1.162599 0.9313575 2.310394 1.851140 1.659340 2.151387 1.320238 4.033247 2.629636 2.067067 1.877527 0.6513808 1.505205 2.454486 2.617539 0.8495833 1.642705 1.584409 3.108921 0.5044404 0.8757572 0.9996700 1.533813 1.528008 20220204 1.233514 0.8882288 1.845554 1.881782 0.8842343 1.824873 1.562143 1.336320 1.518061 0.7622830 0.9406746 1.218201 1.222897 1.056475 0.3914212 2.743207 1.916969 1.509815 0.7180452 0.8152001 1.284537 0.5453844 1.259993 1.978811 1.657073 1.591187 1.169147 0.9087460 2.284492 1.837019 1.655472 2.143534 1.304880 3.944003 2.595245 2.053071 1.847395 0.6503386 1.501491 2.411192 2.615541 0.8519894 1.630650 1.609301 3.125973 0.5079538 0.8767967 1.0008716 1.534457 1.529081 20220207 1.233101 0.8934258 1.844329 1.871690 0.8957612 1.802879 1.556472 1.321601 1.518591 0.7650501 0.9275738 1.219366 1.235957 1.060229 0.3999828 2.766496 1.925832 1.518986 0.7278336 0.8209700 1.290253 0.5437079 1.248669 1.983558 1.652063 1.608149 1.174699 0.9106971 2.302398 1.844615 1.667302 2.154655 1.311711 3.964043 2.634784 2.068715 1.858852 0.6465406 1.517363 2.379000 2.639204 0.8479773 1.619189 1.619199 3.114157 0.5073301 0.8790720 1.0012910 1.549670 1.532303 20220208 1.246383 0.8951421 1.855057 1.880200 0.8947920 1.809617 1.562096 1.321507 1.545723 0.7654877 0.9348395 1.257207 1.250049 1.067788 0.4053601 2.780996 1.943669 1.529488 0.7385582 0.8161895 1.306226 0.5437769 1.254819 1.992795 1.658260 1.587118 1.224245 0.9296387 2.295751 1.837115 1.667085 2.173732 1.318192 3.890220 2.629188 2.075322 1.863715 0.6521946 1.519889 2.388347 2.643522 0.8479773 1.641555 1.637959 3.142427 0.5085918 0.8845530 1.0013951 1.548731 1.541016 4.3 Strategy Implementation The final step is implementing this strategy to create a signal. Lets begin by reading in the flow and return files to our R studio work space. x &lt;- read.csv(flow.file, row.names = 1) # GET FLOW PERCENTAGE y &lt;- read.csv(ret.file, row.names = 1) # GET RETURN One of our first options is choosing the universe we want to use. EPFR has tested this signal within three different universes of countries ACWI (All Country World Index), EAFE (Europe, Australasia, and the Far East (EAFE), and EM (Emerging Markets). For this example, we choose ACWI, which includes 52 countries. idx &lt;- &quot;ACWI&quot; Then, to subset the flow file \\(x\\) to the selected universe \\(idx\\) the function Ctry.msci.members.rng() from the library('EPFR') is used. This function returns a list of two letter country codes from \\(idx\\) that are in \\(x\\). x &lt;- x[, is.element(dimnames(x)[[2]], Ctry.msci.members.rng(idx, dimnames(x)[[1]][1], dimnames(x)[[1]][dim(x)[1]]))] # SUBSET TO INDEX COUNTRIES We will also subset the return file \\(y\\) to use the same countries as \\(x\\). y &lt;- y[, dimnames(x)[[2]]] # TOTAL RETURN INDEX * Note: subsetting can be also be done when creating the flow and return files 4.3.1 Compounding Flows Next, we set up a variable for our look-back period, which can also be called a flow window. This variable will be the window of time we use to create a trailing compounded daily percentage flow. The look-back period we choose for our demonstrations is 20 days. lookback &lt;- 20 # FLOW WINDOW (IN WEEKDAYS) - 20 day look back period Again, using a function from the library('EPFR'), compound.flows() compounds the daily percentage flow over the trailing lookback period for each country. x &lt;- compound.flows(x, lookback, F) # COMPOUND FLOWS AU BR CA CN ID IN JP KR MX MY PH RU SG TH TR TW ZA AR CL CO CZ EG HU IL NZ NO PE PL SE CH GB AT BE DK FI FR DE GR IE IT NL PT ES HK US PK AE QA SA KW 20220201 1.695092 0.8956733 2.063833 0.7271091 0.9426943 0.6964292 1.524033 0.7990852 0.8919134 1.419051 1.1535678 0.4800635 1.386685 1.1331340 0.7235974 0.7281222 1.173349 1.0277834 1.386671 1.471901 0.9313852 0.6540640 0.6566465 1.339803 1.0970795 1.552139 0.8404185 0.8089432 1.1812861 1.283772 1.497817 1.503535 1.560870 0.9719636 1.683330 1.243455 1.289938 0.7314205 0.7206113 1.350597 1.0910952 1.286315 1.486433 1.1533874 2.313395 0.4031779 1.264408 1.358975 1.0466353 1.1042466 20220202 1.731964 0.8687557 2.107286 0.6759108 0.9247791 0.6658331 1.576946 0.7954228 0.8679853 1.424527 1.0902695 0.4632308 1.375429 1.1067276 0.6855281 0.6992272 1.160812 0.9444863 1.351930 1.439832 0.9319557 0.6695283 0.6210998 1.382906 1.1010139 1.621488 0.8452453 0.8271424 1.1984612 1.314368 1.528429 1.637728 1.762992 0.9517786 1.974771 1.374431 1.448574 0.7374430 0.7875962 1.525683 1.2042251 1.579271 1.633617 1.0697399 2.347465 0.4403477 1.261515 1.360978 1.0510618 1.0949054 20220203 1.626377 0.8394779 2.008515 0.6186800 0.9012758 0.6484295 1.484440 0.7754210 0.8147986 1.367550 1.0516171 0.4365379 1.300942 1.0765942 0.5912039 0.6969822 1.137966 0.7878565 1.281467 1.325633 0.8817094 0.5708724 0.5845868 1.310560 1.0288271 1.553199 0.7619803 0.7985394 1.1333105 1.257788 1.512803 1.653864 1.736619 0.9125970 1.965527 1.341146 1.414505 0.6974852 0.7699205 1.514267 1.1654000 1.617363 1.624691 0.9448688 2.229203 0.3404675 1.202900 1.301223 0.9995534 1.0231983 20220204 1.532328 0.7811643 1.865744 0.5606279 0.8625573 0.5768271 1.386277 0.7413796 0.7480784 1.234843 0.9345539 0.1735295 1.168880 0.9548012 0.3243255 0.6274899 1.037028 0.7479860 1.226853 1.222101 0.7797623 0.3770805 0.2687186 1.178456 0.9312816 1.472652 0.7328853 0.5678964 1.0401687 1.162474 1.442076 1.587797 1.638086 0.8283374 1.895316 1.278650 1.346514 0.5347725 0.7117450 1.441525 1.0977623 1.537649 1.566137 0.8849444 2.161350 0.1563037 1.079144 1.177267 0.8612783 0.8826006 20220207 1.484031 0.8280083 1.767824 0.6146402 0.9132366 0.6335915 1.343931 0.7838898 0.7867806 1.335617 0.9728531 0.1568496 1.135682 1.0657497 0.2825486 0.6881150 1.173333 0.6562403 1.271845 1.236586 0.8385317 0.4077192 0.2483390 1.171250 0.8620616 1.485546 0.7361149 0.5072493 0.9914315 1.111113 1.430715 1.572091 1.612114 0.7573199 1.887822 1.248030 1.333999 0.5369278 0.7054003 1.419109 1.0501459 1.507637 1.549178 0.8539385 2.057653 0.3096477 1.165577 1.309447 0.8906014 0.8999861 20220208 1.472706 0.8185676 1.717035 0.5876077 0.9343163 0.6396381 1.333841 0.8166971 0.7622232 1.306481 0.9213935 0.0440313 1.154466 1.0494184 0.0861126 0.6916074 1.178620 0.6119710 1.173741 1.073762 0.8073279 0.3716791 0.0258098 1.156309 0.8464903 1.464266 0.8147882 0.3813900 0.9353056 1.064155 1.363201 1.585702 1.587684 0.6574123 1.839468 1.218158 1.311485 0.4054928 0.6356833 1.413500 0.9914214 1.451665 1.522581 0.7958580 2.074265 0.0245053 1.125824 1.274673 0.8534067 0.8333133 4.3.2 Ranking Countries Next, we sort the countries in each universe into five equal bins based on their 20-day Percentage Flow Compounded value for the selected holding period. To do this, we will use the function from library('EPFR'), called bbk(). This function will output a standardized backtest result. The bbk() function requires our compounded daily percentage flow file, a return file, and our selected universe. Please refer to the library documentation for the complete list of parameters of this function. The first parameter we add is the number of bins we want to use. For our case, we want to use 5 because our strategy is to go long the top fifth and short the bottom fifth. nBin &lt;- 5 # NUMBER OF BINS Since EPFR data is published with T+1 day lag and is released around 5:00 pm EST, we account for a T+2 day delay in our model since that is when one can trade on the information. Users interested in more timely signals can also use the T+2 Open Prices for backtesting purposes. EPFR also offers a Premium Daily offering, an earlier release of the end-of-day data covering a significant subset of fund-level flow information. delay &lt;- 2 # DELAY IN KNOWING DATA (IN WEEKDAYS) - data takes time to have It is also important to note that this model will need to be re-balanced weekly. The day of the week the rebalancing occurs is at the discretion of the user. For this example we will set the day of the week to trade as Friday. doW &lt;- 5 # DAY OF THE WEEK YOU WILL TRADE ON (5 = FRIDAYS) Additionally, we also evaluate the returns for different holding periods. The user can input return horizons that they are interested in here. For this example we define a return horizon for weekly, fortnightly, monthly, bi-monthly, quarterly, and semi-annually. hz &lt;- c(5, 10, 20, 45, 65, 130) # RETURN HORIZON (IN WEEKDAYS) - holding periods Now that we have defined all of our inputs, to rank the countries into quintiles by their 20-day percentage flow, we call function bbk() for a 1-week holding period. z &lt;- bbk(x, y, 1, hz[1], nBin, doW, T, 0, delay, idx) 4.3.3 Model Twenty-day flow percentage ranked into quintiles (computed only where forward returns are available) z[[&quot;bins&quot;]] AU BR CA CN ID IN JP KR MX MY PH RU SG TH TR TW ZA AR CL CO CZ EG HU IL NZ NO PE PL SE CH GB AT BE DK FI FR DE GR IE IT NL PT ES HK US PK AE QA SA KW 20220225 3 1 3 3 2 4 2 4 1 1 2 5 4 1 5 3 1 NA 1 1 3 5 4 5 5 1 1 5 4 4 2 3 2 5 1 4 3 4 5 2 5 3 3 3 5 NA 2 2 2 4 20220218 3 2 2 4 3 5 2 4 3 1 3 5 3 2 5 4 2 NA 1 1 4 5 5 4 5 1 3 5 4 3 2 1 1 5 1 2 2 5 5 1 4 3 1 4 2 NA 3 1 3 4 20220211 2 4 1 5 3 5 2 4 4 2 3 5 3 3 5 5 2 NA 2 3 4 5 5 3 5 1 4 5 3 3 1 1 1 4 1 2 2 5 4 1 3 1 1 4 1 NA 2 2 3 4 20220204 1 4 1 5 4 5 1 5 4 2 3 5 2 3 5 5 3 NA 3 2 4 5 5 2 3 1 4 4 3 3 2 1 1 4 1 2 2 5 5 2 3 1 1 4 1 NA 3 2 4 3 Quintile Returns over the equal-weight universe z[[&quot;rets&quot;]] Q1 Q2 Q3 Q4 Q5 TxB uRet 20220225 5.2910368 2.8962912 -0.4855041 -0.4607084 -6.9975571 12.2885940 -4.6152826 20220218 1.1741643 1.5396248 1.8426982 0.5842906 -4.9283863 6.1025506 -2.7415387 20220211 -1.0651267 0.5892771 0.8472477 0.1733038 -0.4684438 -0.5966829 -0.9261476 20220204 -0.5636523 -0.3544004 0.0887137 1.0192039 -0.1233846 -0.4402677 1.3032221 4.3.4 Performance Go long the top basket and short the bottom basket. Performance over all holding periods fcn &lt;- function(retW) {as.matrix(bbk(x, y, 1, retW, 5, doW, T, 0, delay, idx)$summ)} # DEFINE SUMMARY FUNCTION mat.ex.array3d(sapply(split(hz, hz), fcn, simplify = &quot;array&quot;)) # WRITE SUMMARIES Q1 Q2 Q3 Q4 Q5 TxB uRet Bi-Monthly AnnMn -3.667348e+00 -1.158872e+00 7.734473e-01 1.667838e+00 2.513779e+00 -6.181127e+00 5.483049e+00 AnnSd 5.363668e+00 4.792023e+00 4.215072e+00 4.421763e+00 6.000888e+00 1.009272e+01 1.594861e+01 Sharpe -7.105842e+01 -2.447900e+01 1.856333e+01 3.792949e+01 4.468081e+01 -6.602825e+01 3.435824e+01 HitRate -1.286550e+01 -7.070025e+00 4.723347e+00 6.755136e+00 8.547009e+00 -9.716599e+00 1.315040e+01 Beta -1.478121e-01 -1.196730e-02 1.161160e-02 6.673640e-02 8.154510e-02 -2.293572e-01 1.000000e+00 Alpha -2.884656e+00 -1.124723e+00 7.242273e-01 1.311851e+00 2.102379e+00 -4.987035e+00 0.000000e+00 DrawDn -3.070239e+01 -2.066016e+01 -9.764700e+00 -8.679266e+00 -1.014188e+01 -5.565608e+01 -2.647945e+01 DDnBeg 2.015600e+07 2.015744e+07 2.017068e+07 2.017505e+07 2.019930e+07 2.015392e+07 2.018901e+07 DDnN 3.111111e+01 2.700000e+01 1.133333e+01 6.888889e+00 8.333333e+00 3.033333e+01 7.777778e+00 AnnTo 3.708705e+02 4.283792e+02 4.436285e+02 4.394258e+02 3.550319e+02 7.259023e+02 0.000000e+00 Fortnightly AnnMn -3.519279e+00 -7.357005e-01 -9.227690e-02 1.363968e+00 2.889283e+00 -6.408562e+00 5.239828e+00 AnnSd 5.696370e+00 4.538582e+00 4.747530e+00 5.075523e+00 7.164521e+00 1.126841e+01 1.547504e+01 Sharpe -6.169317e+01 -1.622664e+01 -2.416807e+00 2.734825e+01 4.042979e+01 -5.687269e+01 3.384004e+01 HitRate -3.389830e+00 -2.259887e+00 -2.824859e-01 4.519774e+00 2.542373e+00 -3.672316e+00 8.192090e+00 Beta -1.020305e-01 -9.860000e-05 5.060400e-03 1.592130e-02 8.227580e-02 -1.843063e-01 1.000000e+00 Alpha -2.989229e+00 -7.346950e-01 -1.280797e-01 1.294359e+00 2.456386e+00 -5.445615e+00 0.000000e+00 DrawDn -3.252271e+01 -1.924537e+01 -1.361857e+01 -1.150657e+01 -1.354643e+01 -6.513031e+01 -3.471675e+01 DDnBeg 2.015081e+07 2.015547e+07 2.018516e+07 2.019555e+07 2.021556e+07 2.015081e+07 2.019012e+07 DDnN 1.460000e+02 1.225000e+02 6.100000e+01 5.500000e+01 7.000000e+00 1.680000e+02 3.050000e+01 AnnTo 9.009416e+02 1.477169e+03 1.622225e+03 1.431877e+03 9.021657e+02 1.803107e+03 0.000000e+00 Monthly AnnMn -4.096170e+00 -9.957615e-01 1.684271e+00 1.444052e+00 2.074891e+00 -6.171061e+00 5.114207e+00 AnnSd 5.416322e+00 4.556909e+00 4.426222e+00 4.849517e+00 6.616150e+00 1.033563e+01 1.575257e+01 Sharpe -7.534713e+01 -2.207303e+01 3.841572e+01 3.038562e+01 3.070248e+01 -5.898969e+01 3.256064e+01 HitRate -7.954546e+00 -1.704546e+00 2.840909e+00 3.693182e+00 7.954546e+00 -8.522727e+00 9.375000e+00 Beta -9.489770e-02 1.183400e-03 -2.751680e-02 5.199940e-02 6.671430e-02 -1.616120e-01 1.000000e+00 Alpha -3.611450e+00 -1.007717e+00 1.822987e+00 1.185881e+00 1.733886e+00 -5.345336e+00 0.000000e+00 DrawDn -3.545821e+01 -1.964419e+01 -7.973902e+00 -1.050657e+01 -1.183815e+01 -6.187441e+01 -3.115392e+01 DDnBeg 2.015092e+07 2.015090e+07 2.017078e+07 2.019779e+07 2.021044e+07 2.015321e+07 2.019014e+07 DDnN 7.725000e+01 5.750000e+01 3.000000e+01 2.350000e+01 7.500000e+00 8.200000e+01 1.525000e+01 AnnTo 6.722822e+02 8.977715e+02 9.482347e+02 8.797569e+02 6.694508e+02 1.341733e+03 0.000000e+00 Quarterly AnnMn -3.010612e+00 -1.379175e+00 3.278103e-01 1.486830e+00 2.706998e+00 -5.717610e+00 5.989698e+00 AnnSd 4.975540e+00 4.755567e+00 4.267548e+00 4.230194e+00 5.615394e+00 9.360382e+00 1.524739e+01 Sharpe -6.159571e+01 -2.710429e+01 6.779117e+00 3.316403e+01 4.861341e+01 -6.153727e+01 4.049393e+01 HitRate -1.143984e+01 -4.010519e+00 -3.287310e-02 7.747096e+00 1.112207e+01 -1.089196e+01 1.530791e+01 Beta -1.452777e-01 3.048890e-02 9.560300e-03 3.942740e-02 6.504100e-02 -2.103187e-01 1.000000e+00 Alpha -2.179808e+00 -1.617811e+00 2.681731e-01 1.296172e+00 2.367950e+00 -4.547758e+00 0.000000e+00 DrawDn -2.439755e+01 -1.964698e+01 -1.046343e+01 -7.760201e+00 -9.064333e+00 -4.719616e+01 -2.328108e+01 DDnBeg 2.015458e+07 2.015624e+07 2.017071e+07 2.016764e+07 2.019436e+07 2.015456e+07 2.018968e+07 DDnN 2.000000e+01 1.684615e+01 1.100000e+01 6.000000e+00 4.692308e+00 1.892308e+01 2.923077e+00 AnnTo 2.722512e+02 3.057292e+02 3.165133e+02 3.060959e+02 2.688957e+02 5.411469e+02 0.000000e+00 Semi-Annual AnnMn -1.845390e+00 -1.131811e+00 2.882473e-01 1.240077e+00 1.505930e+00 -3.351319e+00 6.595841e+00 AnnSd 5.051874e+00 4.588560e+00 4.195620e+00 4.524511e+00 5.329069e+00 9.237284e+00 1.423706e+01 Sharpe -4.009151e+01 -2.236897e+01 4.776800e+00 2.957938e+01 2.428975e+01 -3.450307e+01 4.709465e+01 HitRate -1.047830e+01 -7.396450e+00 7.889546e-01 1.107002e+01 8.111440e+00 -9.689349e+00 2.011834e+01 Beta -1.469613e-01 1.173060e-02 2.308390e-02 7.227790e-02 3.930550e-02 -1.862668e-01 1.000000e+00 Alpha -9.308688e-01 -1.235009e+00 1.265326e-01 8.130467e-01 1.285399e+00 -2.216268e+00 0.000000e+00 DrawDn -1.749112e+01 -1.446985e+01 -9.924052e+00 -7.242502e+00 -9.758454e+00 -3.217780e+01 -1.752810e+01 DDnBeg 2.015890e+07 2.016303e+07 2.017149e+07 2.018354e+07 2.018304e+07 2.015543e+07 2.017642e+07 DDnN 8.230769e+00 6.923077e+00 5.000000e+00 2.730769e+00 4.192308e+00 7.846154e+00 2.307692e+00 AnnTo 1.433542e+02 1.633492e+02 1.655669e+02 1.554958e+02 1.544844e+02 2.978386e+02 0.000000e+00 Weekly AnnMn -2.382350e+00 -1.264825e+00 -6.822750e-02 1.232895e-01 3.616185e+00 -5.998535e+00 5.171820e+00 AnnSd 6.075655e+00 4.586436e+00 4.755661e+00 4.986296e+00 6.943735e+00 1.150496e+01 1.487190e+01 Sharpe -3.921141e+01 -2.757752e+01 -1.434659e+00 2.472566e+00 5.207839e+01 -5.213868e+01 3.477578e+01 HitRate -7.042254e-01 -1.408451e-01 2.676056e+00 -2.676056e+00 2.676056e+00 -4.647887e+00 6.056338e+00 Beta -9.556540e-02 3.473940e-02 -9.112000e-03 2.837870e-02 4.115190e-02 -1.367174e-01 1.000000e+00 Alpha -1.888102e+00 -1.444491e+00 -2.110200e-02 -2.348010e-02 3.403355e+00 -5.291457e+00 0.000000e+00 DrawDn -2.698652e+01 -2.177673e+01 -1.084032e+01 -1.107965e+01 -1.548982e+01 -6.580269e+01 -3.837292e+01 DDnBeg 2.015081e+07 2.016010e+07 2.018060e+07 2.019053e+07 2.021102e+07 2.015081e+07 2.018013e+07 DDnN 3.410000e+02 2.380000e+02 1.730000e+02 1.260000e+02 2.000000e+01 3.360000e+02 1.120000e+02 AnnTo 1.178504e+03 2.263750e+03 2.524279e+03 2.179606e+03 1.158322e+03 2.336826e+03 0.000000e+00 Annualized mean one-week returns bbk(x, y, 1, hz[1], 5, doW, T, 0, delay)$annSumm # DISPLAY CALENDAR-YEAR RETURNS Q1 Q2 Q3 Q4 Q5 TxB uRet nPrds 2015 7.4092079 8.1746110 -0.4174013 -10.1771387 -4.8193481 12.228556 -22.199034 28 2016 -4.4912261 -0.6082134 -0.9738561 -0.4739978 6.4390724 -10.930298 9.403868 53 2017 -15.0185103 -0.8214747 7.0253952 9.0197980 0.4418414 -15.460352 18.308649 52 2018 0.3631131 -6.1971480 4.9349345 -0.6077803 2.5457501 -2.182637 -12.123279 52 2019 -0.3544124 -8.2130608 -1.0657069 0.4384526 9.1539591 -9.508372 16.383026 52 2020 2.8102794 -3.8324169 -0.3289819 -4.1966331 5.5477524 -2.737473 4.955824 52 2021 -4.1534198 0.6578803 -1.0638671 -2.9670771 7.5264838 -11.679904 12.727776 53 2022 7.6208121 14.8148759 4.9761496 0.9834176 -28.3952552 36.016067 -6.838586 13 "],["multi-asset-strategy.html", "5 Multi-Asset Strategy 5.1 Overview 5.2 Daily Percentage Flow 5.3 Strategy Implementation", " 5 Multi-Asset Strategy 5.1 Overview This is a Multi-Asset Strategy, where we are essentially rotating between asset classes within the equity and bond universes. This approach uses active equity and fixed income funds to calculate percentage flow into asset classes. In terms of twenty-day percentage flows, the top fifth of asset classes outperform the bottom fifth by 10% per year. The strategy works well whether you consider only equity or fixed income asset classes. 5.2 Daily Percentage Flow The Multi-Asset Strategy developed by EPFR Global is based on percentage flow into asset classes. In this section, the reader will gain an understanding of the aggregations which can be used to create a signal as well as the methodology behind daily percentage flow calculations. 5.2.1 Aggregations The first step is defining a subset of data to capture in calculating our signal. For this strategy we can include equity, fixed-income, or both types of asset classes. Although, we will limit ourselves to actively managed funds when compiling the raw equity data. Equity and Fixed income (i.e.Â Multi-Asset) funds, which report their daily flows, are only a subset of those that report their fund flows to EPFR. The figure below shows EPFRs coverage of these universes over time compared to our total coverage. Updated at the end of July each year Users looking for more specific detail can customize this aggregation even further using EPFRs fund-level or share class-level granularity. Some good examples would be Active/Passive, ETF or Mutual funds, Institutional or Retail. Users can use these tags to different degrees in creating aggregated signals to backtest. Further detail about this is available in section 3. This can be achieved using fund-level flow files or reaching out to EPFRs quant team for customized aggregations. 5.2.2 Calculation To begin calculating the Daily Percentage flow, we start with our subset of Multi-Asset funds. To calculate the flow into an asset class, we sum the flows into funds that invest in that asset class. We repeat the process across the same funds Assets held under Management (AuM), to get the total AuM held in an asset class. Finally, to find the daily percentage flow for an asset class, we divide the flow into by the assets held. Then we repeat this across all different asset classes for the entire history. \\[\\text{Percentage Flow}_{c,t} = \\frac{\\sum^{N}_{i=m} \\text{Flow}_{i}}{\\sum^{N}_{i=m}{\\text{AuM}_{i}}}\\] Where: \\(\\text{Percentage Flow}\\) = the scaled flow as a percentage into an asset class \\(c\\), across all funds \\(i\\), for day \\(t\\) 5.2.3 Flow File The users may create flow percentages for their desired Equity and Fixed Income (Multi-Asset) aggregations and granularity using the methodology described in the previous section. EPFR also provides a pre-calculated aggregations for its users for the Multi-Asset Strategy. These files can be found on the FTP under the strategies folder. Please refer to the FTP Folder Structure section for the exact location of this file. These files contains daily flow data for asset classes listed below and are both updated daily at 5:00 PM est. with a T+1 day lag. Asset Classes 7 Global Equity Regions: Asia ex Japan Europe ex UK Japan Latin America Pacific ex Japan United Kingdom United States 10 Fixed Income: Global Emerging Markets Western Europe Bond High Yield Bond Floating Rate Funds USA Treasuries - USA Treasuries - Long USA Treasuries - Short Cash USA Munis Global Fixed Income For this demonstration, we use the pre-calculated files MultiAsset-Rgn-daily.csv and MultiAsset-FI-daily.csv. Below shows a snippet of what these files contain. AsiaXJP EurXGB Japan LatAm PacXJP UK USA 20211201 -0.065787 -0.057720 0.045671 -0.130202 -0.092976 -0.025578 -0.014164 20211202 -0.005170 -0.048366 0.065743 -0.371025 -0.010026 -0.015544 -0.112020 20211203 -0.066599 -0.097014 -0.058116 -0.032491 -0.022317 -0.032831 -0.039998 20211206 -0.038543 -0.127436 -0.002605 -0.101188 1.083445 -0.007502 0.044352 20211207 -0.097312 0.010563 0.003289 0.012547 0.004478 -0.015479 -0.251809 20211208 -0.007509 0.014343 0.040831 0.137045 -0.000494 -0.089466 0.120754 GLOBEM WESEUR HYIELD FLOATS USTRIN USTRLT USTRST CASH USMUNI GLOFIX 20211201 -0.028088 0.006219 -0.106159 -0.074881 0.252969 0.883080 0.416743 0.002679 0.024716 -0.051465 20211202 -0.014515 -0.035552 -0.233503 -0.176588 -0.034228 2.224331 0.482904 0.268642 0.040513 0.027430 20211203 0.025867 0.014347 -0.259077 0.187543 -0.277126 1.117413 0.156570 -0.159001 0.019765 -0.014492 20211206 -0.029981 -0.056445 0.196371 0.234828 0.221533 1.059680 0.147758 0.268698 0.048877 0.000639 20211207 -0.152535 -0.024498 0.233409 0.122840 0.048355 1.120573 -0.144327 -0.058648 0.039898 -0.030768 20211208 -0.027842 -0.045515 0.122184 0.121195 0.073612 -0.434690 -0.218566 0.247836 0.021011 -0.043152 We will download these files from the ftp using ftp.get(), more about this function can be referred to in section 2.3. file.Rgn &lt;- &quot;EPFRHistory/Strategies/daily/MultiAsset-Rgn-daily.csv&quot; # PATH TO .csv FILE file.FI &lt;- &quot;EPFRHistory/Strategies/daily/MultiAsset-FI-daily.csv&quot; # PATH TO .csv FILE fldr &lt;- &quot;C:\\\\temp&quot; # LOCAL FOLDER ftp.get(file.Rgn, fldr, &quot;filetransport.epfrglobal.com&quot;, w = &quot;username&quot;, h = &quot;password&quot;, &quot;ftp&quot;) ftp.get(file.FI, fldr, &quot;filetransport.epfrglobal.com&quot;, w = &quot;username&quot;, h = &quot;password&quot;, &quot;ftp&quot;) # DOWNLOADS FILE FROM FTP TO LOCAL FOLDER, USING CREDENTIALS After downloading the csv files you will store both of the paths together as flow.file. A quick way to do this is shown below: flow.file.Rgn &lt;- paste(fldr, ftp.file(file.Rgn), sep = &quot;\\\\&quot;) # STORES FLOW FILE PATH, C:\\\\temp\\\\MultiAsset-Rgn-daily.csv flow.file.FI &lt;- paste(fldr, ftp.file(file.FI), sep = &quot;\\\\&quot;) # STORES FLOW FILE PATH, C:\\\\temp\\\\MultiAsset-FI-daily.csv flow.file &lt;- c(flow.file.Rgn, flow.file.FI) 5.2.4 Return File The return file for this strategy should contain daily returns for each of the asset classes in the flow file, which the user can find with their own resources. EPFR also provides Fund Return data, that can be used as a proxy to returns. To create a return file using EPFR daily flow data, the following equation can be used: \\[\\text{Fund Return}_{c,t} = \\frac{\\sum^{N}_{i=m} \\text{Portfolio Change}_i}{\\sum^{N}_{i=m} \\text{Assets Start}_i}\\] Where: \\(\\text{Fund Return}\\) = the return value of an asset class \\(c\\), across all funds \\(i\\), for day \\(t\\) For this demonstration, we will use files that have calculated returns using EPFR daily flow data, which has been locally named PsuedoReturns-Rgn.csv and PsuedoReturns-FI.csv. ret.file.Rgn &lt;- &quot;PsuedoReturns-Rgn.csv&quot; ret.file.FI &lt;- &quot;PsuedoReturns-FI.csv&quot; For your reference a snippet of our return file looks like this AsiaXJP EurXGB Japan LatAm PacXJP UK USA GLOBEM WESEUR HYIELD FLOATS USTRIN USTRLT USTRST CASH USMUNI GLOFIX 20211201 214.1131 161.9943 119.2173 78.83982 154.0745 177.0324 291.9835 135.8781 141.4412 146.3335 114.4219 141.0385 212.2570 123.5804 102.3682 143.3444 149.7536 20211202 214.8790 160.6190 118.3444 79.37666 153.5210 176.2673 296.3693 136.1899 141.6530 146.4360 114.4118 140.7892 212.2643 123.4992 102.3683 143.3476 149.8067 20211203 213.7301 160.1943 120.0065 80.18004 153.5826 177.0106 293.1333 136.4219 141.7254 146.6076 114.4840 141.2850 214.3524 123.5313 102.3681 143.3861 150.0184 20211206 211.6420 160.0753 119.2455 80.47108 152.9334 177.3153 296.2200 136.5582 141.8860 146.9627 114.5514 140.8142 212.2902 123.4913 102.3681 143.3881 150.1093 20211207 215.1935 163.9383 121.5673 81.73758 154.7535 180.1470 302.6847 137.0147 141.9751 147.6908 114.6925 140.4383 210.9993 123.4109 102.3676 143.3552 150.2401 20211208 216.7263 164.5640 122.5717 83.11249 156.2248 180.8519 304.2680 137.2775 141.8604 147.6839 114.7470 140.0966 208.6260 123.4210 102.3680 143.3227 150.1685 5.3 Strategy Implementation The final step is implementing this strategy to create a signal. Lets begin by reading in the flow and return files to our R studio work space. x.rgn &lt;- read.csv(flow.file[1], row.names = 1) x.FI &lt;- read.csv(flow.file[2], row.names = 1) The next step is to ensure both of our flow files have the same rows so that we can combine the two files, like we do below. x.rgn &lt;- x.rgn[is.element(dimnames(x.rgn)[[1]], dimnames(x.FI)[[1]]), ] # ENSURES RGN MATCHES FI ROWS x.FI &lt;- x.FI[is.element(dimnames(x.FI)[[1]], dimnames(x.rgn)[[1]]), ] # ENSURES FI MATCHES RGN ROWS x &lt;- cbind(x.rgn, x.FI) # COMBINES RGN AND FI DATA One of the first options we have is choosing the universe we want to use. EPFR has tested this signal within two different universes of asset classes Rgn (7 Region Equity) and F.I. (Fixed Income). For this example, we choose Multi, which includes both of our equity and fixed income asset classes. idx &lt;- &quot;Multi&quot; # Multi/Rgn/FI 5.3.1 Compounding Flows Next, we set up a variable for our look-back period, which can also be called a flow window. This variable will be the window of time we use to create a trailing compounded daily percentage flow. The look-back period we choose for our demonstrations is 20 days. lookback &lt;- 20 # FLOW WINDOW (IN WEEKDAYS) - 20 day look back period Using a function from the library('EPFR'), compound.flows() compounds the daily percentage flow over the trailing lookback period for each country. x &lt;- compound.flows(x, lookback, F) # COMPOUND FLOWS AsiaXJP EurXGB Japan LatAm PacXJP UK USA GLOBEM WESEUR HYIELD FLOATS USTRIN USTRLT USTRST CASH USMUNI GLOFIX 20211201 -1.3075493 -1.1480918 0.9173940 -2.5720804 -1.8431866 -0.5103189 -0.2828991 -0.5602635 0.1244535 -2.101903 -1.487014 5.1828328 19.224815 8.673241 0.0535936 0.4954824 -1.0242831 20211202 -0.1033492 -0.9628883 1.3231046 -7.1646787 -0.2003291 -0.3104214 -2.2167174 -0.2899000 -0.7086436 -4.567902 -3.473135 -0.6823386 55.269281 10.114258 5.5121958 0.8133861 0.5500319 20211203 -1.3235863 -1.9225014 -1.1559251 -0.6478181 -0.4453950 -0.6545761 -0.7969276 0.5186133 0.2873314 -5.055971 3.818446 -5.3990002 24.887508 3.178417 -3.1324407 0.3960431 -0.2894413 20211206 -0.7680439 -2.5180988 -0.0520871 -2.0044235 24.0511206 -0.1499331 0.8907875 -0.5979152 -1.1228670 4.001557 4.802825 4.5251572 23.469126 2.997012 5.5133744 0.9820924 0.0127808 20211207 -1.9283523 0.2114721 0.0658006 0.2512393 0.0895981 -0.3091252 -4.9175061 -3.0068948 -0.4888214 4.773156 2.485683 0.9715555 24.965588 -2.847303 -1.1664477 0.8009918 -0.6135646 20211208 -0.1500729 0.2872512 0.8197954 2.7768797 -0.0098795 -1.7741934 2.4429867 -0.5553696 -0.9063747 2.472254 2.452012 1.4825812 -8.343978 -4.281734 5.0751769 0.4210598 -0.8595112 5.3.2 Return file We will then import our two total return files and modify them to be one data frame of total index returns indexed so that time moves forward. To do this we will use function ret.to.idx() from library('EPFR') which will translate these returns to a total return index. We also use the functions map.rname() to ensure the row names of the matrices line up with our flow file and ret.idx.gaps.fix() to replace any NA values. #RGN RETURNS y &lt;- read.csv(ret.file.Rgn, row.names = 1) y &lt;- ret.to.idx(map.rname(y, dimnames(x)[[1]])) # CONVERT TO A TOTAL-RETURN INDEX y &lt;- ret.idx.gaps.fix(y) #F.I. RETURNS z &lt;- read.csv(ret.file.FI, row.names = 1) z &lt;- ret.to.idx(map.rname(z, dimnames(y)[[1]])) # CONVERT TO A TOTAL-RETURN INDEX #COMBINE RETURN FILES y &lt;- data.frame(y, z)[, dimnames(x)[[2]]] # FINAL TOTAL-RETURN INDEX TABLE y &lt;- y[max(simplify2array(lapply(y, function(x) {find.data(!is.na(x), T)}))):min(simplify2array(lapply(y, function(x) {find.data(!is.na(x), F)}))), ] # ENSURE ALL PIECES HAVE RETURN OVER THE SAME HORIZON Then, to subset the flow file \\(x\\) and return file \\(y\\) to the selected universe \\(idx\\) of asset classes, the function the following code is used. if (idx == &quot;Rgn&quot;) { x &lt;- x[, 1:7] y &lt;- y[, 1:7] } else if (idx == &quot;FI&quot;) { x &lt;- x[, 8:dim(x)[2]] y &lt;- y[, 8:dim(y)[2]] } else { z &lt;- map.rname(portfolio.beta.wrapper(y, &quot;ACWorld&quot;, lookback), dimnames(x)[[1]]) for (j in 1:dim(x)[1]) x[j, ] &lt;- portfolio.residual(unlist(x[j, ]), unlist(z[j, ])) } * Note: subsetting can be also be done when creating the flow and return files 5.3.3 Ranking Asset Classes Next, we sort the countries in each universe into five equal bins based on their 20-day Percentage Flow Compounded value for the selected holding period. To do this, we will use the function from library('EPFR'), called bbk(). This function will output a standardized backtest result. The bbk() function requires our compounded daily percentage flow file, a return file, and our selected universe. Please refer to the library documentation for the complete list of parameters of this function. The first parameter we add is the number of bins we want to use. For our case, we want to use 5 because our strategy is to go long the top fifth and short the bottom fifth. nBin &lt;- 5 # NUMBER OF BINS Since EPFR data is published with T+1 day lag and is released around 5:00 pm EST, we account for a T+2 day delay in our model since that is when one can trade on the information. Users interested in more timely signals can also use the T+2 Open Prices for backtesting purposes. EPFR also offers a Premium Daily offering, an earlier release of the end-of-day data covering a significant subset of fund-level flow information. delay &lt;- 2 # DELAY IN KNOWING DATA (IN WEEKDAYS) - data takes time to have It is also important to note that this model will need to be re-balanced weekly. The day of the week the rebalancing occurs is at the discretion of the user. For this example we will set the day of the week to trade as Friday. doW &lt;- 5 # DAY OF THE WEEK YOU WILL TRADE ON (5 = FRIDAYS) Additionally, we also evaluate the returns for different holding periods. The user can input return horizons that they are interested in here. For this example we define a return horizon for weekly, fortnightly, monthly, bi-monthly, quarterly, and semi-annually. hz &lt;- c(5, 10, 20, 45, 65, 130) # RETURN HORIZON (IN WEEKDAYS) - holding periods Now that we have defined all of our inputs, to rank the countries into quintiles by their 20-day percentage flow, we call function bbk() for a 1-week holding period. z &lt;- bbk(x, y, 1, hz[1], nBin, doW, T, 0, delay) 5.3.4 Model Twenty-day flow percentage ranked into quintiles (computed only where forward returns are available) z[[&quot;bins&quot;]] AsiaXJP EurXGB Japan LatAm PacXJP UK USA GLOBEM WESEUR HYIELD FLOATS USTRIN USTRLT USTRST CASH USMUNI GLOFIX 20211231 3 2 4 2 1 3 1 5 5 4 2 3 1 2 4 4 5 20211224 3 2 3 2 1 2 1 5 5 4 3 4 1 2 4 4 5 20211217 3 2 3 2 1 2 1 5 4 5 3 5 1 2 4 4 4 20211210 2 2 3 3 1 2 1 5 4 5 2 5 1 4 3 4 4 20211203 2 2 3 2 3 2 1 5 4 5 1 4 1 5 3 4 4 Quintile Returns over the equal-weight universe z[[&quot;rets&quot;]] Q1 Q2 Q3 Q4 Q5 TxB uRet 20211231 -1.3109539 0.0725919 0.2918396 0.3304415 0.4817365 -1.7926905 -1.2013195 20211224 0.1887523 0.6261322 -0.0933557 -0.3480753 -0.4661392 0.6548915 0.4471162 20211217 0.3783955 0.4627865 -0.1779460 -0.4147732 -0.2644672 0.6428627 0.2635537 20211210 -0.0522600 -0.7762852 -0.1280384 0.5157179 0.5277215 -0.5799815 -0.5107398 20211203 -0.4315280 1.2789592 0.1542756 -0.8409929 -0.3067026 -0.1248254 0.7003021 5.3.5 Performance Performance over all holding periods fcn &lt;- function(retW) {as.matrix(bbk(x, y, 1, retW, 5, doW, T, 0, delay)$summ)} # DEFINE SUMMARY FUNCTION mat.ex.array3d(sapply(split(hz, hz), fcn, simplify = &quot;array&quot;)) # WRITE SUMMARIES Q1 Q2 Q3 Q4 Q5 TxB uRet Bi-Monthly AnnMn 2.828402e-01 1.827399e+00 9.223160e-02 -4.012864e-01 -2.276556e+00 2.559396e+00 3.414070e+00 AnnSd 5.913043e+00 4.820078e+00 5.236111e+00 5.254448e+00 5.456516e+00 7.570461e+00 9.178851e+00 Sharpe 5.386779e+00 3.777880e+01 2.121171e+00 -8.682174e+00 -4.204321e+01 3.457958e+01 3.734956e+01 HitRate -1.585745e+00 5.662932e+00 2.488329e+00 -1.735138e+00 -9.572051e+00 5.507314e+00 1.509804e+01 Beta -3.370975e-01 7.102820e-02 2.249963e-01 1.978696e-01 -2.464292e-01 -9.066830e-02 1.000000e+00 Alpha 1.426362e+00 1.599415e+00 -6.766495e-01 -1.091192e+00 -1.427343e+00 2.853705e+00 0.000000e+00 DrawDn -2.632947e+01 -1.191615e+01 -2.081920e+01 -2.235761e+01 -3.595694e+01 -2.107975e+01 -3.101945e+01 DDnBeg 2.011959e+07 2.009088e+07 2.009856e+07 2.007733e+07 2.007964e+07 2.011523e+07 2.007096e+07 DDnN 4.955556e+01 8.333333e+00 2.266667e+01 5.333333e+01 7.322222e+01 3.377778e+01 7.666667e+00 AnnTo 3.672881e+02 4.011425e+02 4.480936e+02 4.057372e+02 3.692831e+02 7.365712e+02 0.000000e+00 Fortnightly AnnMn 9.259782e-01 2.492020e+00 -5.573529e-01 6.295450e-02 -3.775258e+00 4.701236e+00 3.426943e+00 AnnSd 5.917609e+00 4.877853e+00 5.377613e+00 4.847856e+00 5.245946e+00 7.743054e+00 8.320958e+00 Sharpe 1.596155e+01 5.186321e+01 -1.035993e+01 1.258583e+00 -7.218186e+01 6.080875e+01 4.119830e+01 HitRate 1.181102e+00 5.774278e+00 5.249344e-01 -9.186352e-01 -8.136483e+00 5.380577e+00 1.233596e+01 Beta -4.167381e-01 1.975220e-01 2.023901e-01 1.089651e-01 -1.943014e-01 -2.224367e-01 1.000000e+00 Alpha 2.351253e+00 1.813017e+00 -1.246065e+00 -3.120666e-01 -3.106455e+00 5.457707e+00 0.000000e+00 DrawDn -2.196848e+01 -1.233971e+01 -2.141904e+01 -2.358887e+01 -5.749275e+01 -1.643812e+01 -3.576917e+01 DDnBeg 2.011607e+07 2.012102e+07 2.007086e+07 2.008047e+07 2.008557e+07 2.016026e+07 2.007106e+07 DDnN 2.460000e+02 4.650000e+01 3.000000e+01 2.225000e+02 3.390000e+02 8.650000e+01 3.150000e+01 AnnTo 1.044561e+03 1.435132e+03 1.781228e+03 1.458224e+03 1.060526e+03 2.105088e+03 0.000000e+00 Monthly AnnMn 2.517077e-01 2.229484e+00 5.263841e-01 -2.305718e-01 -3.443308e+00 3.695015e+00 3.443160e+00 AnnSd 6.040379e+00 4.764184e+00 5.177948e+00 4.740967e+00 5.326552e+00 8.003601e+00 8.803569e+00 Sharpe 4.327315e+00 4.715438e+01 1.004391e+01 -5.809417e+00 -6.465687e+01 4.590509e+01 3.914899e+01 HitRate -1.309589e+00 5.502893e+00 3.942546e+00 -3.974924e-01 -9.720997e+00 4.853954e+00 1.194682e+01 Beta -3.782649e-01 1.811076e-01 1.782433e-01 7.995630e-02 -1.480635e-01 -2.302014e-01 1.000000e+00 Alpha 1.550587e+00 1.608971e+00 -8.706030e-02 -5.050550e-01 -2.935414e+00 4.486001e+00 0.000000e+00 DrawDn -2.485525e+01 -1.135194e+01 -1.379740e+01 -2.313212e+01 -5.469837e+01 -1.865290e+01 -3.389934e+01 DDnBeg 2.011609e+07 2.013809e+07 2.007322e+07 2.007804e+07 2.007584e+07 2.017297e+07 2.007104e+07 DDnN 1.180000e+02 1.575000e+01 1.425000e+01 1.072500e+02 1.647500e+02 2.400000e+01 1.675000e+01 AnnTo 7.665873e+02 8.781019e+02 9.930013e+02 8.763370e+02 7.706358e+02 1.537223e+03 0.000000e+00 Quarterly AnnMn 2.082996e-01 1.475256e+00 5.512255e-01 -4.583024e-01 -2.115463e+00 2.323763e+00 3.451610e+00 AnnSd 6.069687e+00 4.788153e+00 5.243448e+00 5.281513e+00 5.447099e+00 7.815675e+00 9.179433e+00 Sharpe 4.398214e+00 2.999778e+01 1.166880e+01 -7.975710e+00 -3.933563e+01 2.988058e+01 3.767121e+01 HitRate -2.220923e+00 4.297981e+00 3.677561e+00 1.146428e-01 -1.045497e+01 5.224115e+00 1.746167e+01 Beta -3.230980e-01 6.293140e-02 1.900691e-01 2.393422e-01 -2.700026e-01 -5.309540e-02 1.000000e+00 Alpha 1.297791e+00 1.270221e+00 -9.462940e-02 -1.290318e+00 -1.176366e+00 2.474157e+00 0.000000e+00 DrawDn -2.835885e+01 -1.402103e+01 -1.635786e+01 -2.281515e+01 -3.534620e+01 -2.077900e+01 -2.855401e+01 DDnBeg 2.012679e+07 2.011924e+07 2.009002e+07 2.007385e+07 2.008769e+07 2.013462e+07 2.007107e+07 DDnN 3.392308e+01 1.323077e+01 1.730769e+01 2.661538e+01 4.700000e+01 2.061538e+01 4.692308e+00 AnnTo 2.642747e+02 2.788776e+02 3.079870e+02 2.803737e+02 2.641693e+02 5.284440e+02 0.000000e+00 Semi-Annual AnnMn -3.437517e-01 3.401882e-01 9.952400e-01 3.700486e-01 -1.598471e+00 1.254719e+00 3.264504e+00 AnnSd 5.868392e+00 5.199547e+00 5.381712e+00 5.435882e+00 6.077735e+00 8.239524e+00 9.887262e+00 Sharpe -5.129252e+00 6.007580e+00 1.832494e+01 6.506114e+00 -2.821291e+01 1.527201e+01 3.310566e+01 HitRate -4.664014e+00 3.315650e-01 3.992042e+00 7.603890e-01 -1.037135e+01 3.828470e+00 1.798851e+01 Beta -2.346576e-01 9.066500e-02 1.613479e-01 2.051041e-01 -3.210492e-01 8.639160e-02 1.000000e+00 Alpha 4.217477e-01 4.790610e-02 4.705208e-01 -3.022396e-01 -5.531572e-01 9.749050e-01 0.000000e+00 DrawDn -2.761126e+01 -1.785078e+01 -1.613488e+01 -1.695472e+01 -3.261189e+01 -2.635958e+01 -2.575678e+01 DDnBeg 2.011140e+07 2.009753e+07 2.010174e+07 2.009256e+07 2.008306e+07 2.011067e+07 2.007133e+07 DDnN 1.807692e+01 1.123077e+01 8.692308e+00 9.000000e+00 2.342308e+01 1.057692e+01 2.500000e+00 AnnTo 1.376942e+02 1.450099e+02 1.586902e+02 1.453699e+02 1.381205e+02 2.758147e+02 0.000000e+00 Weekly AnnMn 1.592838e+00 2.600218e+00 -1.258101e+00 5.124087e-01 -4.486685e+00 6.079523e+00 3.476831e+00 AnnSd 5.824055e+00 4.878130e+00 5.966608e+00 5.196646e+00 5.272198e+00 7.209913e+00 8.039942e+00 Sharpe 2.734929e+01 5.330357e+01 -2.108569e+01 9.860373e+00 -8.510084e+01 8.432173e+01 4.324447e+01 HitRate 3.018373e+00 2.493438e+00 -1.574803e+00 7.874016e-01 -7.742782e+00 3.805774e+00 7.874016e+00 Beta -3.942092e-01 1.401982e-01 2.978962e-01 1.025758e-01 -2.273811e-01 -1.668281e-01 1.000000e+00 Alpha 2.963436e+00 2.112772e+00 -2.293835e+00 1.557700e-01 -3.696120e+00 6.659556e+00 0.000000e+00 DrawDn -1.606454e+01 -1.612712e+01 -2.380407e+01 -2.126739e+01 -6.725861e+01 -1.451490e+01 -3.582700e+01 DDnBeg 2.012060e+07 2.017051e+07 2.007082e+07 2.008043e+07 2.008101e+07 2.018041e+07 2.007103e+07 DDnN 4.010000e+02 1.060000e+02 6.890000e+02 3.630000e+02 6.810000e+02 2.900000e+01 5.600000e+01 AnnTo 1.430399e+03 2.256636e+03 3.043014e+03 2.225887e+03 1.430399e+03 2.860797e+03 0.000000e+00 Annualized mean one-week returns bbk(x, y, 1, hz[1], 5, doW, T, 0, delay)$annSumm # DISPLAY CALENDAR-YEAR RETURNS Q1 Q2 Q3 Q4 Q5 TxB uRet nPrds 2007 4.2000678 2.803337 -0.3338664 2.4527902 -10.9211199 15.1211877 4.083357 29 2008 18.0013864 -1.533763 -11.9280634 0.2565244 -4.3703382 22.3717246 -27.417418 52 2009 4.4969049 1.443946 6.8150899 1.2174263 -14.8604914 19.3573963 24.141740 52 2010 1.4959054 5.538435 5.1815184 -7.8261521 -3.6271345 5.1230400 9.964876 53 2011 1.9021813 -2.509559 -7.9465328 1.5378930 7.3399064 -5.4377251 -2.537112 52 2012 2.5727506 7.033370 -7.7394972 -1.4672626 -2.2547293 4.8274800 9.883816 52 2013 -2.6940255 8.111374 4.8775547 -2.3580103 -9.8546802 7.1606547 4.569832 52 2014 1.2885294 2.225290 1.2163958 -5.4025761 1.7314565 -0.4429271 4.051446 52 2015 0.3652572 5.189019 -4.6061932 -1.7012626 -0.4094065 0.7746637 -1.968191 52 2016 -4.4031304 6.815005 -0.5910777 2.4579616 -7.3697471 2.9666166 5.941342 53 2017 2.1300783 -1.046105 -3.4275070 3.9576821 -2.5846737 4.7147520 8.457597 52 2018 -5.8495383 -8.600442 1.5046951 9.3530437 3.3413746 -9.1909128 -6.120206 52 2019 -4.1748789 2.909558 1.6836126 3.2008822 -5.6559871 1.4811082 11.606858 52 2020 4.8365853 2.743976 -1.4213119 4.1689166 -12.6324634 17.4690487 5.327833 52 2021 2.3416783 8.355836 -1.8560473 -2.5158345 -8.2722996 10.6139779 3.660437 53 2022 -33.7987135 -13.894508 -1.6909987 36.7442568 5.0233800 -38.8220935 -32.953700 2 "],["fx-strategy.html", "6 FX Strategy 6.1 Overview 6.2 Daily Percentage Flow 6.3 Strategy Implementation", " 6 FX Strategy 6.1 Overview The FX Strategy an equity based currency rotation strategy, which ranks different foreign exchange markets of countries across a customized universe of both developed and emerging markets. This approach uses the stated allocations of equity funds with a cross-border focus and calculates percentage flow into currencies. In terms of twenty-day percentage flows, the top fifth of ACWI currencies outperform the bottom fifth by over 4% per year. The strategy works best amongst G10 currencies, but adds value across the board. 6.2 Daily Percentage Flow The FX Strategy developed by EPFR Global is based on percentage flow into currencies. In this section, the reader will gain an understanding of the aggregations which can be used to create a signal as well as the methodology behind daily percentage flow calculations. 6.2.1 Aggregations The first step is defining a subset of data to capture in calculating our signal. This strategy requires; Equity funds with a cross-boarder focus. These are essentially any fund that has a mandate spanning more than one country. The vast majority of these will be global and regional funds. Funds must report both daily flows and country allocations, since these values are needed to calculate Daily Percentage Flow. Cross-border equity funds, which report their country allocations and their fund flows, are a subset of those that only report their fund flows to EPFR. The figure below shows EPFRs coverage of this universe over time compared to our total coverage. Updated at the end of July each year Users looking for more specific detail can customize this aggregation even further using EPFRs fund-level or share class-level granularity. Some good examples would be Active/Passive, ETF or Mutual funds, Institutional or Retail. Users can use these tags to different degrees in creating aggregated signals to backtest. Further detail about this is available in section 3. This can be achieved using fund-level flow files or reaching out to EPFRs quant team for customized aggregations. 6.2.2 Calculation To begin calculating the Daily Percentage flow, we start with our subset of cross-border equity funds. To calculate the funds impact on a currency, we scale a funds flow by multiplying it against its stated country allocation to countries using that currency, which is available in EPFRs Country Allocation Database, on that day. EPFR releases country allocations of all funds on the \\(23^{\\text{rd}}\\) of each month (or the next available business day) at a monthly frequency. Hence, our calculation assumes constant country allocation between two consecutive release dates within the month. We then apply the same procedure to all funds with a fund flow and country allocation information and then sum the flows for each currency across all funds. \\[\\text{Total Impact}_{c,t} = \\sum^{N}_{i=m}{\\text{Flow}_i \\times \\text{Allocation}_i}\\] Where: \\(\\text{Total Impact}\\) = the impact on a currency \\(c\\), across all funds \\(i\\), for day \\(t\\) Additionally, we repeat the process across the same funds Assets held under Management (AuM), to get the total AuM held in a country. \\[\\text{Total AuM}_{c,t} = \\sum^{N}_{i=m}{\\text{AuM}_i \\times \\text{Allocation}_i}\\] Where: \\(\\text{Total AuM}\\) = the assets held in a currency \\(c\\), across all funds \\(i\\), for day \\(t\\) Finally, to find the daily percentage flow into a currency, we divide the Total Impact by the Total AuM. Then we repeat this across all different currencies for the entire history. \\[\\text{Percentage Flow}_{c,t} = \\frac{\\text{Total Impact}_{c,t}}{\\text{Total AuM}_{c,t}}\\] Where: \\(\\text{Percentage Flow}\\) = the scaled flow as a percentage into a currency \\(c\\), across all funds \\(i\\), for day \\(t\\) 6.2.3 Flow File The users may create flow percentages for their desired FX aggregations and granularity using the methodology described in the previous section. EPFR also provides a pre-calculated aggregation for its users for the FX Strategy. This file can be found on the FTP under the strategies folder. Please refer to the FTP Folder Structure section for the exact location of this file. This file contains daily flow data for 37 currencies and is updated daily at 5:00 PM est. with a T+1 day lag. For this demonstration, we use the pre-calculated file FX-daily.csv. Below shows a snippet of what this file contains. ARS AUD BRL CAD CHF CLP CNY CZK EGP GBP HUF IDR ILS INR JPY KRW MXN MYR NOK NZD PEN PHP PLN RUB SEK SGD THB TRY TWD ZAR USD EUR COP PKR MAD VND KWD 20211101 0.0951956 0.0233905 0.0531035 0.0202649 0.0136956 0.0124597 0.0367144 0.0407582 -0.0099286 0.0090056 0.0118883 0.1026345 0.0227167 0.0737441 0.0112211 0.0301935 0.0528308 0.0424596 0.0250291 0.0173961 0.0983880 0.0163313 0.0203153 0.0215331 0.0123521 0.0900571 0.0397868 0.0233967 0.0497635 0.0189636 0.0685452 0.0189129 0.0224357 0.0303562 -0.0103072 0.8665646 0.0194010 20211102 0.0942688 0.1720646 0.0354197 0.0926433 0.1266238 0.0483671 0.0439027 0.0997758 0.0577666 0.1349584 0.0443015 0.0569077 0.1323832 0.0365911 0.1419282 0.0531659 0.0390083 0.0445662 0.1255181 0.1113622 0.0203433 0.0313609 0.0642350 0.0238631 0.1268904 0.1101238 0.0296805 0.0237125 0.0333732 0.0499104 0.0734126 0.0871499 0.0279508 0.1460037 0.4337403 0.2818899 0.0219654 20211103 0.1089451 0.0281285 0.0119845 0.0444364 0.0277638 0.0629838 -0.0350514 0.0068424 0.0119071 0.0291382 -0.1047347 -0.0518616 0.0345525 -0.0505650 0.0315910 -0.0571837 0.0040123 -0.0116749 0.0233558 0.0178623 0.1200862 0.0187043 0.0137464 -0.1117925 0.0391676 0.0475302 -0.0179925 -0.0101861 -0.0450093 -0.0520347 0.0805151 0.0191132 0.0292842 0.0274489 0.0643956 0.0460473 0.0091691 20211104 0.1709919 -0.0259282 0.0564485 0.0874951 0.0043956 0.0467287 0.0444763 0.0745158 0.0684307 -0.0166590 0.0797765 0.0305560 0.0520806 0.0258512 0.0087418 0.0312389 0.0481343 0.0384663 0.0556068 0.0611684 0.0294905 0.0120414 0.0888283 0.0753834 0.0201077 0.0511059 0.0432660 0.0708349 0.0285761 0.0572320 0.0638265 0.0284550 -0.0555654 0.0271469 0.1155251 0.0171987 0.0251618 20211105 0.0811163 0.1188916 0.0800062 0.0734998 0.0777874 0.0776826 0.0057655 0.0836201 0.0531953 0.0844895 0.0276116 0.0705703 0.0725028 0.0420120 0.0905879 0.0299950 0.0407647 0.0050806 0.0596630 0.0803083 0.1076447 0.0376676 0.0586687 0.0104820 0.0812884 0.0810288 0.0379855 -0.1275677 0.0186814 0.0148055 0.0585696 0.0532085 0.1140662 0.0360098 0.0395516 0.2613120 0.0587149 20211108 0.1190233 0.0493196 0.0734154 0.0765835 0.0388529 0.0709732 -0.0219888 0.0400470 0.0860873 0.0218624 0.0117260 0.0381564 0.0477718 0.0318928 0.0512294 0.0285295 0.0356488 0.0659128 -0.0015951 0.0117628 0.0458379 0.0270478 0.0694772 0.0586824 0.0310111 0.0067519 0.0474835 0.0182717 0.0363691 0.0662294 0.0588712 0.0100783 0.0906876 0.1440479 0.3945202 0.1805212 0.0545738 We will download this file from the ftp using ftp.get(), more about this function can be referred to in section 2.3. file &lt;- &quot;EPFRHistory/Strategies/daily/FX-daily.csv&quot; # PATH TO .csv FILE fldr &lt;- &quot;C:\\\\temp&quot; # LOCAL FOLDER ftp.get(file, fldr, &quot;filetransport.epfrglobal.com&quot;, w = &quot;username&quot;, h = &quot;password&quot;, &quot;ftp&quot;) # DOWNLOADS FILE FROM FTP TO LOCAL FOLDER, USING CREDENTIALS After downloading the csv file you will store its path as flow.file. A quick way to do this is shown below: flow.file &lt;- paste(fldr, ftp.file(file), sep = &quot;\\\\&quot;) # STORES FLOW FILE PATH, C:\\\\temp\\\\FX-daily.csv 6.2.4 Return File The return file for this strategy should contain daily Exchange rates for each of the currencies in the flow file, which the user can find with their own resources. For this demonstration, we will the file which has been locally named ExchRates.csv. ret.file &lt;- &quot;ExchRates.csv&quot; For your reference a snippet of our return file looks like this XDR AUD EGP INR MXN NZD QAR TRY ZAR ARS BRL EUR IDR KRW NOK PHP SEK CAD CHF CLP HUF JPY PEN RUB TWD CNY CZK GBP ILS MYR PLN SGD THB JOR PKR MAD COP CNH VND KWD 20211101 1.41082 1.3294 15.7013 74.8737 20.8426 1.3914 3.6413 9.5398 15.4295 99.8178 5.6863 0.8616 14248 1176.55 8.4063 50.420 8.5196 1.2369 0.9091 814.50 310.85 114.00 3.9915 71.5655 27.847 6.3977 22.0433 0.7318 3.1118 4.1515 3.9776 1.3485 33.455 NA 171.9875 9.0679 3767.37 6.3942 22753 0.30175 20211102 1.41229 1.3459 15.7013 74.6850 20.7844 1.4060 3.6413 9.6039 15.4431 99.8679 5.6863 0.8636 14253 1174.40 8.5277 50.385 8.5747 1.2411 0.9146 812.70 310.30 113.96 4.0086 71.5587 27.844 6.4000 22.0850 0.7344 3.1341 4.1487 3.9801 1.3491 33.247 NA 171.9875 9.0760 3795.98 6.4028 22744 0.30165 20211103 1.41165 1.3428 15.7013 74.4600 20.5391 1.3964 3.6415 9.6447 15.2702 99.9104 5.5533 0.8612 14298 1181.60 8.5071 50.570 8.5383 1.2391 0.9118 812.75 308.91 114.01 4.0125 71.7646 27.847 6.4066 21.9603 0.7307 3.1179 4.1540 3.9457 1.3478 33.315 NA 169.9842 9.0661 3834.24 6.3948 22743 0.30165 20211104 1.40951 1.3513 15.7010 74.4600 20.5443 1.4080 3.6417 9.7039 15.2169 99.9493 5.6035 0.8654 14338 1182.65 8.5559 50.615 8.5900 1.2456 0.9127 814.31 311.80 113.76 4.0139 71.7646 27.860 6.3972 21.9440 0.7407 3.1084 4.1540 3.9827 1.3511 33.410 NA 169.9625 9.0867 3869.34 6.3974 22686 0.30165 20211105 1.40747 1.3513 15.7010 74.4600 20.3434 1.4047 3.6417 9.6922 15.0529 99.9498 5.5423 0.8644 14328 1185.05 8.5590 50.345 8.5711 1.2457 0.9127 811.55 310.26 113.41 4.0105 71.2684 27.874 6.3988 21.8231 0.7409 3.1112 4.1588 3.9750 1.3502 33.320 NA 169.9625 9.0781 3878.85 6.3944 22698 0.30165 20211108 1.41024 1.3471 15.7010 74.0237 20.3424 1.3952 3.6417 9.6853 14.9184 100.0605 5.5423 0.8630 14258 1183.20 8.5045 50.175 8.5765 1.2442 0.9133 802.58 311.67 113.23 4.0140 71.2364 27.836 6.3927 21.7967 0.7371 3.1113 4.1543 3.9637 1.3476 33.055 NA 169.9625 9.0574 3876.38 6.3884 22658 0.30175 6.3 Strategy Implementation The final step is implementing this strategy to create a signal. Lets begin by reading in the flow and return files to our R studio work space. x &lt;- read.csv(flow.file, row.names = 1) # GET FLOW PERCENTAGE y &lt;- 1/read.csv(ret.file, row.names = 1) # READ IN EXCHANGE RATES One of our first options is choosing the universe we want to use. EPFR has tested this signal within three different universes of countries ACWI (All Country World Index), G10 (ten of the most heavily traded currencies), EM (Emerging Markets). For this example, we choose ACWI, which includes 52 countries and 37 currencies. idx &lt;- &quot;ACWI&quot; # ACWI/G10/EM If needed, subset the flow file \\(x\\) and return file \\(y\\) to the selected universe \\(idx\\). For this example, our flow file is already in the ACWI universe but below is an example of how we set this using the functions Ctry.msci.members.rng() and Ctry.info(), from the library('EPFR') is used. This function first returns a list of two letter country codes from \\(idx\\) and then will produce a unique list of three letter currency codes that these countries use. idx.curr &lt;- unique(Ctry.info(Ctry.msci.members(idx, &quot;&quot;), &quot;Curr&quot;)) # CURRENCY CLASSIFICATION 2016 if (idx != &quot;G10&quot;) idx.curr &lt;- union(Ctry.info(Ctry.msci(idx)[, &quot;CCODE&quot;], &quot;Curr&quot;), idx.curr) else idx &lt;- NULL # CAPTURE INDEX CHANGES if (is.element(&quot;EM&quot;, idx)) idx.curr &lt;- setdiff(idx.curr, c(&quot;USD&quot;, &quot;EUR&quot;)) # ENSURE NO OVERLAP BETWEEN DEVELOPED AND EM CURRENCIES x &lt;- x[, is.element(dimnames(x)[[2]], idx.curr)] # SUBSET TO CURRENCIES OF INTEREST We will also subset the return file \\(y\\) to use the same currencies as \\(x\\). Divide by XDR? y &lt;- y[, dimnames(x)[[2]]]/y[, &quot;XDR&quot;] # CURRENCIES OF INTEREST ON AN SDR BASE (OTHERWISE &lt;get.fwdRet&gt; THINKS THE USD NEVER TRADES!) * Note: subsetting can be also be done when creating the flow and return files 6.3.1 Compounding Flows Next, we set up a variable for our look-back period, which can also be called a flow window. This variable will be the window of time we use to create a trailing compounded daily percentage flow. The look-back period we choose for our demonstrations is 20 days. lookback &lt;- 20 # FLOW WINDOW (IN WEEKDAYS) - 20 day look back period Using a function from the library('EPFR'), compound.flows() compounds the daily percentage flow over the trailing lookback period for each country. x &lt;- compound.flows(x, lookback, F) # COMPOUND FLOWS ARS AUD BRL CAD CHF CLP CNY CZK EGP GBP HUF IDR ILS INR JPY KRW MXN MYR NOK NZD PEN PHP PLN RUB SEK SGD THB TRY TWD ZAR USD EUR COP PKR MAD VND KWD 20211101 1.921229 0.4688510 1.0674461 0.4060791 0.2742695 0.2494883 0.7368544 0.8183282 -0.1983854 0.1802669 0.2380354 2.0728273 0.4553152 1.4852609 0.2246616 0.6056059 1.0619356 0.8526254 0.5017740 0.3484977 1.9862619 0.3271341 0.4070905 0.4315440 0.2473326 1.8166358 0.7987499 0.4689765 0.9999885 0.3799556 1.379868 0.3789380 0.4496709 0.6088787 -0.2059428 18.8350610 0.3887351 20211102 1.902356 3.4981287 0.7107828 1.8692653 2.5631727 0.9717993 0.8817259 2.0145440 1.1616943 2.7340565 0.8897690 1.1443288 2.6812282 0.7343707 2.8771638 1.0687064 0.7830633 0.8951068 2.5405232 2.2509661 0.4076537 0.6290899 1.2925696 0.4783448 2.5686343 2.2256709 0.5952861 0.4753202 0.6695847 1.0029553 1.478536 1.7575035 0.5605032 2.9609335 9.0417309 5.7913594 0.4402254 20211103 2.201602 0.5640756 0.2399627 0.8924906 0.5567438 1.2672409 -0.6986992 0.1369361 0.2384106 0.5843795 -2.0739822 -1.0321382 0.6933227 -1.0064571 0.6337199 -1.1374831 0.0802763 -0.2332400 0.4681542 0.3578528 2.4293218 0.3747505 0.2752870 -2.2122629 0.7862732 0.9549091 -0.3592348 -0.2035245 -0.8963470 -1.0355660 1.622678 0.3829586 0.5873170 0.5504126 1.2958217 0.9249854 0.1835423 20211104 3.475965 -0.5172885 1.1350444 1.7645243 0.0879490 0.9387348 0.8932952 1.5009133 1.3775472 -0.3326538 1.6076798 0.6128980 1.0467821 0.5182954 0.1749804 0.6266352 0.9670999 0.7721434 1.1180306 1.2305035 0.5914647 0.2411035 1.7916372 1.5185143 0.4029235 1.0270948 0.8688852 1.4262714 0.5730770 1.1508846 1.284299 0.5706411 -1.1054617 0.5443404 2.3360354 0.3445358 0.5044400 20211105 1.634890 2.4048807 1.6123438 1.4803050 1.5672978 1.5651723 0.1153727 1.6857541 1.0692995 1.7034224 0.5536822 1.4209082 1.4600869 0.8436028 1.8274354 0.6016128 0.8184591 0.1016602 1.2000467 1.6184789 2.1750529 0.7560540 1.1799373 0.2098499 1.6383837 1.6331112 0.7624569 -2.5206689 0.3742916 0.2965261 1.177933 1.0695659 2.3062143 0.7226642 0.7940118 5.3580365 1.1808708 20211108 2.407575 0.9910272 1.4785931 1.5428648 0.7799334 1.4290758 -0.4388591 0.8039943 1.7358993 0.4381568 0.2347812 0.7659005 0.9597848 0.6397921 1.0295891 0.5721386 0.7153961 1.3265440 -0.0318968 0.2355181 0.9207620 0.5423476 1.3987541 1.1802137 0.6220521 0.1351241 0.9539657 0.3660692 0.7299007 1.3329559 1.184032 0.2017590 1.8294634 2.9207246 8.1932500 3.6730166 1.0971539 6.3.2 Ranking Currencies Next, we sort the currencies in each universe into five equal bins based on their 20-day Percentage Flow Compounded value for the selected holding period. To do this, we will use the function from library('EPFR'), called bbk(). This function will output a standardized backtest result. The bbk() function requires our compounded daily percentage flow file, a return file, and our selected universe. Please refer to the library documentation for the complete list of parameters of this function. The first parameter we add is the number of bins we want to use. For our case, we want to use 5 because our strategy is to go long the top fifth and short the bottom fifth. nBin &lt;- 5 # NUMBER OF BINS Since EPFR data is published with T+1 day lag and is released around 5:00 pm EST, we account for a T+2 day delay in our model since that is when one can trade on the information. Users interested in more timely signals can also use the T+2 Open Prices for backtesting purposes. EPFR also offers a Premium Daily offering, an earlier release of the end-of-day data covering a significant subset of fund-level flow information. delay &lt;- 2 # DELAY IN KNOWING DATA (IN WEEKDAYS) - data takes time to have It is also important to note that this model will need to be re-balanced weekly. The day of the week the rebalancing occurs is at the discretion of the user. For this example we will set the day of the week to trade as Friday. doW &lt;- 5 # DAY OF THE WEEK YOU WILL TRADE ON (5 = FRIDAYS) Additionally, we also evaluate the returns for different holding periods. The user can input return horizons that they are interested in here. For this example we define a return horizon for weekly, fortnightly, monthly, bi-monthly, quarterly, and semi-annually. hz &lt;- c(5, 10, 20, 45, 65, 130) # RETURN HORIZON (IN WEEKDAYS) - holding periods Now that we have defined all of our inputs, to rank the currencies into quintiles by their 20-day percentage flow, we call function bbk() for a 1-week holding period. z &lt;- bbk(x, y, 1, hz[1], nBin, doW, T, 0, delay, idx) 6.3.3 Model Twenty-day flow percentage ranked into quintiles (computed only where forward returns are available) z[[&quot;bins&quot;]] ARS AUD BRL CAD CHF CLP CNY CZK EGP GBP HUF IDR ILS INR JPY KRW MXN MYR NOK NZD PEN PHP PLN RUB SEK SGD THB TRY TWD ZAR USD EUR COP PKR MAD VND KWD 20211126 2 1 4 1 2 5 4 5 4 3 5 3 1 3 1 5 5 2 4 1 3 2 5 5 3 1 1 4 3 4 2 3 4 2 NA NA 2 20211119 1 2 4 1 2 3 3 5 1 2 5 3 3 3 2 4 4 4 2 2 5 3 5 5 1 1 4 5 4 4 1 3 5 1 NA NA 2 20211112 1 1 4 2 1 2 5 1 3 2 5 4 1 5 1 5 5 4 2 3 4 4 3 4 1 2 4 3 5 3 2 2 5 3 NA NA 3 20211105 1 2 3 1 2 1 4 4 3 2 5 5 2 5 2 5 4 4 3 3 1 3 3 5 1 1 4 4 5 5 1 3 2 2 NA NA 4 Quintile Returns over the equal-weight universe z[[&quot;rets&quot;]] Q1 Q2 Q3 Q4 Q5 TxB uRet 20211126 -0.3143363 0.1764768 -0.2019239 -1.2014936 1.5412770 -1.8556133 0.2425766 20211119 0.4821234 0.4455518 0.6382267 -0.5845357 -0.9813663 1.4634897 -1.5876957 20211112 0.2961060 -0.0445711 -1.3523419 0.5025271 0.5982800 -0.3021740 -1.5849676 20211105 0.2478839 -0.1722851 0.1182566 0.0903440 -0.2841994 0.5320833 -0.7804385 6.3.4 Performance Performance over all holding periods fcn &lt;- function(retW) {as.matrix(bbk(x, y, 1, retW, 5, doW, T, 0, delay, idx)$summ)} # DEFINE SUMMARY FUNCTION t(mat.ex.array(sapply(split(hz, hz), fcn, simplify = &quot;array&quot;))) # WRITE SUMMARIES Q1 Q2 Q3 Q4 Q5 TxB uRet Bi-Monthly AnnMn 3.659518e-01 4.261550e-02 1.029430e-01 -4.731490e-02 -4.479541e-01 8.139059e-01 -2.244316e+00 AnnSd 3.269173e+00 2.870747e+00 2.944263e+00 3.081608e+00 3.450197e+00 5.666856e+00 1.087973e+01 Sharpe 1.244038e+01 1.670734e+00 4.418545e+00 -1.376680e+00 -1.311764e+01 1.504197e+01 -2.071072e+01 HitRate 2.640834e+00 2.357610e+00 1.988795e+00 1.847183e+00 -2.707750e-01 1.976346e+00 -2.113290e+00 Beta -4.504540e-02 -3.077880e-02 -3.884060e-02 3.417070e-02 8.152680e-02 -1.265721e-01 1.000000e+00 Alpha 2.621562e-01 -2.807460e-02 1.733410e-02 3.017190e-02 -2.631299e-01 5.252861e-01 0.000000e+00 DrawDn -1.236127e+01 -1.049253e+01 -1.279761e+01 -1.385315e+01 -1.820612e+01 -2.223186e+01 -5.788302e+01 DDnBeg 2.013302e+07 2.010939e+07 2.010846e+07 2.010954e+07 2.009822e+07 2.012294e+07 2.011062e+07 DDnN 2.077778e+01 3.333333e+01 3.233333e+01 3.655556e+01 4.855556e+01 2.733333e+01 5.122222e+01 AnnTo 4.139082e+02 4.544748e+02 4.433571e+02 4.482824e+02 4.260119e+02 8.399201e+02 0.000000e+00 Fortnightly AnnMn 3.228152e-01 4.711120e-01 4.441306e-01 -5.324450e-02 -1.132851e+00 1.455666e+00 -2.351059e+00 AnnSd 3.428686e+00 3.018408e+00 3.259224e+00 3.095792e+00 3.559849e+00 5.850413e+00 9.989152e+00 Sharpe 9.464187e+00 1.605952e+01 1.365886e+01 -1.860001e+00 -3.339792e+01 2.507405e+01 -2.354025e+01 HitRate -3.280795e-01 4.579443e-01 4.593113e-01 1.236791e+00 -2.805763e+00 2.938362e+00 -3.277378e-01 Beta 2.862000e-04 -3.186500e-03 -4.496780e-02 -3.289300e-03 5.103720e-02 -5.075100e-02 1.000000e+00 Alpha 3.238001e-01 4.638544e-01 3.383386e-01 -6.119330e-02 -1.013049e+00 1.336849e+00 0.000000e+00 DrawDn -1.161437e+01 -7.098433e+00 -9.674186e+00 -1.607684e+01 -2.783884e+01 -1.661634e+01 -6.085436e+01 DDnBeg 2.019562e+07 2.012562e+07 2.013081e+07 2.009601e+07 2.011080e+07 2.017567e+07 2.011058e+07 DDnN 3.900000e+01 3.200000e+01 1.300000e+02 2.125000e+02 2.390000e+02 3.700000e+01 2.300000e+02 AnnTo 1.800094e+03 2.014802e+03 1.991776e+03 2.029122e+03 1.844908e+03 3.645002e+03 0.000000e+00 Monthly AnnMn 9.109228e-01 1.634903e-01 1.227630e-02 -3.123483e-01 -7.733168e-01 1.684240e+00 -2.357752e+00 AnnSd 3.483450e+00 2.870210e+00 3.179843e+00 3.358640e+00 3.301151e+00 5.646567e+00 1.034825e+01 Sharpe 2.770431e+01 6.641630e+00 2.173767e-01 -9.320418e+00 -2.407100e+01 3.112093e+01 -2.280232e+01 HitRate 4.517085e+00 1.242078e+00 5.931386e-01 1.956462e-01 -1.762882e+00 5.431937e+00 -1.640259e+00 Beta -1.744710e-02 -1.599650e-02 -3.851500e-02 8.386800e-03 6.323350e-02 -8.068060e-02 1.000000e+00 Alpha 8.704199e-01 1.251400e-01 -7.884870e-02 -2.907842e-01 -6.254477e-01 1.495867e+00 0.000000e+00 DrawDn -1.019128e+01 -1.083900e+01 -1.268465e+01 -2.059624e+01 -2.064839e+01 -1.654785e+01 -5.962323e+01 DDnBeg 2.017344e+07 2.010562e+07 2.014559e+07 2.008819e+07 2.010326e+07 2.011572e+07 2.011055e+07 DDnN 2.750000e+01 2.125000e+01 5.300000e+01 1.072500e+02 1.247500e+02 4.250000e+01 1.157500e+02 AnnTo 9.065563e+02 1.000787e+03 1.004002e+03 1.008091e+03 9.374313e+02 1.843988e+03 0.000000e+00 Quarterly AnnMn 5.133031e-01 3.305175e-01 -4.117000e-02 -2.530197e-01 -5.408357e-01 1.054139e+00 -2.208900e+00 AnnSd 3.196699e+00 2.845606e+00 3.051886e+00 2.999375e+00 3.347713e+00 5.446590e+00 1.106813e+01 Sharpe 1.681142e+01 1.117917e+01 -1.692233e+00 -6.812789e+00 -1.591663e+01 1.951696e+01 -2.003489e+01 HitRate 5.305040e+00 2.519894e+00 1.724138e+00 9.283820e-01 -1.856764e+00 4.641910e+00 -5.172414e+00 Beta -2.785050e-02 -3.877500e-02 -3.950180e-02 3.315330e-02 7.606810e-02 -1.039186e-01 1.000000e+00 Alpha 4.532385e-01 2.437019e-01 -1.255514e-01 -1.815748e-01 -3.735467e-01 8.267852e-01 0.000000e+00 DrawDn -9.948877e+00 -9.580469e+00 -1.206465e+01 -1.461782e+01 -2.037046e+01 -1.769754e+01 -5.611454e+01 DDnBeg 2.012209e+07 2.010906e+07 2.011376e+07 2.008459e+07 2.010835e+07 2.012141e+07 2.010832e+07 DDnN 1.661538e+01 1.576923e+01 2.515385e+01 3.315385e+01 2.900000e+01 1.776923e+01 3.692308e+01 AnnTo 2.924214e+02 3.201718e+02 3.135657e+02 3.184919e+02 3.004042e+02 5.928256e+02 0.000000e+00 Semi-Annual AnnMn 4.322030e-01 4.633787e-01 -9.155060e-02 -2.324240e-01 -5.588495e-01 9.910525e-01 -2.148353e+00 AnnSd 3.173137e+00 2.763453e+00 2.997886e+00 2.909363e+00 3.393845e+00 5.399690e+00 1.169062e+01 Sharpe 1.493992e+01 1.740971e+01 -3.759073e+00 -7.333405e+00 -1.658202e+01 1.852100e+01 -1.851764e+01 HitRate 6.380258e+00 4.215612e+00 1.534672e+00 -9.236453e-01 -3.078818e+00 7.275483e+00 -6.721296e+00 Beta -2.784240e-02 -4.348010e-02 -3.591450e-02 1.514510e-02 9.542740e-02 -1.232698e-01 1.000000e+00 Alpha 3.733726e-01 3.669320e-01 -1.646337e-01 -1.997245e-01 -3.557899e-01 7.291625e-01 0.000000e+00 DrawDn -9.919553e+00 -7.897396e+00 -1.227886e+01 -1.414037e+01 -1.706241e+01 -1.513292e+01 -5.279337e+01 DDnBeg 2.012017e+07 2.010453e+07 2.009955e+07 2.009611e+07 2.011068e+07 2.012094e+07 2.010597e+07 DDnN 8.538462e+00 1.026923e+01 1.361538e+01 1.473077e+01 1.569231e+01 7.269231e+00 1.896154e+01 AnnTo 1.490958e+02 1.616830e+02 1.568036e+02 1.609671e+02 1.539729e+02 3.030687e+02 0.000000e+00 Weekly AnnMn 5.983488e-01 8.968437e-01 4.277803e-01 -1.233923e+00 -6.206563e-01 1.219005e+00 -2.371707e+00 AnnSd 3.603818e+00 3.614139e+00 3.088837e+00 3.342272e+00 3.828723e+00 6.091824e+00 9.707049e+00 Sharpe 1.660319e+01 2.481487e+01 1.384923e+01 -3.691867e+01 -1.621053e+01 2.001051e+01 -2.443284e+01 HitRate 3.002611e+00 1.566580e+00 1.436031e+00 0.000000e+00 -1.044386e+00 6.527415e-01 -2.219321e+00 Beta 1.273000e-04 1.593800e-03 -6.092560e-02 2.204970e-02 3.876490e-02 -3.863760e-02 1.000000e+00 Alpha 5.986507e-01 9.006237e-01 2.832825e-01 -1.181627e+00 -5.287173e-01 1.127368e+00 0.000000e+00 DrawDn -8.386794e+00 -8.312592e+00 -1.098149e+01 -2.513949e+01 -1.959935e+01 -1.792222e+01 -6.285831e+01 DDnBeg 2.009021e+07 2.007091e+07 2.012041e+07 2.008023e+07 2.013063e+07 2.009021e+07 2.011043e+07 DDnN 2.300000e+02 1.010000e+02 1.830000e+02 6.440000e+02 4.440000e+02 2.300000e+02 4.640000e+02 AnnTo 3.454544e+03 4.001181e+03 3.975967e+03 4.018637e+03 3.598234e+03 7.052779e+03 0.000000e+00 Annualized mean one-week returns bbk(x, y, 1, hz[1], nBin, doW, T, 0, delay, idx)$annSumm # DISPLAY CALENDAR-YEAR RETURNS Q1 Q2 Q3 Q4 Q5 TxB uRet nPrds 2007 0.2516514 -3.0223681 -3.1650345 0.6431651 5.2925861 -5.0409347 13.1946215 35 2008 2.7409669 -0.7663375 3.2042354 -5.4055047 0.2266398 2.5143271 -13.1533701 52 2009 -1.5291806 -1.6289655 0.1779812 1.9307456 1.4940522 -3.0232327 10.2375370 52 2010 1.2771189 -2.3973535 2.2347541 -1.2789899 -0.3607216 1.6378404 2.9512123 53 2011 -3.4098905 1.6363491 -0.0346503 0.9866233 1.1962787 -4.6061692 -4.1065988 52 2012 0.3759461 1.4990221 -2.2126676 0.5677893 0.0651689 0.3107772 3.4833257 52 2013 -0.4459152 0.1016178 -2.9508640 -0.5948434 3.9570220 -4.4029372 -4.9124563 52 2014 1.4214920 6.1682728 -0.8317866 -2.4685137 -4.9060910 6.3275830 -16.2172346 52 2015 4.9967529 4.6105364 -2.1201550 0.1100902 -8.3839956 13.3807484 -14.6408438 52 2016 0.0178822 -1.7268778 4.4124733 -2.6965363 0.7942841 -0.7764019 -6.0898082 53 2017 1.9424454 0.2965310 1.6799891 -2.1857760 -1.8833822 3.8258276 12.5654405 52 2018 1.0199171 1.8156397 -0.2277828 -7.5473248 4.1207386 -3.1008215 -9.3094558 52 2019 2.0396141 0.5351104 -0.5550176 0.9926044 -3.0963050 5.1359191 -0.9546108 52 2020 -1.7976431 -1.0896345 6.4825526 -4.5150249 1.9562170 -3.7538602 4.7790869 52 2021 -0.0290940 6.1525670 -0.9370289 3.5041970 -7.7443755 7.7152816 -8.2316355 53 2022 NaN NaN NaN NaN NaN NaN NaN 0 output: html_document "],["flow-percentage-dm-rates-strategy.html", "7 Flow-Percentage DM Rates Strategy 7.1 Overview 7.2 Daily Percentage Flow 7.3 Strategy Implementation", " 7 Flow-Percentage DM Rates Strategy 7.1 Overview The Flow-Percentage DM Rates Strategy is a bond based rotation strategy, which ranks different G10 10 Year Rates, based on a percentage flow indicator. This approach uses the stated allocations of bond funds with a cross-border focus and calculates percentage flow into G10 countries. In terms of twenty-day percentage flows, the top fifth of G10 10 year rates outperform the bottom fifth by around 22pbs per year. G10 Countries used in analysis are: 1. United States 2. Europe 3. United Kingdom 4. Japan 5. Australia 6. New Zealand 7. Canada 8. Switzerland 9. Norway 10. Sweden 7.2 Daily Percentage Flow The Flow-Percentage DM Rates Strategy developed by EPFR Global is based on percentage flow into countries via cross-border bond funds. In this section, the reader will gain an understanding of the aggregations which can be used to create a signal as well as the methodology behind daily percentage flow calculations. 7.2.1 Aggregations The first step is defining a subset of data to capture in calculating our signal. This strategy requires; Bond funds with a cross-boarder focus. These are essentially any fund that has a mandate spanning more than one country. The vast majority of these will be global and regional funds. Funds must report both daily flows and country allocations, since these values are needed to calculate Daily Percentage Flow. Cross-border bond funds, which report their country allocations and their fund flows, are a subset of those that only report their fund flows to EPFR. The figure below shows EPFRs coverage of this universe over time compared to our total coverage. Updated at the end of July each year Users looking for more specific detail can customize this aggregation even further using EPFRs fund-level or share class-level granularity. Some good examples would be Active/Passive, ETF or Mutual funds, Institutional or Retail. Users can use these tags to different degrees in creating aggregated signals to backtest. Further detail about this is available in section 3. This can be achieved using fund-level flow files or reaching out to EPFRs quant team for customized aggregations. 7.2.2 Calculation To begin calculating the Daily Percentage flow, we start with our subset of cross-border bond funds. To calculate the funds impact on a country, we scale a funds flow by multiplying it against its stated country allocation, which is available in EPFRs Country Allocation Database, on that day. EPFR releases country allocations of all funds on the \\(23^{\\text{rd}}\\) of each month (or the next available business day) at a monthly frequency. Hence, our calculation assumes constant country allocation between two consecutive release dates within the month. We then apply the same procedure to all funds with a fund flow and country allocation information and then sum the flows for each country across all funds. \\[\\text{Total Impact}_{c,t} = \\sum^{N}_{i=m}{\\text{Flow}_i \\times \\text{Allocation}_i}\\] Where: \\(\\text{Total Impact}\\) = the impact on a country \\(c\\), across all funds \\(i\\), for day \\(t\\) Additionally, we repeat the process across the same funds Assets held under Management (AuM), to get the total AuM held in a country. \\[\\text{Total AuM}_{c,t} = \\sum^{N}_{i=m}{\\text{AuM}_i \\times \\text{Allocation}_i}\\] Where: \\(\\text{Total AuM}\\) = the assets held in a country \\(c\\), across all funds \\(i\\), for day \\(t\\) Finally, to find the daily percentage flow for a country, we divide the Total Impact by the Total AuM. Then we repeat this across all different countries for the entire history. \\[\\text{Percentage Flow}_{c,t} = \\frac{\\text{Total Impact}_{c,t}}{\\text{Total AuM}_{c,t}}\\] Where: \\(\\text{Percentage Flow}\\) = the scaled flow as a percentage into a country \\(c\\), across all funds \\(i\\), for day \\(t\\) 7.2.3 Flow File The users may create flow percentages for their desired country aggregations and granularity using the methodology described in the previous section. EPFR also provides a pre-calculated aggregation for its users for the Flow-Percentage DM Strategy. This file can be found on the FTP under the strategies folder. Please refer to the FTP Folder Structure section for the exact location of this file. This file contains daily cross-border bond fund flow data for 52 countries and is updated daily at 5:00 PM est. with a T+1 day lag. For this demonstration, we use the pre-calculated file FloPctCtry-B-daily.csv. Below shows a snippet of what this file contains. AU CA CH DE GB JP NO NZ SE US 20211201 -0.0007020 -0.0015174 0.0004122 -0.0010397 -0.0006906 -0.0001968 0.0009049 -0.0003805 0.0001095 -0.0023166 20211202 -0.0004375 -0.0002560 -0.0002809 -0.0009476 -0.0004765 0.0000392 -0.0008211 -0.0010253 -0.0007682 -0.0004119 20211203 -0.0003314 -0.0001907 0.0003749 0.0007579 0.0000204 -0.0007797 -0.0002024 0.0004397 0.0001894 -0.0009936 20211206 0.0000657 -0.0000962 -0.0011922 -0.0004092 -0.0005934 0.0005597 -0.0000267 -0.0003495 -0.0002973 -0.0013883 20211207 -0.0003327 -0.0001279 -0.0005822 -0.0005074 -0.0003590 0.0000254 -0.0005952 -0.0005382 -0.0007128 -0.0005743 20211208 -0.0006319 -0.0023702 -0.0002574 -0.0006398 -0.0007982 -0.0008411 -0.0022261 -0.0003871 0.0003074 -0.0012151 We will download this file from the ftp using ftp.get(), more about this function can be referred to in section 2.3. file &lt;- &quot;EPFRHistory/Strategies/daily/FloPctCtry-B-daily.csv&quot; # PATH TO .csv FILE fldr &lt;- &quot;C:\\\\temp&quot; # LOCAL FOLDER ftp.get(file, fldr, &quot;filetransport.epfrglobal.com&quot;, w = &quot;username&quot;, h = &quot;password&quot;, &quot;ftp&quot;) # DOWNLOADS FILE FROM FTP TO LOCAL FOLDER, USING CREDENTIALS After downloading the csv file you will store its path as flow.file. A quick way to do this is shown below: flow.file &lt;- paste(fldr, ftp.file(file), sep = &quot;\\\\&quot;) # STORES FLOW FILE PATH, C:\\\\temp\\\\FloPctCtry-B-daily.csv 7.2.4 Return File The return file for this strategy should contain daily bond returns for each of the countries in the flow file, which the user can find with their own resources. EPFR also provides Fund Return data, that can be used as a proxy to returns. To create a return file using EPFR daily flow data, the following equation can be used: \\[\\text{Fund Return}_{c,t} = \\frac{\\sum^{N}_{i=m} \\text{Portfolio Change}_i}{\\sum^{N}_{i=m} \\text{Assets Start}_i}\\] Where: \\(\\text{Fund Return}\\) = the return value of country \\(c\\), across all funds \\(i\\), for day \\(t\\) For this demonstration, we will the file which has been locally named g10rates.csv. ret.file &lt;- &quot;g10rates.csv&quot; For your reference a snippet of our return file looks like this AU CA CH DE GB JP NO NZ SE US 20211201 1.7300 1.494 -0.272 -0.345 0.820 0.065 1.488 2.458 0.147 1.405 20211202 1.6800 1.505 -0.306 -0.372 0.811 0.063 1.422 2.423 0.086 1.446 20211203 1.6100 1.437 -0.313 -0.391 0.747 0.053 1.471 2.390 0.084 1.345 20211206 1.5825 1.523 -0.329 -0.391 0.738 0.045 1.440 2.347 0.071 1.436 20211207 1.6475 1.579 -0.318 -0.377 0.730 0.056 1.460 2.418 0.064 1.476 20211208 1.6200 1.591 -0.287 -0.315 0.775 0.050 1.517 2.430 0.096 1.523 7.3 Strategy Implementation The final step is implementing this strategy to create a signal. Lets begin by reading in the flow and return files to our R studio work space. x &lt;- read.csv(flow.file, row.names = 1) # GET FLOW PERCENTAGE y &lt;- read.csv(ret.file, row.names = 1) # GET RETURN We must now make sure our files only use G10 countries and have the same columns. We will also subset the flow file \\(x\\) to use the same countries as \\(y\\). x &lt;- x[, is.element(dimnames(x)[[2]],dimnames(y)[[2]])] # SUBSET TO G10 COUNTRIES y &lt;- y[,dimnames(x)[[2]]] * Note: subsetting can be also be done when creating the flow and return files 7.3.1 Compounding Flows Next, we set up a variable for our look-back period, which can also be called a flow window. This variable will be the window of time we use to create a trailing compounded daily percentage flow. The look-back period we choose for our demonstrations is 20 days. lookback &lt;- 20 # FLOW WINDOW (IN WEEKDAYS) - 20 day look back period Again, using a function from the library('EPFR'), compound.flows() compounds the daily percentage flow over the trailing lookback period for each country. x &lt;- compound.flows(x, lookback, F) # COMPOUND FLOWS AU CA CH DE GB JP NO NZ SE US 20211201 -0.0140398 -0.0303430 0.0082447 -0.0207913 -0.0138116 -0.0039352 0.0180996 -0.0076095 0.0021904 -0.0463225 20211202 -0.0087503 -0.0051208 -0.0056184 -0.0189494 -0.0095304 0.0007835 -0.0164210 -0.0205034 -0.0153626 -0.0082383 20211203 -0.0066284 -0.0038134 0.0074981 0.0151591 0.0004079 -0.0155935 -0.0040488 0.0087939 0.0037885 -0.0198695 20211206 0.0013137 -0.0019235 -0.0238412 -0.0081845 -0.0118680 0.0111940 -0.0005341 -0.0069902 -0.0059450 -0.0277629 20211207 -0.0066546 -0.0025586 -0.0116425 -0.0101484 -0.0071789 0.0005085 -0.0119029 -0.0107644 -0.0142548 -0.0114857 20211208 -0.0126372 -0.0473937 -0.0051485 -0.0127949 -0.0159634 -0.0168198 -0.0445135 -0.0077408 0.0061490 -0.0242992 7.3.2 Ranking Countries Next, we sort the countries in each universe into five equal bins based on their 20-day Percentage Flow Compounded value for the selected holding period. To do this, we will use the function from library('EPFR'), called bbk(). This function will output a standardized backtest result. The bbk() function requires our compounded daily percentage flow file, a return file, and our selected universe. Please refer to the library documentation for the complete list of parameters of this function. The first parameter we add is the number of bins we want to use. For our case, we want to use 5 because our strategy is to go long the top fifth and short the bottom fifth. nBin &lt;- 5 # NUMBER OF BINS Since EPFR data is published with T+1 day lag and is released around 5:00 pm EST, we account for a T+2 day delay in our model since that is when one can trade on the information. Users interested in more timely signals can also use the T+2 Open Prices for backtesting purposes. EPFR also offers a Premium Daily offering, an earlier release of the end-of-day data covering a significant subset of fund-level flow information. delay &lt;- 2 # DELAY IN KNOWING DATA (IN WEEKDAYS) - data takes time to have It is also important to note that this model will need to be re-balanced weekly. The day of the week the rebalancing occurs is at the discretion of the user. For this example we will set the day of the week to trade as Friday. doW &lt;- 5 # DAY OF THE WEEK YOU WILL TRADE ON (5 = FRIDAYS) Additionally, we also evaluate the returns for different holding periods. The user can input return horizons that they are interested in here. For this example we define a return horizon for weekly, fortnightly, monthly, bi-monthly, quarterly, and semi-annually. hz &lt;- c(5, 10, 20, 45, 65, 130) # RETURN HORIZON (IN WEEKDAYS) - holding periods Now that we have defined all of our inputs, to rank the countries into quintiles by their 20-day percentage flow, we call function bbk() for a 1-week holding period. z &lt;- bbk(x, y, 1, hz[1], nBin, doW, T, 0, delay) 7.3.3 Model Twenty-day flow percentage ranked into quintiles (computed only where forward returns are available) z[[&quot;bins&quot;]] AU CA CH DE GB JP NO NZ SE US 20211231 2 1 5 2 4 1 4 3 3 5 20211224 1 1 4 4 3 2 5 2 3 5 20211217 2 5 1 4 3 4 3 2 1 5 20211210 2 5 1 3 3 4 5 2 1 4 20211203 4 5 1 4 3 2 1 3 2 5 Quintile Returns over the equal-weight universe z[[&quot;rets&quot;]] Q1 Q2 Q3 Q4 Q5 TxB uRet 20211231 51.442115 -39.570908 28.0605000 6.266251 -46.197958 97.6400732 7.4724679 20211224 2.463720 4.776837 15.4648343 -25.883092 3.177701 -0.7139815 -0.8314551 20211217 12.257956 -9.276437 6.5525480 -8.296766 -1.237302 13.4952573 9.7792957 20211210 14.047904 -4.970177 5.6663565 -9.253285 -5.490799 19.5387025 0.2760121 20211203 3.469073 -3.888138 0.4014854 -5.360392 5.377972 -1.9088995 0.7659459 7.3.4 Performance Performance over all holding periods fcn &lt;- function(retW) {as.matrix(bbk(x, y, 1, retW, 5, doW, T, 0, delay)$summ)} # DEFINE SUMMARY FUNCTION mat.ex.array3d(sapply(split(hz, hz), fcn, simplify = &quot;array&quot;)) # WRITE SUMMARIES Q1 Q2 Q3 Q4 Q5 TxB uRet Bi-Monthly AnnMn NaN NaN NaN NaN NaN 3.960461e+01 NaN AnnSd NaN NaN NaN NaN NaN 4.433182e+02 NaN Sharpe NaN NaN NaN NaN NaN 1.045168e+01 NaN HitRate 2.605259e+00 -2.872722e+00 7.812737e-01 1.564067e+00 3.191974e-01 1.516095e+00 -7.046664e+00 Beta NaN NaN NaN NaN NaN NaN 1.000000e+00 Alpha NaN NaN NaN NaN NaN NaN 0.000000e+00 DrawDn NaN NaN NaN NaN NaN -1.258419e+03 NaN DDnBeg 2.017503e+07 2.014851e+07 2.016947e+07 2.015502e+07 2.016955e+07 2.016294e+07 2.014724e+07 DDnN 1.122222e+01 2.488889e+01 1.466667e+01 1.755556e+01 1.400000e+01 1.855556e+01 3.022222e+01 AnnTo 4.142944e+02 4.451478e+02 4.500616e+02 4.386741e+02 4.089670e+02 8.232614e+02 0.000000e+00 Fortnightly AnnMn NaN NaN NaN NaN Inf -2.237922e+02 NaN AnnSd NaN NaN NaN NaN NaN 1.139407e+03 NaN Sharpe NaN NaN NaN NaN NaN -2.005806e+01 NaN HitRate -1.370417e+00 -2.876854e+00 4.233981e+00 1.112395e+00 -1.827676e+00 -6.630390e-02 -4.757534e+00 Beta NaN NaN NaN NaN NaN NaN 1.000000e+00 Alpha NaN NaN NaN NaN NaN NaN 0.000000e+00 DrawDn NaN NaN NaN NaN NaN -6.012032e+03 NaN DDnBeg 2.020032e+07 2.020037e+07 2.017547e+07 2.017542e+07 2.015037e+07 2.018102e+07 2.016542e+07 DDnN 7.500000e+00 5.500000e+00 2.050000e+01 7.500000e+01 8.050000e+01 4.400000e+01 1.000000e+00 AnnTo 1.774081e+03 1.918541e+03 1.979709e+03 1.998417e+03 1.836994e+03 3.611075e+03 0.000000e+00 Monthly AnnMn NaN NaN NaN NaN Inf -9.517222e+01 NaN AnnSd NaN NaN NaN NaN NaN 8.127343e+02 NaN Sharpe NaN NaN NaN NaN NaN 2.960262e+00 NaN HitRate 1.901996e-01 -4.522156e+00 2.283759e+00 1.241410e+00 -2.208088e+00 3.526413e+00 -5.408077e+00 Beta NaN NaN NaN NaN NaN NaN 1.000000e+00 Alpha NaN NaN NaN NaN NaN NaN 0.000000e+00 DrawDn NaN NaN NaN NaN NaN -3.865981e+03 NaN DDnBeg 2.020029e+07 2.014819e+07 2.018562e+07 2.019059e+07 2.016569e+07 2.018551e+07 2.018042e+07 DDnN 1.025000e+01 5.675000e+01 1.125000e+01 8.750000e+00 4.100000e+01 2.650000e+01 2.000000e+00 AnnTo 9.131703e+02 9.941024e+02 9.856035e+02 9.907440e+02 9.430060e+02 1.856176e+03 0.000000e+00 Quarterly AnnMn NaN NaN NaN NaN NaN -1.247657e+01 NaN AnnSd NaN NaN NaN NaN NaN 4.706899e+02 NaN Sharpe NaN NaN NaN NaN NaN 9.543250e+00 NaN HitRate 2.623297e+00 2.771777e+00 2.367037e+00 4.585436e+00 -3.371847e-01 6.367467e-01 -1.009082e+01 Beta NaN NaN NaN NaN NaN NaN 1.000000e+00 Alpha NaN NaN NaN NaN NaN NaN 0.000000e+00 DrawDn NaN NaN NaN NaN NaN -1.483752e+03 NaN DDnBeg 2.016146e+07 2.016596e+07 2.017597e+07 2.016994e+07 2.016070e+07 2.015836e+07 2.013987e+07 DDnN 1.492308e+01 1.300000e+01 7.615385e+00 9.307692e+00 1.438462e+01 1.438462e+01 2.207692e+01 AnnTo 2.824934e+02 3.066313e+02 3.169761e+02 3.143236e+02 2.944297e+02 5.769231e+02 0.000000e+00 Semi-Annual AnnMn NaN NaN NaN NaN NaN -1.217973e+01 NaN AnnSd NaN NaN NaN NaN NaN 3.420400e+02 NaN Sharpe NaN NaN NaN NaN NaN 1.742681e+00 NaN HitRate -2.306745e+00 4.078249e+00 6.157635e-01 -1.705191e-01 1.970443e+00 1.373626e-01 -1.053903e+01 Beta NaN NaN NaN NaN NaN NaN 1.000000e+00 Alpha NaN NaN NaN NaN NaN NaN 0.000000e+00 DrawDn NaN NaN NaN NaN NaN -1.121633e+03 NaN DDnBeg 2.015262e+07 2.016450e+07 2.016902e+07 2.015572e+07 2.016339e+07 2.014186e+07 2.011220e+07 DDnN 8.961538e+00 6.461538e+00 5.269231e+00 7.653846e+00 7.423077e+00 1.080769e+01 1.642308e+01 AnnTo 1.486216e+02 1.549829e+02 1.603543e+02 1.541919e+02 1.520083e+02 3.006300e+02 0.000000e+00 Weekly AnnMn NaN NaN NaN NaN NaN -2.953599e+02 NaN AnnSd NaN NaN NaN NaN NaN 1.239273e+03 NaN Sharpe NaN NaN NaN NaN NaN -2.383333e+01 NaN HitRate -2.803129e+00 -2.549020e+00 3.455020e+00 3.594771e+00 -1.697128e+00 0.000000e+00 -4.367666e+00 Beta NaN NaN NaN NaN NaN NaN 1.000000e+00 Alpha NaN NaN NaN NaN NaN NaN 0.000000e+00 DrawDn NaN NaN NaN NaN NaN -8.287086e+03 NaN DDnBeg 2.020011e+07 2.020011e+07 2.020011e+07 2.020052e+07 2.020011e+07 2.019071e+07 2.015023e+07 DDnN 1.000000e+00 1.000000e+00 1.000000e+00 1.000000e+00 1.000000e+00 6.000000e+01 1.000000e+00 AnnTo 3.536815e+03 3.910183e+03 3.988251e+03 4.028982e+03 3.655614e+03 7.192428e+03 0.000000e+00 Annualized mean one-week returns bbk(x, y, 1, hz[1], 5, doW, T, 0, delay, sprds = T)$annSumm # DISPLAY CALENDAR-YEAR RETURNS Q1 Q2 Q3 Q4 Q5 TxB uRet nPrds 2007 0.5033670 -0.6138451 0.3276700 0.1173064 -0.3026330 0.8060000 -0.0337912 33 2008 -0.2093356 -0.1848356 0.2229644 0.2379644 -0.0766856 -0.1326500 -1.3718144 52 2009 -0.6084222 -0.2835722 1.0324278 -0.1407222 0.0199278 -0.6283500 0.7055722 52 2010 -0.1813143 0.1488366 -0.2382200 0.2213914 -0.0399822 -0.1413321 -0.2631876 53 2011 -0.5316200 -0.6752200 -0.1883200 0.5611800 0.8394300 -1.3710500 -1.3339800 52 2012 -0.1117867 0.3275133 -0.3790867 0.1083133 0.0031133 -0.1149000 -0.2274133 52 2013 -0.1958367 0.0111633 -0.1093367 0.3628133 -0.0899867 -0.1058500 0.8895367 52 2014 -0.2419333 -0.3356333 0.3821167 -0.1591833 0.3064667 -0.5484000 -1.0756667 52 2015 -0.1455556 -0.2805556 -0.0171556 0.4684444 -0.0194556 -0.1261000 -0.1212444 52 2016 -0.0479338 -0.2000092 0.3141040 0.2351229 -0.2966507 0.2487170 -0.1517266 53 2017 0.1266778 -0.3133222 -0.2373222 0.0766778 0.3366778 -0.2100000 -0.0056778 52 2018 -0.1141722 -0.0566722 0.1923278 -0.0126722 -0.0186722 -0.0955000 -0.0833278 52 2019 -0.2295744 0.1840256 0.2881256 0.1624256 -0.3652244 0.1356500 -0.4894756 52 2020 0.0838800 -0.0709200 0.2119300 0.0063300 -0.2312200 0.3151000 -0.4174300 52 2021 -0.0849998 -0.0329508 -0.0682715 0.2065926 -0.0661621 -0.0188377 0.5731621 53 2022 -0.6448000 -0.1187333 0.5936667 -0.1274000 0.2972667 -0.9420667 3.0567333 3 "],["activepassive-country-strategy.html", "8 Active/Passive Country Strategy 8.1 Overview 8.2 Active/Passive Indicator 8.3 Strategy Implementation", " 8 Active/Passive Country Strategy 8.1 Overview The Active/Passive Country Strategy is an equity-based rotation strategy that ranks different countries across a customized universe of developed and emerging markets. This approach uses the stated monthly allocations of equity funds with a cross-border mandate and EPFRs fund classification to create an indicator. In terms of twelve-month active over passive allocation, the top fifth of countries tend to outperform the bottom fifth by about 4% per year. This strategy works well everywhere but is slightly weaker within EAFE countries. 8.2 Active/Passive Indicator The Active/Passive Country Strategy developed by EPFR Global use the ratio of average allocation of active over passive funds. This section aims to give the reader an understanding of the methodology for constructing the variables used in the strategy. 8.2.1 Aggregations The first step is defining a subset of data to capture in calculating our signal. This strategy use the following portions of the EPFR dataset; Country allocation information at the fund level, using the EPFR Country Allocation database, for equity funds. Active/Passive tagging at the fund level, using EPFRs fund classifications. Active and passive equity funds which report their country allocations to EPFR have grown substantially over time. The figure below shows EPFRs coverage of these universes each year. Updated at the end of July each year Users looking for more specific detail can customize this aggregation even further using EPFRs fund-level or share class-level granularity. Some good examples would be ETF or Mutual funds, Institutional or Retail. Users can use these tags to different degrees in creating aggregated signals to backtest. Further detail about this is available in section 3. This can be achieved using fund-level flow files or reaching out to EPFRs quant team for customized aggregations. 8.2.2 Calculation To begin calculating the Active/Passive indicator, we start with our subset of active and passive cross-border equity funds. Then for each country, we compute equally-weighted average allocations to that country. These equal-weight averages are computed for both active and passive funds, shown below. \\[\\overline{\\text{Active Allocation}}_{c,t} = \\frac{\\sum^{N}_{i=m}{\\text{Allocation}_i}}{N}\\] Where: \\(\\overline{\\text{Active Allocation}}\\) = the equally-weighted average allocations to a country \\(c\\), across all Active funds \\(i\\), for month \\(t\\) \\[\\overline{\\text{Passive Allocation}}_{c,t} = \\frac{\\sum^{N}_{i=m}{\\text{Allocation}_i}}{N}\\] Where: \\(\\overline{\\text{Passive Allocation}}\\) = the equally-weighted average allocations to a country \\(c\\), across all Passive funds \\(i\\), for month \\(t\\) We then express the average allocation of active funds as percentage of that over passive funds to get our Active/Passive Indicator. \\[\\text{Active/Passive Indicatior}_{c,t} = \\frac{\\overline{\\text{Active Allocation}}_{c,t}}{\\overline{\\text{Passive Allocation}_{c,t}}}\\] Where: \\(\\text{Active/Passive Indicatior}\\) = percentage of a country \\(c\\), for month \\(t\\) 8.2.3 Aggregate Indicator File The users may create files for their desired active/passive country aggregations and granularity using the methodology described in the previous section. EPFR also provides a pre-calculated aggregation for its users for the Active/Passive Country Strategy. This file can be found on the FTP under the strategies folder. Please refer to the FTP Folder Structure section for the exact location of this file. This file contains daily flow data for 55 countries and is updated monthly at 5:00 PM est. with a T+23 day lag. For this demonstration, we use the pre-calculated file ActPasCtry-monthly.csv. Below shows a snippet of what this file contains. AU BR CA CN ID IN JP KR MX MY PH RU SG TH TR TW ZA AR CL CO CZ EG HU IL NZ NO PE PL SE CH GB AT BE DK FI FR DE GR IE IT NL PT ES HK US JO MA PK AE QA VE SA KW 202101 -0.4842930 0.4150756 -0.4364259 0.2079088 0.2164195 0.3822949 -0.4345855 0.3425339 0.3713933 -0.7645557 -0.0540928 0.9539886 0.2757319 -0.4278781 0.5541037 0.0909923 -0.2803025 2.767058 -0.1510407 -0.3433280 0.6674873 3.328116 2.628547 -0.0363938 -0.4393090 0.2007475 1.149532 0.8659927 -0.0679904 -0.1090891 -0.1081186 0.5446757 -0.4139206 -0.0637146 -0.4395024 -0.0977562 -0.2154738 1.459513 0.6028887 -0.1625783 -0.0850953 0.2993357 -0.3347136 0.0678976 0.0816381 -0.6012166 0.1522989 4.260898 -0.0652011 -0.5481180 NA -0.3583941 -0.6086421 202102 -0.4350863 0.3437013 -0.4564398 0.2012196 0.2271260 0.4176506 -0.4433361 0.4055674 0.3605876 -0.7253863 -0.0884671 0.9025293 0.3636807 -0.3816140 0.4998816 0.1091549 -0.2184110 2.334667 -0.1790099 -0.4356930 0.6629788 3.273972 2.664995 -0.1004885 -0.4213593 0.2128838 1.064260 0.7892569 -0.0565443 -0.1359253 -0.1085918 0.5659047 -0.4096920 -0.0611213 -0.4280816 -0.0865703 -0.2150385 1.345948 0.5908555 -0.1428328 -0.0887208 0.2464188 -0.3310095 0.1152102 0.0720925 -0.6375701 0.3014671 2.982935 -0.1230785 -0.5242151 NA -0.3782509 -0.6031131 202103 -0.4255943 0.2742038 -0.4572834 0.1904780 0.1525359 0.4332971 -0.4508080 0.4050846 0.4107241 -0.7230766 -0.0135045 0.9677850 0.4530019 -0.3344260 0.4190218 0.1151809 -0.1756233 2.292438 -0.1696651 -0.4216619 0.8062801 2.859963 2.594327 -0.0862807 -0.4302785 0.0878286 1.131446 0.8051074 -0.0937792 -0.1511770 -0.1129582 0.2849661 -0.4389468 0.0031483 -0.4294388 -0.0748250 -0.2160058 2.142074 0.5608574 -0.1808645 -0.0514697 0.1358351 -0.3230478 0.1290534 0.0845130 -0.6424937 0.0755595 3.026991 -0.0756252 -0.4823253 NA -0.3690425 -0.6438767 202104 -0.4365594 0.4268730 -0.5016492 0.2323195 0.1431811 0.4113223 -0.4605046 0.4142126 0.5036503 -0.7420016 -0.0370911 1.0291538 0.4215180 -0.3505252 0.6453842 0.1262232 -0.1472360 2.406958 -0.0910387 -0.3002927 0.5926772 2.830483 2.296006 -0.1341816 -0.4335931 0.1132884 1.362067 0.6143279 -0.1302394 -0.1478898 -0.0997141 0.2629861 -0.4265210 0.0078945 -0.4137574 -0.0648903 -0.2009253 2.518739 0.6985939 -0.1878903 -0.0401241 0.1483820 -0.3108114 0.1636075 0.0196048 -0.5466501 0.0629529 3.265394 -0.0724601 -0.4646560 NA -0.3541722 -0.6597718 202105 -0.4521698 0.3997981 -0.4724740 0.2451374 0.2746615 0.4511646 -0.4562845 0.4395004 0.4710186 -0.7372286 0.0701906 0.9538463 0.5154195 -0.3129703 0.5477444 0.1815414 -0.1216805 2.156303 -0.1299565 -0.2991802 0.6229523 2.847972 2.742774 -0.1273252 -0.4386890 0.0494176 1.005678 0.7413030 -0.1449933 -0.1747906 -0.0982047 0.2579482 -0.4260605 0.0318637 -0.4291017 -0.1060280 -0.2046156 2.109419 0.7284733 -0.1972640 -0.0687191 0.1557049 -0.3393949 0.1441411 0.0275183 -0.5535626 0.1446233 3.200477 -0.1319364 -0.4250997 NA -0.3513467 -0.6290139 202106 -0.4642693 0.3779240 -0.4769717 0.2282459 0.2511288 0.4612354 -0.4601138 0.3990682 0.4508048 -0.7421453 0.0661083 0.9826715 0.5172153 -0.3535127 0.4638790 0.1574633 -0.1005668 2.099245 -0.1603285 -0.4285019 0.4382229 2.834365 2.888080 -0.1151151 -0.4671630 0.0172631 1.065461 0.6863870 -0.1461361 -0.1722770 -0.0878939 0.1873609 -0.4511446 0.0395791 -0.4217503 -0.0931180 -0.2033025 2.112372 0.7349517 -0.1998956 -0.0774779 0.0243351 -0.3237628 0.1571862 0.0419183 -0.5362790 0.2227714 3.254044 -0.1630057 -0.4108080 NA -0.3518554 -0.6180695 We will download this file from the ftp using ftp.get(), more about this function can be referred to in section 2.3. file &lt;- &quot;EPFRHistory/Strategies/monthly/ActPasCtry-monthly.csv&quot; # PATH TO .csv FILE fldr &lt;- &quot;C:\\\\temp&quot; # LOCAL FOLDER ftp.get(file, fldr, &quot;filetransport.epfrglobal.com&quot;, w = &quot;username&quot;, h = &quot;password&quot;, &quot;ftp&quot;) # DOWNLOADS FILE FROM FTP TO LOCAL FOLDER, USING CREDENTIALS After downloading the csv file you will store its path as flow.file. A quick way to do this is shown below: flow.file &lt;- paste(fldr, ftp.file(file), sep = &quot;\\\\&quot;) # STORES FLOW FILE PATH, C:\\\\temp\\\\ActPasCtry-monthly.csv 8.2.4 Return File The return file for this strategy should contain daily returns for each of the countries in the flow file, which the user can find using their own resources. EPFR also provides Fund Return data, that can be used as a proxy to returns. To create a return file using EPFR daily flow data, the following equation can be used: \\[\\text{Fund Return}_{c,t} = \\frac{\\sum^{N}_{i=m} \\text{Portfolio Change}_i}{\\sum^{N}_{i=m} \\text{Assets Start}_i}\\] Where: \\(\\text{Fund Return}\\) = the return value of country \\(c\\), across all funds \\(i\\), for day \\(t\\) Since our flow file uses monthly data we will also want to ensure that our returns are also indexed by month. If your return file is indexed daily, you can use the function mat.daily.to.monthly(, T) from library('EPFR'). For this demonstration, we will use a file that has calculated total return indices, which has been locally named ETFCountryReturns.csv. ret.file &lt;- &quot;ETFCountryReturns.csv&quot; For your reference a snippet of our return file looks like this AU BR CA CN ID IN JP KR MX MY PH RU SG TH TR TW ZA AR CL CO CZ EG HU IL NZ NO PE PL SE CH GB AT BE DK FI FR DE GR IE IT NL PT ES HK US JO MA PK AE QA VE SA KW 202101 4582.897 466.273 6088.840 840.646 1554.905 781.309 7723.20 1146.467 448.237 367.901 457.235 759.005 12974.52 1244.982 142.624 568.123 527.728 182.752 294.349 2116.070 767.748 742.574 504.290 161.422 805.983 8498.045 2140.328 181.490 30492.68 15728.55 6132.36 3316.417 8794.039 39514.30 1299.575 7071.846 6668.621 5.890 451.366 842.893 22588.79 190.114 2949.511 73761.35 10420.14 124.893 379.874 445.200 574.623 1478.816 NA 1242.709 1141.067 202102 4703.834 436.815 6427.554 831.941 1577.277 822.165 7840.16 1148.912 450.021 368.629 465.840 778.142 13318.72 1267.459 139.136 594.252 543.120 202.877 317.781 2153.907 792.472 731.738 500.336 161.150 719.658 8850.219 2296.422 176.785 31342.84 15363.86 6352.79 3452.852 8697.774 39418.87 1283.623 7424.144 6802.822 6.310 454.302 890.941 23450.74 182.666 3103.679 77229.36 10687.87 122.216 369.339 419.339 560.481 1436.133 NA 1306.767 1101.829 202103 4737.184 455.419 6745.264 779.656 1478.088 840.821 7923.41 1151.512 487.714 361.423 443.965 818.748 13991.58 1297.723 117.153 591.511 576.078 195.403 344.005 2036.588 795.278 662.449 485.258 158.282 711.069 9423.215 2046.101 170.538 33184.58 15737.83 6527.60 3543.955 8778.910 39810.03 1256.728 7620.004 7080.625 6.580 493.454 932.981 24515.22 185.610 3119.581 77568.34 11085.83 122.399 368.058 425.759 588.372 1497.963 NA 1425.023 1163.428 202104 4970.888 484.776 7042.804 790.476 1474.909 833.036 7802.77 1185.606 501.575 373.835 443.200 817.983 14438.26 1284.898 118.829 637.087 574.960 210.012 312.131 1894.696 840.889 665.950 491.919 168.260 738.314 9770.974 1915.505 186.515 34519.80 16386.21 6813.74 3684.546 9384.972 42553.62 1341.023 8089.272 7320.304 7.056 497.722 937.585 25794.02 187.984 3289.175 79969.39 11686.17 125.849 381.845 413.993 597.512 1547.104 NA 1512.295 1225.607 202105 5132.288 531.468 7425.848 796.557 1493.695 905.264 7924.17 1190.652 542.250 366.771 467.916 896.022 14427.72 1277.419 121.055 629.471 616.096 206.928 300.822 1872.389 930.342 626.476 570.598 164.148 677.837 10086.706 2117.567 212.048 35801.63 17203.57 7087.10 4156.933 9785.044 44264.46 1392.125 8470.993 7544.946 7.359 509.878 997.828 26388.51 198.344 3474.676 81022.07 11737.39 159.125 396.513 438.115 651.339 1521.461 NA 1511.267 1251.473 202106 5062.434 559.755 7421.975 797.337 1402.042 898.949 7901.17 1207.171 532.305 352.545 477.477 933.607 14057.28 1234.519 116.589 633.470 567.705 206.714 295.208 1977.600 911.057 601.324 557.120 166.334 674.682 9882.020 1866.501 202.372 34999.11 17553.08 6917.04 3951.633 9589.243 45010.94 1392.801 8310.866 7413.258 7.117 505.364 966.963 26301.70 183.988 3285.174 79532.34 12060.22 162.333 400.106 397.467 654.172 1531.120 NA 1568.099 1274.233 8.3 Strategy Implementation The final step is implementing this strategy to create a signal. Lets begin by reading in the aggregate indicator and return files to our R studio work space. x &lt;- read.csv(flow.file, row.names = 1) # GET FLOW PERCENTAGE y &lt;- read.csv(ret.file, row.names = 1) # GET TOTAL RETURN INDEX One of our first options is choosing the universe we want to use. EPFR has tested this signal within three different universes of countries ACWI (All Country World Index), EAFE (Europe, Australasia, and the Far East (EAFE), and EM (Emerging Markets). For this example, we choose ACWI, which includes 52 countries. idx &lt;- &quot;ACWI&quot; Then, to subset the flow file \\(x\\) to the selected universe \\(idx\\) the function Ctry.msci.members.rng() from the library('EPFR') is used. This function returns a list of two letter country codes from \\(idx\\) that are in \\(x\\). x &lt;- x[, is.element(dimnames(x)[[2]], Ctry.msci.members.rng(idx, dimnames(x)[[1]][1], dimnames(x)[[1]][dim(x)[1]]))] # SUBSET TO INDEX COUNTRIES We will also subset the return file \\(y\\) to use the same countries as \\(x\\) in the same order. y &lt;- y[, dimnames(x)[[2]]] # TOTAL RETURN INDEX * Note: subsetting can be also be done when creating the flow and return files 8.3.1 Compounding Flows Next, we set up a variable for our look-back period, which can also be called a flow window. This variable will be the window of time we use to create a trailing compounded daily percentage flow. The look-back period we choose for our demonstrations is 12 months. lookback &lt;- 12 # LOOKBACK (IN MONTHS) Again, using a function from the library('EPFR'), compound.flows() compounds the Active/Passive indicator over the trailing lookback period for each country. x &lt;- compound.flows(x, lookback, F) # COMPOUND FLOWS AU BR CA CN ID IN JP KR MX MY PH RU SG TH TR TW ZA AR CL CO CZ EG HU IL NZ NO PE PL SE CH GB AT BE DK FI FR DE GR IE IT NL PT ES HK US JO MA PK AE QA VE SA KW 202101 -5.196272 4.717122 -4.975200 3.609267 3.774222 5.936389 -4.794293 5.344834 3.640939 -8.198844 0.1753037 10.71819 3.192630 -4.490696 4.441139 0.9672634 -2.870656 35.19766 -2.268678 -3.706678 7.344536 54.67726 32.80262 0.8817954 -5.035403 2.061707 23.87735 10.34234 -0.4778706 -0.9909018 -1.558529 7.804949 -5.352210 -0.0692337 -5.263890 -1.924184 -2.398852 13.51095 7.956969 -2.745253 -1.620538 0.8999484 -4.587698 3.179057 0.6997091 -6.690935 3.567305 66.54419 -0.4519949 -7.400598 NA -4.951610 4.883498 202102 -5.174844 4.898065 -5.032943 3.501458 3.702045 5.847768 -4.889841 5.286234 3.778730 -8.248584 -0.0955353 10.92413 3.391641 -4.531628 4.632457 1.0931203 -2.865060 36.10223 -2.095217 -3.929993 7.963304 53.74403 33.97085 0.7094227 -4.962401 2.125222 22.47158 10.53060 -0.4105990 -1.0438196 -1.525794 7.422922 -5.355968 -0.1908848 -5.255794 -1.822164 -2.395449 14.57853 7.844947 -2.647994 -1.558442 1.3927895 -4.540800 2.970746 0.6676549 -6.741030 3.884173 64.07215 -0.6070217 -7.142206 NA -5.016877 3.404095 202103 -5.167045 4.844591 -5.078628 3.379610 3.543459 5.764670 -4.974750 5.242504 3.846368 -8.285336 -0.2229443 11.17140 3.621457 -4.524165 4.781395 1.1786917 -2.846822 36.49068 -1.992952 -4.095526 8.657081 51.87337 34.60582 0.6603691 -4.900417 2.105176 21.06286 10.56693 -0.4172486 -1.1515315 -1.489311 6.919104 -5.348229 -0.2678862 -5.224924 -1.694832 -2.401449 16.33662 7.665786 -2.576914 -1.424520 1.6307884 -4.471640 2.743794 0.6852288 -6.799311 3.830853 61.99484 -0.7126204 -6.917581 NA -4.965778 2.414854 202104 -5.162311 4.845791 -5.179939 3.307312 3.335022 5.643681 -5.048401 5.256125 4.110575 -8.341380 -0.3428545 11.54626 3.840662 -4.498413 5.127363 1.2980770 -2.791659 36.63530 -1.868268 -4.206628 9.009626 50.48711 35.28440 0.4409993 -4.907426 2.077755 19.85698 10.62290 -0.4986297 -1.2338482 -1.443877 6.561417 -5.346840 -0.3346721 -5.175600 -1.564595 -2.399260 18.54214 7.595207 -2.520672 -1.285456 1.8700277 -4.373686 2.600200 0.6269297 -6.757924 3.634250 60.85036 -0.7896804 -6.671890 NA -4.889909 1.353711 202105 -5.182418 4.815258 -5.229160 3.217767 3.203406 5.577505 -5.091339 5.203532 4.331729 -8.389413 -0.3682233 11.70587 4.100885 -4.461760 5.286400 1.4423494 -2.705035 35.94963 -1.887433 -4.228125 8.942431 49.04026 35.69877 0.2264758 -4.953927 1.941894 18.17684 10.44691 -0.5998826 -1.3256688 -1.408568 6.043689 -5.304093 -0.3158202 -5.168014 -1.487675 -2.409172 19.94950 7.756602 -2.467961 -1.167166 2.0779908 -4.292955 2.397406 0.5981065 -6.672823 3.225570 59.06481 -0.9978718 -6.429910 NA -4.744131 0.025470 202106 -5.240223 4.782140 -5.280462 3.110531 3.113739 5.510247 -5.155383 5.105241 4.560123 -8.428469 -0.3331604 11.84088 4.372670 -4.440281 5.318129 1.5251602 -2.604452 34.70476 -1.901201 -4.365166 8.603666 47.31271 36.07047 -0.0317981 -5.017574 1.765044 16.88641 10.11207 -0.7268036 -1.4147605 -1.354409 5.728902 -5.282995 -0.2794079 -5.138249 -1.389586 -2.413784 21.11473 8.022516 -2.393334 -1.094689 2.0981111 -4.182919 2.242823 0.5865692 -6.596737 2.979670 57.37782 -1.1820172 -6.245469 NA -4.643544 -1.446588 8.3.2 Ranking Countries Next, we sort the countries in each universe into five equal bins based on the compounded Active/Passive indicator for the selected holding period. To do this, we will use the function from library('EPFR'), called bbk(). This function will output a standardized backtest result. The bbk() function requires our compounded Active/Passive indicator, total return index, and our selected universe. Please refer to the library documentation for the complete list of parameters of this function. The first parameter we add is the number of bins we want to use. For our case, we want to use 5 because our strategy is to go long the top fifth and short the bottom fifth. nBin &lt;- 5 # NUMBER OF BINS Since EPFR data is published with T+23 day lag and is released around 5:00 pm EST, we account for a T+1 month delay in our model since that is when one can trade on the information. delay &lt;- 1 # DELAY IN KNOWING DATA (IN MONTHS) It is also important to note that this model can be re-balanced monthly, quarterly, semi-annually or as desired. The day of the week the rebalancing occurs is at the discretion of the user, so for this example we will set the day of the week to trade as N/A. doW &lt;- NULL # DAY OF THE WEEK YOU WILL TRADE ON (5 = FRIDAYS) Additionally, we also evaluate the returns for different holding periods. The user can input return horizons that they are interested in here. For this example we define a return horizon for monthly, quarterly, semi-annually, and annually. hz &lt;- c(1, 3, 6, 12) # RETURN HORIZON (IN MONTHS) Now that we have defined all of our inputs, to rank the countries into quintiles by their 12 month cumulative indicator, we call function bbk() for a 1-month holding period. z &lt;- bbk(x, y, 1, hz[1], nBin, doW, T, 0, delay, idx) 8.3.3 Model 12 month cumulative indicator ranked into quintiles (computed only where forward returns are available) z[[&quot;bins&quot;]] AU BR CA CN ID IN JP KR MX MY PH RU SG TH TR TW ZA AR CL CO CZ EG HU IL NZ NO PE PL SE CH GB AT BE DK FI FR DE GR IE IT NL PT ES HK US JO MA PK AE QA VE SA KW 202112 NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA 1 3 NA NA 5 202111 5 2 5 2 2 2 5 2 2 5 3 1 1 4 1 3 4 NA 4 5 1 1 1 3 5 3 1 1 3 4 3 2 5 3 5 3 4 1 1 4 3 2 4 2 3 NA NA NA 4 5 NA 4 5 202110 5 2 5 2 2 2 5 2 2 5 3 1 2 4 2 NA 4 1 4 5 1 1 1 3 5 3 1 1 3 4 3 2 5 3 5 3 4 1 1 4 3 3 4 NA 3 NA NA 1 4 5 NA 4 5 202109 5 2 5 2 2 2 5 2 2 5 3 1 2 4 2 3 4 1 4 5 1 1 1 3 5 3 1 1 3 4 4 2 5 3 5 3 4 1 1 4 3 3 4 2 3 NA NA 1 4 5 NA 5 4 202108 5 2 5 2 2 2 5 2 2 5 3 1 2 4 2 3 4 1 4 5 1 1 1 3 5 3 1 1 3 4 4 2 5 3 5 3 4 1 1 4 3 3 4 2 3 NA NA 1 4 5 NA 5 4 202107 5 2 5 2 2 2 5 2 2 5 3 1 2 5 2 3 4 1 4 4 1 1 1 3 5 3 1 1 3 4 4 2 5 3 5 4 4 1 1 4 3 3 4 2 3 NA NA 1 3 5 NA 5 4 Quintile Returns over the equal-weight universe z[[&quot;rets&quot;]] Q1 Q2 Q3 Q4 Q5 TxB uRet 202112 -1.9199910 NA 2.4995631 NA -0.5795721 -1.3404189 5.384292 202111 -0.3433932 -0.1109300 0.7141881 -0.1477184 -0.1380114 -0.2053819 3.961149 202110 -2.5738008 -0.2382160 0.7507335 1.6790032 -0.1714095 -2.4023913 -5.046338 202109 2.6990409 -2.7111285 1.6871536 -1.0951046 -0.5799614 3.2790023 3.263647 202108 -0.9195644 -0.8498737 0.0028237 -0.3532431 2.1198576 -3.0394220 -3.472902 202107 2.7762268 -0.8821888 0.0278446 -1.5562480 -0.3656347 3.1418616 4.242061 8.3.4 Performance Go long the top basket and short the bottom basket. Performance over all holding periods fcn &lt;- function(retW) {as.matrix(bbk(x, y, 1, retW, 5, doW, T, 0, delay, idx)$summ)} # DEFINE SUMMARY FUNCTION mat.ex.array3d(sapply(split(hz, hz), fcn, simplify = &quot;array&quot;)) # WRITE SUMMARIES Q1 Q2 Q3 Q4 Q5 TxB uRet Monthly AnnMn 3.963237e-01 1.482927e+00 2.003981e+00 3.826815e-01 -3.386592e+00 3.782916e+00 12.135341 AnnSd 6.744385e+00 6.836257e+00 6.384056e+00 6.051691e+00 5.101378e+00 9.556265e+00 18.739885 Sharpe 5.876350e+00 2.169210e+01 3.139041e+01 6.323546e+00 -6.638583e+01 3.958572e+01 64.756750 HitRate 3.017241e+00 1.754386e+00 5.172414e+00 -4.385965e-01 -9.051724e+00 5.603448e+00 10.775862 Beta 6.800430e-02 NA 2.198310e-02 NA -7.513800e-02 1.431423e-01 1.000000 Alpha -4.289312e-01 NA 1.737209e+00 NA -2.474767e+00 2.045836e+00 0.000000 DrawDn -3.139256e+01 -1.682912e+01 -3.543990e+01 -1.565515e+01 -7.296188e+01 -2.319690e+01 -82.136274 DDnBeg 2.003080e+05 2.015040e+05 2.008060e+05 2.006120e+05 2.003030e+05 2.017080e+05 200710.000000 DDnN 3.100000e+01 8.000000e+01 7.200000e+01 5.400000e+01 1.780000e+02 3.800000e+01 16.000000 AnnTo 5.709770e+01 1.066228e+02 1.141092e+02 9.068713e+01 4.875000e+01 1.058477e+02 0.000000 Monthly2 AnnMn 2.576013e-01 3.106625e+00 1.664524e+00 -4.023011e-01 -4.487410e+00 4.745011e+00 12.568736 AnnSd 1.051878e+01 7.074858e+00 6.974283e+00 6.168990e+00 6.491177e+00 1.440411e+01 24.126307 Sharpe 6.914231e+00 4.354941e+01 2.354654e+01 -7.996656e+00 -7.007460e+01 3.883449e+01 52.371566 HitRate 7.870370e+00 1.006335e+01 6.505848e+00 -5.190059e+00 -1.786062e+01 1.924951e+01 20.102339 Beta -4.164490e-02 1.773134e-01 9.164400e-02 -4.020650e-02 -1.514639e-01 1.098190e-01 1.000000 Alpha 7.744382e-01 8.581391e-01 4.993791e-01 6.282020e-02 -2.578343e+00 3.352781e+00 0.000000 DrawDn -3.553144e+01 -8.809902e+00 -2.211122e+01 -2.564469e+01 -8.472799e+01 -3.540464e+01 -41.793435 DDnBeg 2.011232e+05 2.010815e+05 2.007898e+05 2.003898e+05 2.002982e+05 2.014898e+05 200748.166667 DDnN 3.916667e+00 3.666667e+00 6.250000e+00 8.000000e+00 1.725000e+01 3.333333e+00 1.250000 AnnTo 3.698025e+01 5.719251e+01 5.767821e+01 4.565471e+01 2.800303e+01 6.498328e+01 0.000000 Quarterly AnnMn -1.528879e-01 1.656894e+00 2.503923e+00 -1.925459e-01 -3.668506e+00 3.515618e+00 12.636113 AnnSd 7.447667e+00 6.866041e+00 6.239602e+00 6.280869e+00 4.981038e+00 1.021284e+01 21.137318 Sharpe -1.993604e+00 2.419252e+01 4.088367e+01 -3.274258e+00 -7.366859e+01 3.451999e+01 59.823220 HitRate 6.100479e+00 2.444444e+00 5.228981e+00 -2.415205e+00 -1.218387e+01 1.000228e+01 18.677375 Beta 2.462280e-02 NA 3.916890e-02 NA -9.352700e-02 1.181499e-01 1.000000 Alpha -4.642073e-01 NA 2.007936e+00 NA -2.487000e+00 2.022792e+00 0.000000 DrawDn -3.473509e+01 -1.906937e+01 -2.120211e+01 -2.202408e+01 -7.464017e+01 -2.670918e+01 -68.153694 DDnBeg 2.003040e+05 2.009737e+05 2.008070e+05 2.005110e+05 2.003020e+05 2.008737e+05 200711.000000 DDnN 1.433333e+01 2.900000e+01 2.200000e+01 1.733333e+01 6.000000e+01 7.000000e+00 5.000000 AnnTo 5.311467e+01 9.214997e+01 9.763012e+01 7.932079e+01 4.388085e+01 9.699552e+01 0.000000 Semi-Annual AnnMn -6.092536e-01 2.294075e+00 2.652170e+00 -4.533089e-01 -3.714226e+00 3.104973e+00 12.702871 AnnSd 9.158836e+00 7.297674e+00 6.711420e+00 5.977252e+00 5.931860e+00 1.329611e+01 22.957554 Sharpe -6.416332e+00 3.176914e+01 3.981428e+01 -7.497508e+00 -6.310226e+01 2.422924e+01 55.392501 HitRate 4.634898e+00 2.868658e+00 9.447605e+00 2.489331e-01 -1.827881e+01 1.385728e+01 21.799431 Beta -6.893200e-03 1.618800e-01 6.750820e-02 -4.742910e-02 -1.085340e-01 1.016409e-01 1.000000 Alpha -5.349683e-01 2.463028e-01 1.797306e+00 1.625835e-01 -2.326876e+00 1.791907e+00 0.000000 DrawDn -3.548418e+01 -1.997909e+01 -2.169756e+01 -2.598373e+01 -7.924391e+01 -3.989268e+01 -55.910180 DDnBeg 2.009712e+05 2.010398e+05 2.007408e+05 2.004055e+05 2.002888e+05 2.015398e+05 200725.166667 DDnN 9.333333e+00 1.283333e+01 1.100000e+01 9.666667e+00 2.950000e+01 6.666667e+00 2.333333 AnnTo 4.493000e+01 7.695129e+01 7.545157e+01 6.412887e+01 3.646660e+01 8.139659e+01 0.000000 Annualized mean one-week returns bbk(x, y, 1, hz[1], 5, doW, T, 0, delay, idx)$annSumm # DISPLAY CALENDAR-YEAR RETURNS Q1 Q2 Q3 Q4 Q5 TxB uRet nPrds 2003 -5.7336080 6.6432813 15.7552920 7.1183510 -7.5512892 1.8176812 47.297335 12 2004 -2.8276111 6.8501635 -2.7842253 -7.3221705 -3.1871014 0.3594902 30.332868 12 2005 -17.8323370 -0.2933890 11.5496779 13.9887163 -4.5052644 -13.3270726 24.363447 12 2006 -0.5373572 6.9560646 3.4986904 3.3724498 -6.5140164 5.9766592 30.534940 12 2007 2.6154882 15.1753632 3.5266579 -13.9844116 -8.4681146 11.0836027 26.002287 12 2008 4.3995545 -7.0712422 -7.4972569 8.6624146 -3.0564230 7.4559775 -60.870526 12 2009 14.6969236 9.8798001 0.9238067 -7.1070278 -12.9552971 27.6522207 48.213066 12 2010 6.3667967 3.2805295 -1.7574563 -1.4883848 -6.6971133 13.0639100 15.660204 12 2011 4.1136122 -3.9150420 -4.9292317 0.4469094 4.2837522 -0.1701400 -16.092145 12 2012 6.0357584 1.4753573 -1.2220781 0.2627206 -6.5517583 12.5875166 20.389757 12 2013 -5.0596508 0.4893753 -2.2851389 11.3964052 -4.5555497 -0.5041011 8.499548 12 2014 3.5947168 -0.7388354 -0.1801168 -4.9310112 1.6178889 1.9768279 -3.244442 12 2015 1.5711513 -0.4892560 -1.0602977 6.8780313 -6.7818179 8.3529692 -9.930792 12 2016 1.8784640 -3.4021908 3.3870754 -3.8244494 1.5847591 0.2937048 8.353035 12 2017 0.7915899 1.4200123 5.3706394 -0.8754904 -6.1454965 6.9370864 23.339705 12 2018 -6.7846783 3.2832508 -0.2587327 -2.2045636 5.8448698 -12.6295481 -12.570918 12 2019 4.2533975 -3.5242204 0.4932785 0.6608745 -1.3975131 5.6509106 17.173365 12 2020 -4.9377660 -0.2053033 7.7954686 -2.4464427 0.6462525 -5.5840186 8.728241 12 2021 1.2587311 -7.6380984 8.0348093 -1.3319720 -0.9030244 2.1617555 9.425889 12 2022 -0.6027533 NaN 1.1483327 NaN -0.5455794 -0.0571738 57.035163 4 "],["FAQ.html", "9 FAQ 9.1 Country Flows", " 9 FAQ 9.1 Country Flows Country flows is a derived dataset that delivers flows to individual countries. It uses a proprietary algorithm to calculate these derivations. The procedure assumes fixed average country allocations across different cross-border mandates. It then uses fund-level flow data to calculate flows to individual countries. One advantage of this derivation is the broader coverage. EPFRs Fund Flows Database has significant coverage across different regions and countries. In contrast, the Country Allocations Database is a subset of the fund flows dataset. Using fixed average country allocations allows us to include a broader range of cross-border funds in individual country flow calculations. Because of the more general assumptions, Country Flows Database is typically a better fit for macroeconomist &amp; strategists. A typical use case for a macroeconomist would be calculating a high-frequency proxy for those countries balance of payments statistics. On the other hand, when trying to create country rotation strategies, quantitative hedge funds rely on fund-level data. This lets them have a one-to-one match between the country allocations and fund-level flows. "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
